<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Add maximum phylogenetic endemism objective — add_max_phylo_end_objective • prioritizr</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous"><link href="../docsearch.css" rel="stylesheet"><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Add maximum phylogenetic endemism objective — add_max_phylo_end_objective"><meta property="og:description" content="Set the objective of a conservation planning problem() to
maximize the phylogenetic endemism of the features represented in the
solution subject to a budget. This objective is similar to
add_max_phylo_end_objective() except
that emphasis is placed on representing species with geographically
restricted evolutionary histories, instead representing as much evolutionary
history as possible. This function was inspired by Faith (1992),
Rodrigues et al. (2002), and Rosauer et al. (2009)."><meta property="og:image" content="https://prioritizr.net/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-70466840-4"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-70466840-4');
</script></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">prioritizr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">7.2.0.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/prioritizr.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/package_overview.html">Package overview</a>
    </li>
    <li>
      <a href="../articles/gurobi_installation_guide.html">Gurobi installation guide</a>
    </li>
    <li>
      <a href="../articles/solver_benchmarks.html">Solver benchmarks</a>
    </li>
    <li>
      <a href="../articles/publication_record.html">Publication record</a>
    </li>
  </ul></li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/connectivity_tutorial.html">Connectivity</a>
    </li>
    <li>
      <a href="../articles/calibrating_trade-offs_tutorial.html">Calibrating trade-offs</a>
    </li>
    <li>
      <a href="../articles/management_zones_tutorial.html">Management zones</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/prioritizr/prioritizr/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul><form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off"></div>
      </form>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Add maximum phylogenetic endemism objective</h1>
    <small class="dont-index">Source: <a href="https://github.com/prioritizr/prioritizr/blob/HEAD/R/add_max_phylo_end_objective.R" class="external-link"><code>R/add_max_phylo_end_objective.R</code></a></small>
    <div class="hidden name"><code>add_max_phylo_end_objective.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Set the objective of a conservation planning <code><a href="problem.html">problem()</a></code> to
maximize the phylogenetic endemism of the features represented in the
solution subject to a budget. This objective is similar to
<code>add_max_phylo_end_objective()</code> except
that emphasis is placed on representing species with geographically
restricted evolutionary histories, instead representing as much evolutionary
history as possible. This function was inspired by Faith (1992),
Rodrigues <em>et al.</em> (2002), and Rosauer <em>et al.</em> (2009).</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">add_max_phylo_end_objective</span><span class="op">(</span><span class="va">x</span>, <span class="va">budget</span>, <span class="va">tree</span><span class="op">)</span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>x</dt>
<dd><p><code><a href="problem.html">problem()</a></code> (i.e., <code><a href="ConservationProblem-class.html">ConservationProblem</a></code>) object.</p></dd>
<dt>budget</dt>
<dd><p><code>numeric</code> value specifying the maximum expenditure of
the prioritization. For problems with multiple zones, the argument
to <code>budget</code> can be (i) a single <code>numeric</code> value to specify a single budget
for the entire solution or (ii) a <code>numeric</code> vector to specify
a separate budget for each management zone.</p></dd>
<dt>tree</dt>
<dd><p><code><a href="https://rdrr.io/pkg/ape/man/read.tree.html" class="external-link">phylo()</a></code> object specifying a phylogenetic tree
for the conservation features.</p></dd>
</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>Object (i.e., <code><a href="ConservationProblem-class.html">ConservationProblem</a></code>) with the objective
added to it.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>The maximum phylogenetic endemism objective finds the set of
planning units that meets representation targets for a phylogenetic tree
while staying within a fixed budget. If multiple solutions can meet all
targets while staying within budget, the cheapest solution is chosen.
Note that this objective is similar to the maximum
features objective (<code><a href="add_max_features_objective.html">add_max_features_objective()</a></code>) in that it
allows for both a budget and targets to be set for each feature. However,
unlike the maximum feature objective, the aim of this objective is to
maximize the total phylogenetic endemism of the targets met in the
solution, so if multiple targets are provided for a single feature, the
problem will only need to meet a single target for that feature
for the phylogenetic benefit for that feature to be counted when
calculating the phylogenetic endemism of the solution. In other words,
for multi-zone problems, this objective does not aim to maximize the
phylogenetic endemism in each zone, but rather this objective
aims to maximize the phylogenetic endemism of targets that can be met
through allocating planning units to any of the different zones in a
problem. This can be useful for problems where targets pertain to the total
amount held for each feature across multiple zones. For example,
each feature might have a non-zero amount of suitable habitat in each
planning unit when the planning units are assigned to a (i) not restored,
(ii) partially restored, or (iii) completely restored management zone.
Here each target corresponds to a single feature and can be met through
the total amount of habitat in planning units present to the three
zones.</p>
    </div>
    <div id="mathematical-formulation">
    <h2>Mathematical formulation</h2>
    

<p>This objective can be expressed mathematically for a set of planning units
(\(I\) indexed by \(i\)) and a set of features (\(J\)
indexed by \(j\)) as:</p>
<p>$$\mathit{Maximize} \space \sum_{i = 1}^{I} -s \space c_i \space x_i +
\sum_{j = 1}^{J} m_b l_b \frac{1}{a_b} \\
\mathit{subject \space to} \\
\sum_{i = 1}^{I} x_i r_{ij} \geq y_j t_j \forall j \in J \\
m_b \leq y_j \forall j \in T(b) \\
\sum_{i = 1}^{I} x_i c_i \leq B$$</p>
<p>Here, \(x_i\) is the <a href="decisions.html">decisions</a> variable (e.g.,
specifying whether planning unit \(i\) has been selected (1) or not
(0)), \(r_{ij}\) is the amount of feature \(j\) in planning
unit \(i\), \(t_j\) is the representation target for feature
\(j\), \(y_j\) indicates if the solution has meet
the target \(t_j\) for feature \(j\). Additionally,
\(T\) represents a phylogenetic tree containing features \(j\)
and has the branches \(b\) associated within lengths \(l_b\).
Each branch \(b \in B\) is associated with a total amount
\(a_b\) indicating the total geographic extent or amount of habitat.
The \(a_b\) variable for a given branch is calculated by summing the
\(r_{ij}\) data for all features \(j \in J\) that are
associated with the branch. The binary variable \(m_b\) denotes if
at least one feature associated with the branch \(b\) has met its
representation as indicated by \(y_j\). For brevity, we denote
the features \(j\) associated with branch \(b\) using
\(T(b)\). Finally, \(B\) is the budget allocated for the
solution, \(c_i\) is the cost of planning unit \(i\), and
\(s\) is a scaling factor used to shrink the costs so that the problem
will return a cheapest solution when there are multiple solutions that
represent the same amount of all features within the budget.</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>Faith DP (1992) Conservation evaluation and phylogenetic diversity.
<em>Biological Conservation</em>, 61: 1--10.</p>
<p>Rodrigues ASL and Gaston KJ (2002) Maximising phylogenetic diversity in the
selection of networks of conservation areas. <em>Biological Conservation</em>,
105: 103--111.</p>
<p>Rosauer D, Laffan SW, Crisp, MD, Donnellan SC and Cook LG (2009)
Phylogenetic endemism: a new approach for identifying geographical
concentrations of evolutionary history. <em>Molecular Ecology</em>, 18:
4061--4072.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p>See <a href="objectives.html">objectives</a> for an overview of all functions for adding objectives.
Also, see <a href="targets.html">targets</a> for an overview of all functions for adding targets, and
<code><a href="add_feature_weights.html">add_feature_weights()</a></code> to specify weights for different features.</p>
<p>Other objectives: 
<code><a href="add_max_cover_objective.html">add_max_cover_objective</a>()</code>,
<code><a href="add_max_features_objective.html">add_max_features_objective</a>()</code>,
<code><a href="add_max_phylo_div_objective.html">add_max_phylo_div_objective</a>()</code>,
<code><a href="add_max_utility_objective.html">add_max_utility_objective</a>()</code>,
<code><a href="add_min_largest_shortfall_objective.html">add_min_largest_shortfall_objective</a>()</code>,
<code><a href="add_min_set_objective.html">add_min_set_objective</a>()</code>,
<code><a href="add_min_shortfall_objective.html">add_min_shortfall_objective</a>()</code></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="co"># load ape package</span></span>
<span class="r-in"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="http://ape-package.ird.fr/" class="external-link">ape</a></span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># load data</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">sim_pu_raster</span>, <span class="va">sim_features</span>, <span class="va">sim_phylogeny</span>, <span class="va">sim_pu_zones_stack</span>,</span>
<span class="r-in">     <span class="va">sim_features_zones</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># plot the simulated phylogeny</span></span>
<span class="r-in"><span class="co"># \dontrun{</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sim_phylogeny</span>, main <span class="op">=</span> <span class="st">"phylogeny"</span><span class="op">)</span></span>
<span class="r-plt img"><img src="add_max_phylo_end_objective-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span class="co"># }</span></span>
<span class="r-in"><span class="co"># create problem with a maximum phylogenetic endemism objective,</span></span>
<span class="r-in"><span class="co"># where each feature needs 10% of its distribution to be secured for</span></span>
<span class="r-in"><span class="co"># it to be adequately conserved and a total budget of 1900</span></span>
<span class="r-in"><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="problem.html">problem</a></span><span class="op">(</span><span class="va">sim_pu_raster</span>, <span class="va">sim_features</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span>
<span class="r-in">      <span class="fu">add_max_phylo_end_objective</span><span class="op">(</span><span class="fl">1900</span>, <span class="va">sim_phylogeny</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span>
<span class="r-in">      <span class="fu"><a href="add_relative_targets.html">add_relative_targets</a></span><span class="op">(</span><span class="fl">0.1</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span>
<span class="r-in">      <span class="fu"><a href="add_binary_decisions.html">add_binary_decisions</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span>
<span class="r-in">      <span class="fu"><a href="add_default_solver.html">add_default_solver</a></span><span class="op">(</span>verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span class="r-in"><span class="co"># \dontrun{</span></span>
<span class="r-in"><span class="co"># solve problem</span></span>
<span class="r-in"><span class="va">s1</span> <span class="op">&lt;-</span> <span class="fu"><a href="solve.html">solve</a></span><span class="op">(</span><span class="va">p1</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># plot solution</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">s1</span>, main <span class="op">=</span> <span class="st">"solution"</span>, axes <span class="op">=</span> <span class="cn">FALSE</span>, box <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span class="r-plt img"><img src="add_max_phylo_end_objective-2.png" alt="" width="700" height="433"></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># find out which features have their targets met</span></span>
<span class="r-in"><span class="va">r1</span> <span class="op">&lt;-</span> <span class="fu"><a href="eval_target_coverage_summary.html">eval_target_coverage_summary</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">s1</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="print.html">print</a></span><span class="op">(</span><span class="va">r1</span>, width <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 5 × 9</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   feature met   total_amount absolute_target absolute_held absolute_shortfall</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span> layer.1 FALSE         83.3            8.33          7.71              0.618</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">2</span> layer.2 FALSE         31.2            3.12          2.35              0.775</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">3</span> layer.3 FALSE         72.0            7.20          5.81              1.38 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">4</span> layer.4 TRUE          42.7            4.27          4.28              0    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">5</span> layer.5 TRUE          56.7            5.67          5.77              0    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   relative_target relative_held relative_shortfall</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span>             0.1        0.092<span style="text-decoration: underline;">6</span>            0.007<span style="text-decoration: underline;">42</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">2</span>             0.1        0.075<span style="text-decoration: underline;">2</span>            0.024<span style="text-decoration: underline;">8</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">3</span>             0.1        0.080<span style="text-decoration: underline;">8</span>            0.019<span style="text-decoration: underline;">2</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">4</span>             0.1        0.100             0      </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">5</span>             0.1        0.102             0      </span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># plot the phylogeny and color the adequately represented features in red</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sim_phylogeny</span>, main <span class="op">=</span> <span class="st">"adequately represented features"</span>,</span>
<span class="r-in">     tip.color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/replace.html" class="external-link">replace</a></span><span class="op">(</span></span>
<span class="r-in">       <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="fu"><a href="https://rdrr.io/pkg/raster/man/nlayers.html" class="external-link">nlayers</a></span><span class="op">(</span><span class="va">sim_features</span><span class="op">)</span><span class="op">)</span>,</span>
<span class="r-in">       <span class="va">sim_phylogeny</span><span class="op">$</span><span class="va">tip.label</span> <span class="op"><a href="https://rdrr.io/pkg/raster/man/match.html" class="external-link">%in%</a></span> <span class="va">r1</span><span class="op">$</span><span class="va">feature</span><span class="op">[</span><span class="va">r1</span><span class="op">$</span><span class="va">met</span><span class="op">]</span>,</span>
<span class="r-in">       <span class="st">"red"</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-plt img"><img src="add_max_phylo_end_objective-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span class="co"># }</span></span>
<span class="r-in"><span class="co"># rename the features in the example phylogeny for use with the</span></span>
<span class="r-in"><span class="co"># multi-zone data</span></span>
<span class="r-in"><span class="va">sim_phylogeny</span><span class="op">$</span><span class="va">tip.label</span> <span class="op">&lt;-</span> <span class="fu"><a href="feature_names.html">feature_names</a></span><span class="op">(</span><span class="va">sim_features_zones</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># create targets for a multi-zone problem. Here, each feature needs a total</span></span>
<span class="r-in"><span class="co"># of 10 units of habitat to be conserved among the three zones to be</span></span>
<span class="r-in"><span class="co"># considered adequately conserved</span></span>
<span class="r-in"><span class="va">targets</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span class="r-in">  feature <span class="op">=</span> <span class="fu"><a href="feature_names.html">feature_names</a></span><span class="op">(</span><span class="va">sim_features_zones</span><span class="op">)</span>,</span>
<span class="r-in">  zone <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="zone_names.html">zone_names</a></span><span class="op">(</span><span class="va">sim_features_zones</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,</span>
<span class="r-in">          <span class="fu"><a href="number_of_features.html">number_of_features</a></span><span class="op">(</span><span class="va">sim_features_zones</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>,</span>
<span class="r-in">  type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"absolute"</span>, <span class="fu"><a href="number_of_features.html">number_of_features</a></span><span class="op">(</span><span class="va">sim_features_zones</span><span class="op">)</span><span class="op">)</span>,</span>
<span class="r-in">  target <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fu"><a href="number_of_features.html">number_of_features</a></span><span class="op">(</span><span class="va">sim_features_zones</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># create a multi-zone problem with a maximum phylogenetic endemism</span></span>
<span class="r-in"><span class="co"># objective, where the total expenditure in all zones is 5000.</span></span>
<span class="r-in"><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="problem.html">problem</a></span><span class="op">(</span><span class="va">sim_pu_zones_stack</span>, <span class="va">sim_features_zones</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span>
<span class="r-in">      <span class="fu">add_max_phylo_end_objective</span><span class="op">(</span><span class="fl">5000</span>, <span class="va">sim_phylogeny</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span>
<span class="r-in">      <span class="fu"><a href="add_manual_targets.html">add_manual_targets</a></span><span class="op">(</span><span class="va">targets</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span>
<span class="r-in">      <span class="fu"><a href="add_binary_decisions.html">add_binary_decisions</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span>
<span class="r-in">      <span class="fu"><a href="add_default_solver.html">add_default_solver</a></span><span class="op">(</span>verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span class="r-in"><span class="co"># \dontrun{</span></span>
<span class="r-in"><span class="co"># solve problem</span></span>
<span class="r-in"><span class="va">s2</span> <span class="op">&lt;-</span> <span class="fu"><a href="solve.html">solve</a></span><span class="op">(</span><span class="va">p2</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># plot solution</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="category_layer.html">category_layer</a></span><span class="op">(</span><span class="va">s2</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"solution"</span>, axes <span class="op">=</span> <span class="cn">FALSE</span>, box <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span class="r-plt img"><img src="add_max_phylo_end_objective-4.png" alt="" width="700" height="433"></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># find out which features have their targets met</span></span>
<span class="r-in"><span class="va">r2</span> <span class="op">&lt;-</span> <span class="fu"><a href="eval_target_coverage_summary.html">eval_target_coverage_summary</a></span><span class="op">(</span><span class="va">p2</span>, <span class="va">s2</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="print.html">print</a></span><span class="op">(</span><span class="va">r2</span>, width <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 5 × 11</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   feature   zone      sense met   total_amount absolute_target absolute_held</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span> feature_1 <span style="color: #949494;">&lt;chr [3]&gt;</span> &gt;=    TRUE         250.               10         19.6 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">2</span> feature_2 <span style="color: #949494;">&lt;chr [3]&gt;</span> &gt;=    FALSE         93.6              10          6.72</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">3</span> feature_3 <span style="color: #949494;">&lt;chr [3]&gt;</span> &gt;=    TRUE         216.               10         16.3 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">4</span> feature_4 <span style="color: #949494;">&lt;chr [3]&gt;</span> &gt;=    TRUE         128.               10         10.0 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">5</span> feature_5 <span style="color: #949494;">&lt;chr [3]&gt;</span> &gt;=    TRUE         170.               10         13.7 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   absolute_shortfall relative_target relative_held relative_shortfall</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span>               0             0.040<span style="text-decoration: underline;">0</span>        0.078<span style="text-decoration: underline;">6</span>             0     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">2</span>               3.28          0.107         0.071<span style="text-decoration: underline;">7</span>             0.035<span style="text-decoration: underline;">1</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">3</span>               0             0.046<span style="text-decoration: underline;">3</span>        0.075<span style="text-decoration: underline;">3</span>             0     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">4</span>               0             0.078<span style="text-decoration: underline;">1</span>        0.078<span style="text-decoration: underline;">2</span>             0     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">5</span>               0             0.058<span style="text-decoration: underline;">8</span>        0.080<span style="text-decoration: underline;">7</span>             0     </span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># plot the phylogeny and color the adequately represented features in red</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sim_phylogeny</span>, main <span class="op">=</span> <span class="st">"adequately represented features"</span>,</span>
<span class="r-in">     tip.color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/replace.html" class="external-link">replace</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="fu"><a href="https://rdrr.io/pkg/raster/man/nlayers.html" class="external-link">nlayers</a></span><span class="op">(</span><span class="va">sim_features</span><span class="op">)</span><span class="op">)</span>,</span>
<span class="r-in">                         <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">r2</span><span class="op">$</span><span class="va">met</span><span class="op">)</span>, <span class="st">"red"</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-plt img"><img src="add_max_phylo_end_objective-5.png" alt="" width="700" height="433"></span>
<span class="r-in"><span class="co"># }</span></span>
<span class="r-in"><span class="co"># create a multi-zone problem with a maximum phylogenetic endemism</span></span>
<span class="r-in"><span class="co"># objective, where each zone has a separate budget.</span></span>
<span class="r-in"><span class="va">p3</span> <span class="op">&lt;-</span> <span class="fu"><a href="problem.html">problem</a></span><span class="op">(</span><span class="va">sim_pu_zones_stack</span>, <span class="va">sim_features_zones</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span>
<span class="r-in">      <span class="fu">add_max_phylo_end_objective</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2500</span>, <span class="fl">500</span>, <span class="fl">2000</span><span class="op">)</span>, <span class="va">sim_phylogeny</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span>
<span class="r-in">      <span class="fu"><a href="add_manual_targets.html">add_manual_targets</a></span><span class="op">(</span><span class="va">targets</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span>
<span class="r-in">      <span class="fu"><a href="add_binary_decisions.html">add_binary_decisions</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span>
<span class="r-in">      <span class="fu"><a href="add_default_solver.html">add_default_solver</a></span><span class="op">(</span>verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span class="r-in"><span class="co"># \dontrun{</span></span>
<span class="r-in"><span class="co"># solve problem</span></span>
<span class="r-in"><span class="va">s3</span> <span class="op">&lt;-</span> <span class="fu"><a href="solve.html">solve</a></span><span class="op">(</span><span class="va">p3</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># plot solution</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="category_layer.html">category_layer</a></span><span class="op">(</span><span class="va">s3</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"solution"</span>, axes <span class="op">=</span> <span class="cn">FALSE</span>, box <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span class="r-plt img"><img src="add_max_phylo_end_objective-6.png" alt="" width="700" height="433"></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># find out which features have their targets met</span></span>
<span class="r-in"><span class="va">r3</span> <span class="op">&lt;-</span> <span class="fu"><a href="eval_target_coverage_summary.html">eval_target_coverage_summary</a></span><span class="op">(</span><span class="va">p3</span>, <span class="va">s3</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="print.html">print</a></span><span class="op">(</span><span class="va">r3</span>, width <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 5 × 11</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   feature   zone      sense met   total_amount absolute_target absolute_held</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span> feature_1 <span style="color: #949494;">&lt;chr [3]&gt;</span> &gt;=    TRUE         250.               10         15.7 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">2</span> feature_2 <span style="color: #949494;">&lt;chr [3]&gt;</span> &gt;=    FALSE         93.6              10          5.73</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">3</span> feature_3 <span style="color: #949494;">&lt;chr [3]&gt;</span> &gt;=    TRUE         216.               10         12.1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">4</span> feature_4 <span style="color: #949494;">&lt;chr [3]&gt;</span> &gt;=    TRUE         128.               10         10.0 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">5</span> feature_5 <span style="color: #949494;">&lt;chr [3]&gt;</span> &gt;=    TRUE         170.               10         11.4 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   absolute_shortfall relative_target relative_held relative_shortfall</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span>               0             0.040<span style="text-decoration: underline;">0</span>        0.062<span style="text-decoration: underline;">8</span>             0     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">2</span>               4.27          0.107         0.061<span style="text-decoration: underline;">2</span>             0.045<span style="text-decoration: underline;">6</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">3</span>               0             0.046<span style="text-decoration: underline;">3</span>        0.055<span style="text-decoration: underline;">9</span>             0     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">4</span>               0             0.078<span style="text-decoration: underline;">1</span>        0.078<span style="text-decoration: underline;">2</span>             0     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">5</span>               0             0.058<span style="text-decoration: underline;">8</span>        0.066<span style="text-decoration: underline;">9</span>             0     </span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># plot the phylogeny and color the adequately represented features in red</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sim_phylogeny</span>, main <span class="op">=</span> <span class="st">"adequately represented features"</span>,</span>
<span class="r-in">     tip.color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/replace.html" class="external-link">replace</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="fu"><a href="https://rdrr.io/pkg/raster/man/nlayers.html" class="external-link">nlayers</a></span><span class="op">(</span><span class="va">sim_features</span><span class="op">)</span><span class="op">)</span>,</span>
<span class="r-in">                         <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">r3</span><span class="op">$</span><span class="va">met</span><span class="op">)</span>, <span class="st">"red"</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-plt img"><img src="add_max_phylo_end_objective-7.png" alt="" width="700" height="433"></span>
<span class="r-in"><span class="co"># }</span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by <a href="https://jeffrey-hanson.com" class="external-link">Jeffrey O Hanson</a>, <a href="http://www.richard-schuster.com" class="external-link">Richard Schuster</a>, Nina Morrell, <a href="http://strimas.com" class="external-link">Matthew Strimas-Mackey</a>, Brandon P M Edwards, Matthew E Watts, <a href="https://arcese.forestry.ubc.ca" class="external-link">Peter Arcese</a>, <a href="https://josephrbennett.wordpress.com" class="external-link">Joseph Bennett</a>, <a href="http://www.possinghamlab.org" class="external-link">Hugh P Possingham</a>.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer></div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '486efa122ea6783724263412c5f28ab3',
    indexName: 'prioritizr',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script></body></html>

