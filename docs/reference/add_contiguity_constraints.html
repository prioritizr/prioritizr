<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Add contiguity constraints — add_contiguity_constraints • prioritizr</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous"><link href="../docsearch.css" rel="stylesheet"><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Add contiguity constraints — add_contiguity_constraints"><meta property="og:description" content="Add constraints to a conservation planning problem() to ensure
that all selected planning units are spatially connected with each other
and form a single contiguous unit."><meta property="og:image" content="https://prioritizr.net/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-70466840-4"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-70466840-4');
</script></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">prioritizr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">7.2.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/prioritizr.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/package_overview.html">Package overview</a>
    </li>
    <li>
      <a href="../articles/gurobi_installation_guide.html">Gurobi installation guide</a>
    </li>
    <li>
      <a href="../articles/solver_benchmarks.html">Solver benchmarks</a>
    </li>
    <li>
      <a href="../articles/publication_record.html">Publication record</a>
    </li>
  </ul></li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/connectivity_tutorial.html">Connectivity</a>
    </li>
    <li>
      <a href="../articles/calibrating_trade-offs_tutorial.html">Calibrating trade-offs</a>
    </li>
    <li>
      <a href="../articles/management_zones_tutorial.html">Management zones</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/prioritizr/prioritizr/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul><form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off"></div>
      </form>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Add contiguity constraints</h1>
    <small class="dont-index">Source: <a href="https://github.com/prioritizr/prioritizr/blob/HEAD/R/add_contiguity_constraints.R" class="external-link"><code>R/add_contiguity_constraints.R</code></a></small>
    <div class="hidden name"><code>add_contiguity_constraints.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Add constraints to a conservation planning <code><a href="problem.html">problem()</a></code> to ensure
that all selected planning units are spatially connected with each other
and form a single contiguous unit.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="co"># S4 method for ConservationProblem,ANY,ANY</span>
<span class="fu">add_contiguity_constraints</span><span class="op">(</span><span class="va">x</span>, <span class="va">zones</span>, <span class="va">data</span><span class="op">)</span>

<span class="co"># S4 method for ConservationProblem,ANY,data.frame</span>
<span class="fu">add_contiguity_constraints</span><span class="op">(</span><span class="va">x</span>, <span class="va">zones</span>, <span class="va">data</span><span class="op">)</span>

<span class="co"># S4 method for ConservationProblem,ANY,matrix</span>
<span class="fu">add_contiguity_constraints</span><span class="op">(</span><span class="va">x</span>, <span class="va">zones</span>, <span class="va">data</span><span class="op">)</span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>x</dt>
<dd><p><code><a href="problem.html">problem()</a></code> (i.e., <code><a href="ConservationProblem-class.html">ConservationProblem</a></code>) object.</p></dd>
<dt>zones</dt>
<dd><p><code>matrix</code> or <code>Matrix</code> object describing the
connection scheme for different zones. Each row and column corresponds
to a different zone in the argument to <code>x</code>, and cell values must
contain binary <code>numeric</code> values (i.e., one or zero) that indicate
if connected planning units (as specified in the argument to
<code>data</code>) should be still considered connected if they are allocated to
different zones. The cell values along the diagonal
of the matrix indicate if planning units should be subject to
contiguity constraints when they are allocated to a given zone. Note
arguments to <code>zones</code> must be symmetric, and that a row or column has
a value of one then the diagonal element for that row or column must also
have a value of one. The default argument to <code>zones</code> is an identity
matrix (i.e., a matrix with ones along the matrix diagonal and zeros
elsewhere), so that planning units are only considered connected if they
are both allocated to the same zone.</p></dd>
<dt>data</dt>
<dd><p><code>NULL</code>, <code>matrix</code>, <code>Matrix</code>, <code>data.frame</code>
object showing which planning units are connected with each
other. The argument defaults to <code>NULL</code> which means that the
connection data is calculated automatically using the
<code><a href="adjacency_matrix.html">adjacency_matrix()</a></code> function.
See the Data format section for more information.</p></dd>
</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>Object (i.e., <code><a href="ConservationProblem-class.html">ConservationProblem</a></code>) with the constraints
added to it.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>This function uses connection data to identify solutions that
form a single contiguous unit. It was inspired by the
mathematical formulations detailed in Önal and Briers (2006).</p>
    </div>
    <div id="data-format">
    <h2>Data format</h2>
    


<p>The argument to <code>data</code> can be specified using the following formats.</p>
<dl><dt><code>data</code> as a <code>NULL</code> value</dt>
<dd><p>indicating that connection data should be
calculated automatically using the <code><a href="adjacency_matrix.html">adjacency_matrix()</a></code> function.
This is the default argument.
Note that the connection data must be manually defined
using one of the other formats below when the planning unit data
in the argument to <code>x</code> is not spatially referenced (e.g.,
in <code>data.frame</code> or <code>numeric</code> format).</p></dd>


<dt><code>data</code> as a <code>matrix</code>/<code>Matrix</code> object</dt>
<dd><p>where rows and columns represent
different planning units and the value of each cell indicates if the
two planning units are connected or not. Cell values should be binary
<code>numeric</code> values (i.e., one or zero). Cells that occur along the
matrix diagonal have no effect on the solution at all because each
planning unit cannot be a connected with itself.</p></dd>


<dt><code>data</code> as a <code>data.frame</code> object</dt>
<dd><p>containing the fields (columns)
<code>"id1"</code>, <code>"id2"</code>, and <code>"boundary"</code>. Here, each row
denotes the connectivity between two planning units following the
<em>Marxan</em> format. The field <code>boundary</code> should contain
binary <code>numeric</code> values that indicate if the two planning units
specified in the fields <code>"id1"</code> and <code>"id2"</code> are connected
or not. This data can be used to describe symmetric or
asymmetric relationships between planning units. By default,
input data is assumed to be symmetric unless asymmetric data is
also included (e.g., if data is present for planning units 2 and 3, then
the same amount of connectivity is expected for planning units 3 and 2,
unless connectivity data is also provided for planning units 3 and 2).</p></dd>



</dl></div>
    <div id="notes">
    <h2>Notes</h2>
    

<p>In early versions, this function was named as the
<code><a href="prioritizr-deprecated.html">add_connected_constraints()</a></code> function.</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>Önal H and Briers RA (2006) Optimal selection of a connected
reserve network. <em>Operations Research</em>, 54: 379--388.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p>See <a href="constraints.html">constraints</a> for an overview of all functions for adding constraints.</p>
<p>Other constraints: 
<code><a href="add_feature_contiguity_constraints.html">add_feature_contiguity_constraints</a>()</code>,
<code><a href="add_linear_constraints.html">add_linear_constraints</a>()</code>,
<code><a href="add_locked_in_constraints.html">add_locked_in_constraints</a>()</code>,
<code><a href="add_locked_out_constraints.html">add_locked_out_constraints</a>()</code>,
<code><a href="add_mandatory_allocation_constraints.html">add_mandatory_allocation_constraints,ConservationProblem-method</a></code>,
<code><a href="add_manual_bounded_constraints.html">add_manual_bounded_constraints</a>()</code>,
<code><a href="add_manual_locked_constraints.html">add_manual_locked_constraints</a>()</code>,
<code><a href="add_neighbor_constraints.html">add_neighbor_constraints</a>()</code></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="co"># load data</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">sim_pu_raster</span>, <span class="va">sim_features</span>, <span class="va">sim_pu_zones_stack</span>, <span class="va">sim_features_zones</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># create minimal problem</span></span>
<span class="r-in"><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="problem.html">problem</a></span><span class="op">(</span><span class="va">sim_pu_raster</span>, <span class="va">sim_features</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span>
<span class="r-in">      <span class="fu"><a href="add_min_set_objective.html">add_min_set_objective</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span>
<span class="r-in">      <span class="fu"><a href="add_relative_targets.html">add_relative_targets</a></span><span class="op">(</span><span class="fl">0.2</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span>
<span class="r-in">      <span class="fu"><a href="add_binary_decisions.html">add_binary_decisions</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span>
<span class="r-in">      <span class="fu"><a href="add_default_solver.html">add_default_solver</a></span><span class="op">(</span>verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># create problem with added connected constraints</span></span>
<span class="r-in"><span class="va">p2</span> <span class="op">&lt;-</span> <span class="va">p1</span> <span class="op"><a href="pipe.html">%&gt;%</a></span> <span class="fu">add_contiguity_constraints</span><span class="op">(</span><span class="op">)</span></span>
<span class="r-in"><span class="co"># \dontrun{</span></span>
<span class="r-in"><span class="co"># solve problems</span></span>
<span class="r-in"><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/stack.html" class="external-link">stack</a></span><span class="op">(</span><span class="fu"><a href="solve.html">solve</a></span><span class="op">(</span><span class="va">p1</span><span class="op">)</span>, <span class="fu"><a href="solve.html">solve</a></span><span class="op">(</span><span class="va">p2</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># plot solutions</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">s</span>, main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"basic solution"</span>, <span class="st">"connected solution"</span><span class="op">)</span>, axes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span class="r-in">     box <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span class="r-plt img"><img src="add_contiguity_constraints-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span class="co"># }</span></span>
<span class="r-in"><span class="co"># create minimal problem with multiple zones, and limit the solver to</span></span>
<span class="r-in"><span class="co"># 30 seconds to obtain solutions in a feasible period of time</span></span>
<span class="r-in"><span class="va">p3</span> <span class="op">&lt;-</span> <span class="fu"><a href="problem.html">problem</a></span><span class="op">(</span><span class="va">sim_pu_zones_stack</span>, <span class="va">sim_features_zones</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span>
<span class="r-in">      <span class="fu"><a href="add_min_set_objective.html">add_min_set_objective</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span>
<span class="r-in">      <span class="fu"><a href="add_relative_targets.html">add_relative_targets</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0.2</span>, ncol <span class="op">=</span> <span class="fl">3</span>, nrow <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span>
<span class="r-in">      <span class="fu"><a href="add_binary_decisions.html">add_binary_decisions</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span>
<span class="r-in">      <span class="fu"><a href="add_default_solver.html">add_default_solver</a></span><span class="op">(</span>time_limit <span class="op">=</span> <span class="fl">30</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># create problem with added constraints to ensure that the planning units</span></span>
<span class="r-in"><span class="co"># allocated to each zone form a separate contiguous unit</span></span>
<span class="r-in"><span class="va">z4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="print.html">print</a></span><span class="op">(</span><span class="va">z4</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      [,1] [,2] [,3]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,]    1    0    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,]    0    1    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,]    0    0    1</span>
<span class="r-in"><span class="va">p4</span> <span class="op">&lt;-</span> <span class="va">p3</span> <span class="op"><a href="pipe.html">%&gt;%</a></span> <span class="fu">add_contiguity_constraints</span><span class="op">(</span><span class="va">z4</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># create problem with added constraints to ensure that the planning</span></span>
<span class="r-in"><span class="co"># units allocated to each zone form a separate contiguous unit,</span></span>
<span class="r-in"><span class="co"># except for planning units allocated to zone 2 which do not need</span></span>
<span class="r-in"><span class="co"># form a single contiguous unit</span></span>
<span class="r-in"><span class="va">z5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span class="r-in"><span class="va">z5</span><span class="op">[</span><span class="fl">3</span>, <span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span class="r-in"><span class="fu"><a href="print.html">print</a></span><span class="op">(</span><span class="va">z5</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      [,1] [,2] [,3]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,]    1    0    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,]    0    1    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,]    0    0    0</span>
<span class="r-in"><span class="va">p5</span> <span class="op">&lt;-</span> <span class="va">p3</span> <span class="op"><a href="pipe.html">%&gt;%</a></span> <span class="fu">add_contiguity_constraints</span><span class="op">(</span><span class="va">z5</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># create problem with added constraints that ensure that the planning</span></span>
<span class="r-in"><span class="co"># units allocated to zones 1 and 2 form a contiguous unit</span></span>
<span class="r-in"><span class="va">z6</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span class="r-in"><span class="va">z6</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span class="r-in"><span class="va">z6</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span class="r-in"><span class="fu"><a href="print.html">print</a></span><span class="op">(</span><span class="va">z6</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      [,1] [,2] [,3]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,]    1    1    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,]    1    1    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,]    0    0    1</span>
<span class="r-in"><span class="va">p6</span> <span class="op">&lt;-</span> <span class="va">p3</span> <span class="op"><a href="pipe.html">%&gt;%</a></span> <span class="fu">add_contiguity_constraints</span><span class="op">(</span><span class="va">z6</span><span class="op">)</span></span>
<span class="r-in"><span class="co"># \dontrun{</span></span>
<span class="r-in"><span class="co"># solve problems</span></span>
<span class="r-in"><span class="va">s2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">p3</span>, <span class="va">p4</span>, <span class="va">p5</span>, <span class="va">p6</span><span class="op">)</span>, <span class="va">solve</span><span class="op">)</span></span>
<span class="r-in"><span class="va">s2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">s2</span>, <span class="va">category_layer</span><span class="op">)</span></span>
<span class="r-in"><span class="va">s2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/stack.html" class="external-link">stack</a></span><span class="op">(</span><span class="va">s2</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># plot solutions</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">s2</span>, axes <span class="op">=</span> <span class="cn">FALSE</span>, box <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span class="r-in">     main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"basic solution"</span>, <span class="st">"p4"</span>, <span class="st">"p5"</span>, <span class="st">"p6"</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-plt img"><img src="add_contiguity_constraints-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span class="co"># }</span></span>
<span class="r-in"><span class="co"># create a problem that has a main "reserve zone" and a secondary</span></span>
<span class="r-in"><span class="co"># "corridor zone" to connect up import areas. Here, each feature has a</span></span>
<span class="r-in"><span class="co"># target of 30% of its distribution. If a planning unit is allocated to the</span></span>
<span class="r-in"><span class="co"># "reserve zone", then the prioritization accrues 100% of the amount of</span></span>
<span class="r-in"><span class="co"># each feature in the planning unit. If a planning unit is allocated to the</span></span>
<span class="r-in"><span class="co"># "corridor zone" then the prioritization accrues 40% of the amount of each</span></span>
<span class="r-in"><span class="co"># feature in the planning unit. Also, the cost of managing a planning unit</span></span>
<span class="r-in"><span class="co"># in the "corridor zone" is 45% of that when it is managed as the</span></span>
<span class="r-in"><span class="co"># "reserve zone". Finally, the problem has constraints which</span></span>
<span class="r-in"><span class="co"># ensure that all of the selected planning units form a single contiguous</span></span>
<span class="r-in"><span class="co"># unit, so that the planning units allocated to the "corridor zone" can</span></span>
<span class="r-in"><span class="co"># link up the planning units allocated to the "reserve zone"</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># create planning unit data</span></span>
<span class="r-in"><span class="va">pus</span> <span class="op">&lt;-</span> <span class="va">sim_pu_zones_stack</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">]</span><span class="op">]</span></span>
<span class="r-in"><span class="va">pus</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">pus</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op">*</span> <span class="fl">0.45</span></span>
<span class="r-in"><span class="fu"><a href="print.html">print</a></span><span class="op">(</span><span class="va">pus</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> class      : RasterStack </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> dimensions : 10, 10, 100, 2  (nrow, ncol, ncell, nlayers)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> resolution : 0.1, 0.1  (x, y)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> extent     : 0, 1, 0, 1  (xmin, xmax, ymin, ymax)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> crs        : NA </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> names      : layer.1.1, layer.1.2 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> min values : 190.13276,  85.55974 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> max values : 215.86384,  97.13873 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># create biodiversity data</span></span>
<span class="r-in"><span class="va">fts</span> <span class="op">&lt;-</span> <span class="fu"><a href="zones.html">zones</a></span><span class="op">(</span><span class="va">sim_features</span>, <span class="va">sim_features</span> <span class="op">*</span> <span class="fl">0.4</span>,</span>
<span class="r-in">             feature_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">sim_features</span><span class="op">)</span>,</span>
<span class="r-in">             zone_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"reserve zone"</span>, <span class="st">"corridor zone"</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="print.html">print</a></span><span class="op">(</span><span class="va">fts</span><span class="op">)</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Zones</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   zones: reserve zone, corridor zone (2 zones)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   features: layer.1, layer.2, layer.3, ... (5 features)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   data type: RasterStack</span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># create targets</span></span>
<span class="r-in"><span class="va">targets</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>feature <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">sim_features</span><span class="op">)</span>,</span>
<span class="r-in">                          zone <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="zone_names.html">zone_names</a></span><span class="op">(</span><span class="va">fts</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span><span class="op">)</span><span class="op">]</span>,</span>
<span class="r-in">                          target <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/cellStats.html" class="external-link">cellStats</a></span><span class="op">(</span><span class="va">sim_features</span>, <span class="st">"sum"</span><span class="op">)</span> <span class="op">*</span> <span class="fl">0.2</span>,</span>
<span class="r-in">                          type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"absolute"</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="print.html">print</a></span><span class="op">(</span><span class="va">targets</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 5 × 4</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   feature zone      target type    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span> layer.1 <span style="color: #949494;">&lt;chr [2]&gt;</span>  16.7  absolute</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">2</span> layer.2 <span style="color: #949494;">&lt;chr [2]&gt;</span>   6.24 absolute</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">3</span> layer.3 <span style="color: #949494;">&lt;chr [2]&gt;</span>  14.4  absolute</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">4</span> layer.4 <span style="color: #949494;">&lt;chr [2]&gt;</span>   8.53 absolute</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">5</span> layer.5 <span style="color: #949494;">&lt;chr [2]&gt;</span>  11.3  absolute</span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># create zones matrix</span></span>
<span class="r-in"><span class="va">z7</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span>, ncol <span class="op">=</span> <span class="fl">2</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="print.html">print</a></span><span class="op">(</span><span class="va">z7</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      [,1] [,2]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,]    1    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,]    1    1</span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># create problem</span></span>
<span class="r-in"><span class="va">p7</span> <span class="op">&lt;-</span> <span class="fu"><a href="problem.html">problem</a></span><span class="op">(</span><span class="va">pus</span>, <span class="va">fts</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span>
<span class="r-in">      <span class="fu"><a href="add_min_set_objective.html">add_min_set_objective</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span>
<span class="r-in">      <span class="fu"><a href="add_manual_targets.html">add_manual_targets</a></span><span class="op">(</span><span class="va">targets</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span>
<span class="r-in">      <span class="fu">add_contiguity_constraints</span><span class="op">(</span><span class="va">z7</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span>
<span class="r-in">      <span class="fu"><a href="add_binary_decisions.html">add_binary_decisions</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span>
<span class="r-in">      <span class="fu"><a href="add_default_solver.html">add_default_solver</a></span><span class="op">(</span>verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span class="r-in"><span class="co"># \dontrun{</span></span>
<span class="r-in"><span class="co"># solve problems</span></span>
<span class="r-in"><span class="va">s7</span> <span class="op">&lt;-</span> <span class="fu"><a href="category_layer.html">category_layer</a></span><span class="op">(</span><span class="fu"><a href="solve.html">solve</a></span><span class="op">(</span><span class="va">p7</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># plot solutions</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">s7</span>, <span class="st">"solution"</span>, axes <span class="op">=</span> <span class="cn">FALSE</span>, box <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span class="r-plt img"><img src="add_contiguity_constraints-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span class="co"># }</span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by <a href="https://jeffrey-hanson.com" class="external-link">Jeffrey O Hanson</a>, <a href="http://www.richard-schuster.com" class="external-link">Richard Schuster</a>, Nina Morrell, <a href="http://strimas.com" class="external-link">Matthew Strimas-Mackey</a>, Brandon P M Edwards, Matthew E Watts, <a href="https://arcese.forestry.ubc.ca" class="external-link">Peter Arcese</a>, <a href="https://josephrbennett.wordpress.com" class="external-link">Joseph Bennett</a>, <a href="http://www.possinghamlab.org" class="external-link">Hugh P Possingham</a>.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer></div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '486efa122ea6783724263412c5f28ab3',
    indexName: 'prioritizr',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script></body></html>

