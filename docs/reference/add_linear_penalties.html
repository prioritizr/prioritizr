<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Add linear penalties — add_linear_penalties • prioritizr</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>


<!-- docsearch -->
<script src="../docsearch.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous" />
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>



<meta property="og:title" content="Add linear penalties — add_linear_penalties" />
<meta property="og:description" content="Add penalties to a conservation planning problem() to penalize
solutions that select planning units with higher values from a specific
data source (e.g. anthropogenic impact). These penalties assume
a linear trade-off between the penalty values and the primary
objective of the conservation planning problem() (e.g.
solution cost for minimum set problems; add_min_set_objective()." />
<meta property="og:image" content="https://prioritizr.net/logo.png" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-70466840-4"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-70466840-4');
</script>


  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">prioritizr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">5.0.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/prioritizr.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/gurobi_installation.html">Gurobi Installation Guide</a>
    </li>
    <li>
      <a href="../articles/publication_record.html">Publication Record</a>
    </li>
    <li>
      <a href="../articles/saltspring.html">Salt Spring Island Tutorial</a>
    </li>
    <li>
      <a href="../articles/tasmania.html">Tasmania Tutorial</a>
    </li>
    <li>
      <a href="../articles/zones.html">Management Zones</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/prioritizr/prioritizr/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
      <form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
        </div>
      </form>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Add linear penalties</h1>
    <small class="dont-index">Source: <a href='https://github.com/prioritizr/prioritizr/blob/master/R/add_linear_penalties.R'><code>R/add_linear_penalties.R</code></a></small>
    <div class="hidden name"><code>add_linear_penalties.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Add penalties to a conservation planning <code><a href='problem.html'>problem()</a></code> to penalize
solutions that select planning units with higher values from a specific
data source (e.g. anthropogenic impact). These penalties assume
a linear trade-off between the penalty values and the primary
objective of the conservation planning <code><a href='problem.html'>problem()</a></code> (e.g.
solution cost for minimum set problems; <code><a href='add_min_set_objective.html'>add_min_set_objective()</a></code>.</p>
    </div>

    <pre class="usage"><span class='co'># S4 method for ConservationProblem,ANY,character</span>
<span class='fu'>add_linear_penalties</span>(<span class='no'>x</span>, <span class='no'>penalty</span>, <span class='no'>data</span>)

<span class='co'># S4 method for ConservationProblem,ANY,numeric</span>
<span class='fu'>add_linear_penalties</span>(<span class='no'>x</span>, <span class='no'>penalty</span>, <span class='no'>data</span>)

<span class='co'># S4 method for ConservationProblem,ANY,matrix</span>
<span class='fu'>add_linear_penalties</span>(<span class='no'>x</span>, <span class='no'>penalty</span>, <span class='no'>data</span>)

<span class='co'># S4 method for ConservationProblem,ANY,Matrix</span>
<span class='fu'>add_linear_penalties</span>(<span class='no'>x</span>, <span class='no'>penalty</span>, <span class='no'>data</span>)

<span class='co'># S4 method for ConservationProblem,ANY,Raster</span>
<span class='fu'>add_linear_penalties</span>(<span class='no'>x</span>, <span class='no'>penalty</span>, <span class='no'>data</span>)

<span class='co'># S4 method for ConservationProblem,ANY,dgCMatrix</span>
<span class='fu'>add_linear_penalties</span>(<span class='no'>x</span>, <span class='no'>penalty</span>, <span class='no'>data</span>)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p><code><a href='problem.html'>problem()</a></code> (i.e. <code><a href='ConservationProblem-class.html'>ConservationProblem</a></code>) object.</p></td>
    </tr>
    <tr>
      <th>penalty</th>
      <td><p><code>numeric</code> penalty value that is used to scale the
importance not selecting planning units with high <code>data</code> values.
Higher <code>penalty</code> values can be used to obtain solutions that
are strongly averse to selecting places with high <code>data</code>
values, and smaller <code>penalty</code> values can be used to obtain solutions
that only avoid places with especially high <code>data</code> values.
Note that negative
<code>penalty</code> values can be used to obtain solutions that prefer places
with high <code>data</code> values. Additionally, when adding these
penalties to problems with multiple zones, the argument to <code>penalty</code>
must have a value for each zone.</p></td>
    </tr>
    <tr>
      <th>data</th>
      <td><p><code>character</code>, <code>numeric</code>,
<code>Raster</code>, <code>matrix</code>, or <code>Matrix</code> object
containing the data used to penalize solutions. Planning units that are
associated with higher data values are penalized more strongly
in the solution. See the Details section for more information.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>This function penalizes solutions that have higher values according
to a specific metric. The argument to <code>data</code> can be specified in
several different ways:</p>
<dl'>

<dt><code>character</code></dt><dd><p>field (column) name(s) that contain the data for
penalizing planning units. This type of argument is only
compatible if the planning units in the argument to <code>x</code> are a
<code>Spatial</code>, <code><a href='https://rdrr.io/pkg/sf/man/sf.html'>sf::sf()</a></code>, or
<code>data.frame</code> object. The fields (columns) must have <code>numeric</code>
values, and must not contain any missing (<code>NA</code>) values.
For problems involving multiple zones, the argument to <code>data</code> must
contain a field name for each zone.</p></dd>

<dt><code>numeric</code></dt><dd><p><code>vector</code> containing the data for penalizing
each planning unit. These values must not contain any missing
(<code>NA</code>) values. Note that this type of argument is only available
for planning units that contain a single zone.</p></dd>

<dt><code>Raster</code></dt><dd><p>containing the data for
penalizing planning units. This type of argument is only
compatible if the planning units in the argument to <code>x</code> are
<code>Spatial</code>, <code><a href='https://rdrr.io/pkg/sf/man/sf.html'>sf::sf()</a></code>, or
or <code>Raster</code> (i.e. they are in a spatially
referenced format).
If the planning unit data are a <code>Spatial</code> or
<code><a href='https://rdrr.io/pkg/sf/man/sf.html'>sf::sf()</a></code> object, then the
penalty <code>data</code> are calculated by overlaying the planning units with
the argument to <code>data</code> and calculating the sum of the values.
If the planning unit data are in the
<code>Raster</code> then the penalty <code>data</code> are
calculated by extracting the cell values (note that the
planning unit data and the argument to codedata must have exactly
the same dimensionality, extent, and missingness).
For problems involving multiple zones, the argument to <code>data</code> must
contain a layer for each zone.</p></dd>

<dt><code>matrix</code>, <code>Matrix</code></dt><dd><p>containing <code>numeric</code> values
that specify data for penalizing each planning unit.
Each row corresponds to a planning unit, each column corresponds to a
zone, and each cell indicates the data for penalizing a planning unit
when it is allocated to a given zone.</p></dd>


</dl>

<p>The linear penalties are calculated using the following equations.
Let \(I\) denote the set of planning units
(indexed by \(i\)), \(Z\) the set of management zones (indexed by
\(z\)), and \(X_{iz}\) the decision variable for allocating
planning unit \(i\) to zone \(z\) (e.g. with binary
values one indicating if planning unit is allocated or not). Also, let
\(P_z\) represent the penalty scaling value for zones
\(z \in Z\) (argument to <code>penalty</code>), and
\(D_{iz}\) the penalty data for allocating planning unit
\(i \in I\) to zones \(z \in Z\) (argument to
<code>data</code> if supplied as a <code>matrix</code> object).</p>
<p>$$
 \sum_{i}^{I} \sum_{z}^{Z} P_z \times D_{iz} \times X_{iz}
 $$</p>
<p>Note that when the problem objective is to maximize some measure of
benefit and not minimize some measure of cost, the term \(P_z\) is
replaced with \(-P_z\).</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># set seed for reproducibility</span>
<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span>(<span class='fl'>600</span>)

<span class='co'># load data</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='no'>sim_pu_polygons</span>, <span class='no'>sim_pu_zones_stack</span>, <span class='no'>sim_features</span>, <span class='no'>sim_features_zones</span>)

<span class='co'># add a column to contain the penalty data for each planning unit</span>
<span class='co'># e.g. these values could indicate the level of habitat</span>
<span class='no'>sim_pu_polygons</span>$<span class='no'>penalty_data</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Uniform.html'>runif</a></span>(<span class='fu'><a href='OptimizationProblem-methods.html'>nrow</a></span>(<span class='no'>sim_pu_polygons</span>))

<span class='co'># plot the penalty data to visualise its spatial distribution</span>
<span class='fu'>spplot</span>(<span class='no'>sim_pu_polygons</span>, <span class='kw'>zcol</span> <span class='kw'>=</span> <span class='st'>"penalty_data"</span>, <span class='kw'>main</span> <span class='kw'>=</span> <span class='st'>"penalty data"</span>,
       <span class='kw'>axes</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>box</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</div><div class='img'><img src='add_linear_penalties-1.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='co'># create minimal problem with minimum set objective,</span>
<span class='co'># this does not use the penalty data</span>
<span class='no'>p1</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='problem.html'>problem</a></span>(<span class='no'>sim_pu_polygons</span>, <span class='no'>sim_features</span>, <span class='kw'>cost_column</span> <span class='kw'>=</span> <span class='st'>"cost"</span>) <span class='kw'>%&gt;%</span>
      <span class='fu'><a href='add_min_set_objective.html'>add_min_set_objective</a></span>() <span class='kw'>%&gt;%</span>
      <span class='fu'><a href='add_relative_targets.html'>add_relative_targets</a></span>(<span class='fl'>0.1</span>) <span class='kw'>%&gt;%</span>
      <span class='fu'><a href='add_binary_decisions.html'>add_binary_decisions</a></span>()

<span class='co'># print problem</span>
<span class='fu'><a href='print.html'>print</a></span>(<span class='no'>p1</span>)</div><div class='output co'>#&gt; <span class='message'>Conservation Problem</span>
#&gt; <span class='message'>  planning units: SpatialPolygonsDataFrame (90 units)</span>
#&gt; <span class='message'>  cost:           min: 190.13276, max: 215.86384</span>
#&gt; <span class='message'>  features:       layer.1, layer.2, layer.3, ... (5 features)</span>
#&gt; <span class='message'>  objective:      Minimum set objective </span>
#&gt; <span class='message'>  targets:        Relative targets [targets (min: 0.1, max: 0.1)]</span>
#&gt; <span class='message'>  decisions:      Binary decision </span>
#&gt; <span class='message'>  constraints:    &lt;none&gt;</span>
#&gt; <span class='message'>  penalties:      &lt;none&gt;</span>
#&gt; <span class='message'>  portfolio:      default</span>
#&gt; <span class='message'>  solver:         default</span></div><div class='input'>
<span class='co'># create an updated version of the previous problem,</span>
<span class='co'># with the penalties added to it</span>
<span class='no'>p2</span> <span class='kw'>&lt;-</span> <span class='no'>p1</span> <span class='kw'>%&gt;%</span> <span class='fu'>add_linear_penalties</span>(<span class='fl'>100</span>, <span class='kw'>data</span> <span class='kw'>=</span> <span class='st'>"penalty_data"</span>)

<span class='co'># print problem</span>
<span class='fu'><a href='print.html'>print</a></span>(<span class='no'>p2</span>)</div><div class='output co'>#&gt; <span class='message'>Conservation Problem</span>
#&gt; <span class='message'>  planning units: SpatialPolygonsDataFrame (90 units)</span>
#&gt; <span class='message'>  cost:           min: 190.13276, max: 215.86384</span>
#&gt; <span class='message'>  features:       layer.1, layer.2, layer.3, ... (5 features)</span>
#&gt; <span class='message'>  objective:      Minimum set objective </span>
#&gt; <span class='message'>  targets:        Relative targets [targets (min: 0.1, max: 0.1)]</span>
#&gt; <span class='message'>  decisions:      Binary decision </span>
#&gt; <span class='message'>  constraints:    &lt;none&gt;</span>
#&gt; <span class='message'>  penalties:      &lt;Linear penalties [penalty (100)]&gt;</span>
#&gt; <span class='message'>  portfolio:      default</span>
#&gt; <span class='message'>  solver:         default</span></div><div class='input'>
<span class='co'># \dontrun{</span>
<span class='co'># solve the two problems</span>
<span class='no'>s1</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='solve.html'>solve</a></span>(<span class='no'>p1</span>)</div><div class='output co'>#&gt; Gurobi Optimizer version 9.0.2 build v9.0.2rc0 (linux64)
#&gt; Optimize a model with 5 rows, 90 columns and 450 nonzeros
#&gt; Model fingerprint: 0xa41351c6
#&gt; Variable types: 0 continuous, 90 integer (90 binary)
#&gt; Coefficient statistics:
#&gt;   Matrix range     [2e-01, 9e-01]
#&gt;   Objective range  [2e+02, 2e+02]
#&gt;   Bounds range     [1e+00, 1e+00]
#&gt;   RHS range        [3e+00, 7e+00]
#&gt; Found heuristic solution: objective 2145.2678910
#&gt; Presolve time: 0.00s
#&gt; Presolved: 5 rows, 90 columns, 450 nonzeros
#&gt; Variable types: 0 continuous, 90 integer (90 binary)
#&gt; Presolved: 5 rows, 90 columns, 450 nonzeros
#&gt; 
#&gt; 
#&gt; Root relaxation: objective 1.732564e+03, 12 iterations, 0.00 seconds
#&gt; 
#&gt;     Nodes    |    Current Node    |     Objective Bounds      |     Work
#&gt;  Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time
#&gt; 
#&gt;      0     0 1732.56396    0    4 2145.26789 1732.56396  19.2%     -    0s
#&gt; H    0     0                    1792.5345202 1732.56396  3.35%     -    0s
#&gt; 
#&gt; Explored 1 nodes (12 simplex iterations) in 0.00 seconds
#&gt; Thread count was 1 (of 4 available processors)
#&gt; 
#&gt; Solution count 2: 1792.53 2145.27 
#&gt; 
#&gt; Optimal solution found (tolerance 1.00e-01)
#&gt; Best objective 1.792534520218e+03, best bound 1.732563961206e+03, gap 3.3456%</div><div class='input'><span class='no'>s2</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='solve.html'>solve</a></span>(<span class='no'>p2</span>)</div><div class='output co'>#&gt; Gurobi Optimizer version 9.0.2 build v9.0.2rc0 (linux64)
#&gt; Optimize a model with 5 rows, 90 columns and 450 nonzeros
#&gt; Model fingerprint: 0x87e27a7e
#&gt; Variable types: 0 continuous, 90 integer (90 binary)
#&gt; Coefficient statistics:
#&gt;   Matrix range     [2e-01, 9e-01]
#&gt;   Objective range  [2e+02, 3e+02]
#&gt;   Bounds range     [1e+00, 1e+00]
#&gt;   RHS range        [3e+00, 7e+00]
#&gt; Found heuristic solution: objective 2744.0718169
#&gt; Presolve time: 0.00s
#&gt; Presolved: 5 rows, 90 columns, 450 nonzeros
#&gt; Variable types: 0 continuous, 90 integer (90 binary)
#&gt; Presolved: 5 rows, 90 columns, 450 nonzeros
#&gt; 
#&gt; 
#&gt; Root relaxation: objective 1.899543e+03, 11 iterations, 0.00 seconds
#&gt; 
#&gt;     Nodes    |    Current Node    |     Objective Bounds      |     Work
#&gt;  Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time
#&gt; 
#&gt;      0     0 1899.54252    0    3 2744.07182 1899.54252  30.8%     -    0s
#&gt; H    0     0                    1919.3437451 1899.54252  1.03%     -    0s
#&gt; 
#&gt; Explored 1 nodes (11 simplex iterations) in 0.00 seconds
#&gt; Thread count was 1 (of 4 available processors)
#&gt; 
#&gt; Solution count 2: 1919.34 2744.07 
#&gt; 
#&gt; Optimal solution found (tolerance 1.00e-01)
#&gt; Best objective 1.919343745122e+03, best bound 1.899542519730e+03, gap 1.0317%</div><div class='input'>
<span class='co'># plot the solutions and compare them,</span>
<span class='co'># since we supplied a very high penalty value (i.e. 100), relative</span>
<span class='co'># to the range of values in the penalty data and the objective function,</span>
<span class='co'># the solution in s2 is very sensitive to values in the penalty data</span>
<span class='fu'>spplot</span>(<span class='no'>s1</span>, <span class='kw'>zcol</span> <span class='kw'>=</span> <span class='st'>"solution_1"</span>, <span class='kw'>main</span> <span class='kw'>=</span> <span class='st'>"solution without penalties"</span>,
       <span class='kw'>axes</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>box</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</div><div class='img'><img src='add_linear_penalties-2.png' alt='' width='700' height='433' /></div><div class='input'><span class='fu'>spplot</span>(<span class='no'>s2</span>, <span class='kw'>zcol</span> <span class='kw'>=</span> <span class='st'>"solution_1"</span>, <span class='kw'>main</span> <span class='kw'>=</span> <span class='st'>"solution with penalties"</span>,
       <span class='kw'>axes</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>box</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</div><div class='img'><img src='add_linear_penalties-3.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='co'># for real conservation planning exercises,</span>
<span class='co'># it would be worth exploring a range of penalty values (e.g. ranging</span>
<span class='co'># from 1 to 100 increments of 5) to explore the trade-offs</span>
<span class='co'># }</span>

<span class='co'># now, let's examine a conservation planning exercise involving multiple</span>
<span class='co'># management zones</span>

<span class='co'># create targets for each feature within each zone,</span>
<span class='co'># these targets indicate that each zone needs to represent 10% of the</span>
<span class='co'># spatial distribution of each feature</span>
<span class='no'>targ</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span>(<span class='fl'>0.1</span>, <span class='kw'>ncol</span> <span class='kw'>=</span> <span class='fu'><a href='number_of_zones.html'>number_of_zones</a></span>(<span class='no'>sim_features_zones</span>),
               <span class='kw'>nrow</span> <span class='kw'>=</span> <span class='fu'><a href='number_of_features.html'>number_of_features</a></span>(<span class='no'>sim_features_zones</span>))

<span class='co'># create penalty data for allocating each planning unit to each zone,</span>
<span class='co'># these data will be generated by simulating values</span>
<span class='no'>penalty_stack</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='simulate_cost.html'>simulate_cost</a></span>(<span class='no'>sim_pu_zones_stack</span><span class='kw'>[[</span><span class='fl'>1</span>]],
                               <span class='kw'>n</span> <span class='kw'>=</span> <span class='fu'><a href='number_of_zones.html'>number_of_zones</a></span>(<span class='no'>sim_features_zones</span>))</div><div class='output co'>#&gt; ...</div><div class='input'>
<span class='co'># plot the penalty data, each layer corresponds to a different zone</span>
<span class='fu'><a href='https://rdrr.io/r/base/plot.html'>plot</a></span>(<span class='no'>penalty_stack</span>, <span class='kw'>main</span> <span class='kw'>=</span> <span class='st'>"penalty data"</span>, <span class='kw'>axes</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>box</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</div><div class='img'><img src='add_linear_penalties-4.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='co'># create a multi-zone problem with the minimum set objective</span>
<span class='co'># and penalties for allocating planning units to each zone,</span>
<span class='co'># with a penalty scaling factor of 1 for each zone</span>
<span class='no'>p3</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='problem.html'>problem</a></span>(<span class='no'>sim_pu_zones_stack</span>, <span class='no'>sim_features_zones</span>) <span class='kw'>%&gt;%</span>
      <span class='fu'><a href='add_min_set_objective.html'>add_min_set_objective</a></span>() <span class='kw'>%&gt;%</span>
      <span class='fu'><a href='add_relative_targets.html'>add_relative_targets</a></span>(<span class='no'>targ</span>) <span class='kw'>%&gt;%</span>
      <span class='fu'>add_linear_penalties</span>(<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>1</span>, <span class='fl'>1</span>, <span class='fl'>1</span>), <span class='no'>penalty_stack</span>) <span class='kw'>%&gt;%</span>
      <span class='fu'><a href='add_binary_decisions.html'>add_binary_decisions</a></span>()

<span class='co'># print problem</span>
<span class='fu'><a href='print.html'>print</a></span>(<span class='no'>p3</span>)</div><div class='output co'>#&gt; <span class='message'>Conservation Problem</span>
#&gt; <span class='message'>  zones:          zone_1, zone_2, zone_3 (3 zones)</span>
#&gt; <span class='message'>  planning units: RasterStack (90 units)</span>
#&gt; <span class='message'>  cost:           min: 182.60173, max: 224.84924</span>
#&gt; <span class='message'>  features:       feature_1, feature_2, feature_3, ... (5 features)</span>
#&gt; <span class='message'>  objective:      Minimum set objective </span>
#&gt; <span class='message'>  targets:        Relative targets [targets (min: 0.1, max: 0.1)]</span>
#&gt; <span class='message'>  decisions:      Binary decision </span>
#&gt; <span class='message'>  constraints:    &lt;none&gt;</span>
#&gt; <span class='message'>  penalties:      &lt;Linear penalties [penalty (min: 1, max: 1)]&gt;</span>
#&gt; <span class='message'>  portfolio:      default</span>
#&gt; <span class='message'>  solver:         default</span></div><div class='input'>
<span class='co'># \dontrun{</span>
<span class='co'># solve problem</span>
<span class='no'>s3</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='solve.html'>solve</a></span>(<span class='no'>p3</span>)</div><div class='output co'>#&gt; Gurobi Optimizer version 9.0.2 build v9.0.2rc0 (linux64)
#&gt; Optimize a model with 105 rows, 270 columns and 1620 nonzeros
#&gt; Model fingerprint: 0x3583ba52
#&gt; Variable types: 0 continuous, 270 integer (270 binary)
#&gt; Coefficient statistics:
#&gt;   Matrix range     [2e-01, 1e+00]
#&gt;   Objective range  [4e+02, 4e+02]
#&gt;   Bounds range     [1e+00, 1e+00]
#&gt;   RHS range        [1e+00, 8e+00]
#&gt; Found heuristic solution: objective 13509.195716
#&gt; Presolve time: 0.00s
#&gt; Presolved: 105 rows, 270 columns, 1620 nonzeros
#&gt; Variable types: 0 continuous, 270 integer (270 binary)
#&gt; Presolved: 105 rows, 270 columns, 1620 nonzeros
#&gt; 
#&gt; 
#&gt; Root relaxation: objective 1.139632e+04, 132 iterations, 0.00 seconds
#&gt; 
#&gt;     Nodes    |    Current Node    |     Objective Bounds      |     Work
#&gt;  Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time
#&gt; 
#&gt;      0     0 11396.3183    0   17 13509.1957 11396.3183  15.6%     -    0s
#&gt; H    0     0                    11720.535020 11396.3183  2.77%     -    0s
#&gt; 
#&gt; Explored 1 nodes (132 simplex iterations) in 0.01 seconds
#&gt; Thread count was 1 (of 4 available processors)
#&gt; 
#&gt; Solution count 2: 11720.5 13509.2 
#&gt; 
#&gt; Optimal solution found (tolerance 1.00e-01)
#&gt; Best objective 1.172053501993e+04, best bound 1.139631827720e+04, gap 2.7662%</div><div class='input'>
<span class='co'># plot solution</span>
<span class='fu'><a href='https://rdrr.io/r/base/plot.html'>plot</a></span>(<span class='fu'><a href='category_layer.html'>category_layer</a></span>(<span class='no'>s3</span>), <span class='kw'>main</span> <span class='kw'>=</span> <span class='st'>"multi-zone solution"</span>,
     <span class='kw'>axes</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>box</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</div><div class='img'><img src='add_linear_penalties-5.png' alt='' width='700' height='433' /></div><div class='input'># }
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by <a href='https://jeffrey-hanson.com'>Jeffrey O Hanson</a>, <a href='http://www.richard-schuster.com'>Richard Schuster</a>, Nina Morrell, <a href='http://strimas.com'>Matthew Strimas-Mackey</a>, Matthew E Watts, <a href='https://arcese.forestry.ubc.ca'>Peter Arcese</a>, <a href='https://josephrbennett.wordpress.com'>Joseph Bennett</a>, <a href='http://www.possinghamlab.org'>Hugh P Possingham</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
   </div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script>
<script>
  docsearch({
    
    
    apiKey: '486efa122ea6783724263412c5f28ab3',
    indexName: 'prioritizr',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>



  </body>
</html>


