<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Add linear constraints — add_linear_constraints • prioritizr</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous"><link href="../docsearch.css" rel="stylesheet"><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Add linear constraints — add_linear_constraints"><meta property="og:description" content="Add constraints to a conservation planning problem() to ensure
that all selected planning units meet certain criteria."><meta property="og:image" content="https://prioritizr.net/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-70466840-4"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-70466840-4');
</script></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">prioritizr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">7.2.0.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/prioritizr.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/package_overview.html">Package overview</a>
    </li>
    <li>
      <a href="../articles/gurobi_installation_guide.html">Gurobi installation guide</a>
    </li>
    <li>
      <a href="../articles/solver_benchmarks.html">Solver benchmarks</a>
    </li>
    <li>
      <a href="../articles/publication_record.html">Publication record</a>
    </li>
  </ul></li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/connectivity_tutorial.html">Connectivity</a>
    </li>
    <li>
      <a href="../articles/calibrating_trade-offs_tutorial.html">Calibrating trade-offs</a>
    </li>
    <li>
      <a href="../articles/management_zones_tutorial.html">Management zones</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/prioritizr/prioritizr/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul><form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off"></div>
      </form>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Add linear constraints</h1>
    <small class="dont-index">Source: <a href="https://github.com/prioritizr/prioritizr/blob/HEAD/R/add_linear_constraints.R" class="external-link"><code>R/add_linear_constraints.R</code></a></small>
    <div class="hidden name"><code>add_linear_constraints.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Add constraints to a conservation planning <code><a href="problem.html">problem()</a></code> to ensure
that all selected planning units meet certain criteria.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="co"># S4 method for ConservationProblem,ANY,ANY,character</span>
<span class="fu">add_linear_constraints</span><span class="op">(</span><span class="va">x</span>, <span class="va">threshold</span>, <span class="va">sense</span>, <span class="va">data</span><span class="op">)</span>

<span class="co"># S4 method for ConservationProblem,ANY,ANY,numeric</span>
<span class="fu">add_linear_constraints</span><span class="op">(</span><span class="va">x</span>, <span class="va">threshold</span>, <span class="va">sense</span>, <span class="va">data</span><span class="op">)</span>

<span class="co"># S4 method for ConservationProblem,ANY,ANY,matrix</span>
<span class="fu">add_linear_constraints</span><span class="op">(</span><span class="va">x</span>, <span class="va">threshold</span>, <span class="va">sense</span>, <span class="va">data</span><span class="op">)</span>

<span class="co"># S4 method for ConservationProblem,ANY,ANY,Matrix</span>
<span class="fu">add_linear_constraints</span><span class="op">(</span><span class="va">x</span>, <span class="va">threshold</span>, <span class="va">sense</span>, <span class="va">data</span><span class="op">)</span>

<span class="co"># S4 method for ConservationProblem,ANY,ANY,Raster</span>
<span class="fu">add_linear_constraints</span><span class="op">(</span><span class="va">x</span>, <span class="va">threshold</span>, <span class="va">sense</span>, <span class="va">data</span><span class="op">)</span>

<span class="co"># S4 method for ConservationProblem,ANY,ANY,dgCMatrix</span>
<span class="fu">add_linear_constraints</span><span class="op">(</span><span class="va">x</span>, <span class="va">threshold</span>, <span class="va">sense</span>, <span class="va">data</span><span class="op">)</span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>x</dt>
<dd><p><code><a href="problem.html">problem()</a></code> (i.e., <code><a href="ConservationProblem-class.html">ConservationProblem</a></code>) object.</p></dd>
<dt>threshold</dt>
<dd><p><code>numeric</code> value.
This threshold value is also known as a "right-hand-side" value
per integer programming terminology.</p></dd>
<dt>sense</dt>
<dd><p><code>character</code> sense for the constraint. Available
options include <code>"&gt;="</code>, <code>"&lt;="</code>, or <code>"="</code> values.</p></dd>
<dt>data</dt>
<dd><p><code>character</code>, <code>numeric</code>,
<code><a href="https://rdrr.io/pkg/raster/man/Raster-classes.html" class="external-link">Raster</a></code>, <code>matrix</code>, or <code>Matrix</code> object
containing the constraint values.
These constraint values are also known as constraint coefficients
per integer programming terminology.
See the Data format section for more information.</p></dd>
</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>Object (i.e., <code><a href="ConservationProblem-class.html">ConservationProblem</a></code>) with the constraints
added to it.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>This function adds general purpose constraints that can be used to
ensure that solutions meet certain criteria
(see Examples section below for details).
For example, these constraints can be used to add multiple budgets.
They can also be used to ensure that the total number of planning units
allocated to a certain administrative area (e.g., country) does not exceed
a certain threshold (e.g., 30% of its total area). Furthermore,
they can also be used to ensure that features have a minimal level
of representation (e.g., 30%) when using an objective
function that aims to enhance feature representation given a budget
(e.g., <code><a href="add_min_shortfall_objective.html">add_min_shortfall_objective()</a></code>).</p>
    </div>
    <div id="mathematical-formulation">
    <h2>Mathematical formulation</h2>
    

<p>The linear constraints are implemented using the following
equation.
Let \(I\) denote the set of planning units
(indexed by \(i\)), \(Z\) the set of management zones (indexed by
\(z\)), and \(X_{iz}\) the decision variable for allocating
planning unit \(i\) to zone \(z\) (e.g., with binary
values indicating if each planning unit is allocated or not). Also, let
\(D_{iz}\) denote the constraint data associated with
planning units \(i \in I\) for zones \(z \in Z\)
(argument to <code>data</code>, if supplied as a <code>matrix</code> object),
\(\theta\) denote the constraint sense
(argument to <code>sense</code>, e.g., \(&lt;=\)), and \(t\) denote the constraint
threshold (argument to <code>threshold</code>).</p>
<p>$$
\sum_{i}^{I} \sum_{z}^{Z} (D_{iz} \times X_{iz}) \space \theta \space t
$$</p>
    </div>
    <div id="data-format">
    <h2>Data format</h2>
    


<p>The argument to <code>data</code> can be specified using the following formats.</p>
<dl><dt><code>data</code> as <code>character</code> vector</dt>
<dd><p>containing field (column) name(s) that
contain penalty values for planning units. This format is only
compatible if the planning units in the argument to <code>x</code> are a
<code><a href="https://rdrr.io/pkg/sp/man/Spatial-class.html" class="external-link">Spatial</a></code>, <code><a href="https://r-spatial.github.io/sf/reference/sf.html" class="external-link">sf::sf()</a></code>, or
<code>data.frame</code> object. The fields (columns) must have <code>numeric</code>
values, and must not contain any missing (<code>NA</code>) values.
For problems that contain a single zone, the argument to <code>data</code> must
contain a single field name. Otherwise, for problems that
contain multiple zones, the argument to <code>data</code> must
contain a field name for each zone.</p></dd>


<dt><code>data</code> as a <code>numeric</code> vector</dt>
<dd><p>containing values for
planning units. These values must not contain any missing
(<code>NA</code>) values. Note that this format is only available
for planning units that contain a single zone.</p></dd>


<dt><code>data</code> as a <code>matrix</code>/<code>Matrix</code> object</dt>
<dd><p>containing <code>numeric</code> values
that specify data for each planning unit.
Each row corresponds to a planning unit, each column corresponds to a
zone, and each cell indicates the data for penalizing a planning unit
when it is allocated to a given zone.</p></dd>


<dt><code>data</code> as a <code><a href="https://rdrr.io/pkg/raster/man/Raster-classes.html" class="external-link">Raster</a></code> object</dt>
<dd><p>containing values for planning
units. This format is only
compatible if the planning units in the argument to <code>x</code> are
<code><a href="https://rdrr.io/pkg/sp/man/Spatial-class.html" class="external-link">Spatial</a></code>, <code><a href="https://r-spatial.github.io/sf/reference/sf.html" class="external-link">sf::sf()</a></code>, or
<code><a href="https://rdrr.io/pkg/raster/man/Raster-classes.html" class="external-link">Raster</a></code> objects.
If the planning unit data are a <code><a href="https://rdrr.io/pkg/sp/man/Spatial-class.html" class="external-link">Spatial</a></code> or
<code><a href="https://r-spatial.github.io/sf/reference/sf.html" class="external-link">sf::sf()</a></code> object, then the values are calculated by overlaying the
planning units with the argument to <code>data</code> and calculating the sum of the
values associated with each planning unit.
If the planning unit data are a
<code><a href="https://rdrr.io/pkg/raster/man/Raster-classes.html" class="external-link">Raster</a></code> object then the values are calculated by extracting the
cell
values (note that the planning unit data and the argument to <code>data</code> must
have exactly the same dimensionality, extent, and missingness).
For problems involving multiple zones, the argument to <code>data</code> must
contain a layer for each zone.</p></dd>



</dl></div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p>See <a href="constraints.html">constraints</a> for an overview of all functions for adding constraints.</p>
<p>Other constraints: 
<code><a href="add_contiguity_constraints.html">add_contiguity_constraints</a>()</code>,
<code><a href="add_feature_contiguity_constraints.html">add_feature_contiguity_constraints</a>()</code>,
<code><a href="add_locked_in_constraints.html">add_locked_in_constraints</a>()</code>,
<code><a href="add_locked_out_constraints.html">add_locked_out_constraints</a>()</code>,
<code><a href="add_mandatory_allocation_constraints.html">add_mandatory_allocation_constraints,ConservationProblem-method</a></code>,
<code><a href="add_manual_bounded_constraints.html">add_manual_bounded_constraints</a>()</code>,
<code><a href="add_manual_locked_constraints.html">add_manual_locked_constraints</a>()</code>,
<code><a href="add_neighbor_constraints.html">add_neighbor_constraints</a>()</code></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="co"># load data</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">sim_pu_raster</span>, <span class="va">sim_features</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># \dontrun{</span></span>
<span class="r-in"><span class="co"># create a baseline problem with minimum shortfall objective</span></span>
<span class="r-in"><span class="va">p0</span> <span class="op">&lt;-</span> <span class="fu"><a href="problem.html">problem</a></span><span class="op">(</span><span class="va">sim_pu_raster</span>, <span class="va">sim_features</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span>
<span class="r-in">      <span class="fu"><a href="add_min_shortfall_objective.html">add_min_shortfall_objective</a></span><span class="op">(</span><span class="fl">1800</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span>
<span class="r-in">      <span class="fu"><a href="add_relative_targets.html">add_relative_targets</a></span><span class="op">(</span><span class="fl">0.2</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span>
<span class="r-in">      <span class="fu"><a href="add_binary_decisions.html">add_binary_decisions</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span>
<span class="r-in">      <span class="fu"><a href="add_default_solver.html">add_default_solver</a></span><span class="op">(</span>verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># solve problem</span></span>
<span class="r-in"><span class="va">s0</span> <span class="op">&lt;-</span> <span class="fu"><a href="solve.html">solve</a></span><span class="op">(</span><span class="va">p0</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># plot solution</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">s0</span>, main <span class="op">=</span> <span class="st">"solution"</span>, axes <span class="op">=</span> <span class="cn">FALSE</span>, box <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span class="r-plt img"><img src="add_linear_constraints-1.png" alt="" width="700" height="433"></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># now let's create some modified versions of this baseline problem by</span></span>
<span class="r-in"><span class="co"># adding additional criteria using linear constraints</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># first, let's create a modified version of p0 that contains</span></span>
<span class="r-in"><span class="co"># an additional budget of 1600 based on a secondary cost dataset</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># create a secondary cost dataset by simulating values</span></span>
<span class="r-in"><span class="co"># (note this requires the RandomFields package to be installed)</span></span>
<span class="r-in"><span class="va">sim_pu_raster2</span> <span class="op">&lt;-</span> <span class="fu"><a href="simulate_cost.html">simulate_cost</a></span><span class="op">(</span><span class="va">sim_pu_raster</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># plot the primary cost dataset (sim_pu_raster) and</span></span>
<span class="r-in"><span class="co"># the secondary cost dataset (sim_pu_raster2)</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/stack.html" class="external-link">stack</a></span><span class="op">(</span><span class="va">sim_pu_raster</span>, <span class="va">sim_pu_raster2</span><span class="op">)</span>,</span>
<span class="r-in">     main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sim_pu_raster"</span>, <span class="st">"sim_pu_raster2"</span><span class="op">)</span>,</span>
<span class="r-in">     axes <span class="op">=</span> <span class="cn">FALSE</span>, box <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span class="r-plt img"><img src="add_linear_constraints-2.png" alt="" width="700" height="433"></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># create a modified version of p0 with linear constraints that</span></span>
<span class="r-in"><span class="co"># specify that the planning units in the solution must not have</span></span>
<span class="r-in"><span class="co"># values in sim_pu_raster2 that sum to a total greater than 1600</span></span>
<span class="r-in"><span class="va">p1</span> <span class="op">&lt;-</span> <span class="va">p0</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span>
<span class="r-in">      <span class="fu">add_linear_constraints</span><span class="op">(</span>threshold <span class="op">=</span> <span class="fl">1600</span>,</span>
<span class="r-in">                             sense <span class="op">=</span> <span class="st">"&lt;="</span>,</span>
<span class="r-in">                             data <span class="op">=</span> <span class="va">sim_pu_raster2</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># solve problem</span></span>
<span class="r-in"><span class="va">s1</span> <span class="op">&lt;-</span> <span class="fu"><a href="solve.html">solve</a></span><span class="op">(</span><span class="va">p1</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># plot solutions s1 and s2 to compare them</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/stack.html" class="external-link">stack</a></span><span class="op">(</span><span class="va">s0</span>, <span class="va">s1</span><span class="op">)</span>, main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"s0"</span>, <span class="st">"s1"</span><span class="op">)</span>, axes <span class="op">=</span> <span class="cn">FALSE</span>, box <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span class="r-plt img"><img src="add_linear_constraints-3.png" alt="" width="700" height="433"></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># second, let's create a modified version of p0 that contains</span></span>
<span class="r-in"><span class="co"># additional constraints to ensure that each feature has</span></span>
<span class="r-in"><span class="co"># at least 8% of its overall distribution represented by the solution</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># to achieve this, we need to calculate the total amount of each feature</span></span>
<span class="r-in"><span class="co"># within the planning units so we can, in turn, set the constraint thresholds</span></span>
<span class="r-in"><span class="va">feat_abund</span> <span class="op">&lt;-</span> <span class="fu"><a href="feature_abundances.html">feature_abundances</a></span><span class="op">(</span><span class="va">p0</span><span class="op">)</span><span class="op">$</span><span class="va">absolute_abundance</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># create a modified version of p0 with additional constraints for each</span></span>
<span class="r-in"><span class="co"># feature to specify that the planning units in the solution must</span></span>
<span class="r-in"><span class="co"># secure at least 8% of the total abundance for each feature</span></span>
<span class="r-in"><span class="va">p2</span> <span class="op">&lt;-</span> <span class="va">p0</span></span>
<span class="r-in"><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/nlayers.html" class="external-link">nlayers</a></span><span class="op">(</span><span class="va">sim_features</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in">  <span class="va">p2</span> <span class="op">&lt;-</span> <span class="va">p2</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span>
<span class="r-in">        <span class="fu">add_linear_constraints</span><span class="op">(</span>threshold <span class="op">=</span> <span class="va">feat_abund</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">*</span> <span class="fl">0.08</span>,</span>
<span class="r-in">                               sense <span class="op">=</span> <span class="st">"&gt;="</span>,</span>
<span class="r-in">                               data <span class="op">=</span> <span class="va">sim_features</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span class="r-in"><span class="op">}</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># overall, p2 could be described as an optimization problem</span></span>
<span class="r-in"><span class="co"># that maximizes feature representation as much as possible</span></span>
<span class="r-in"><span class="co"># towards securing 20% of the total amount of each feature,</span></span>
<span class="r-in"><span class="co"># whilst ensuring that (i) the total cost of the solution does</span></span>
<span class="r-in"><span class="co"># not exceed 1800 (per cost values in sim_pu_raster) and (ii)</span></span>
<span class="r-in"><span class="co"># the solution secures at least 8% of the total amount of each feature</span></span>
<span class="r-in"><span class="co"># (if 20% is not possible due to the budget)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># solve problem</span></span>
<span class="r-in"><span class="va">s2</span> <span class="op">&lt;-</span> <span class="fu"><a href="solve.html">solve</a></span><span class="op">(</span><span class="va">p2</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># plot solutions s0 and s2 to compare them</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/stack.html" class="external-link">stack</a></span><span class="op">(</span><span class="va">s0</span>, <span class="va">s2</span><span class="op">)</span>, main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"s1"</span>, <span class="st">"s2"</span><span class="op">)</span>, axes <span class="op">=</span> <span class="cn">FALSE</span>, box <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span class="r-plt img"><img src="add_linear_constraints-4.png" alt="" width="700" height="433"></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># third, let's create a modified version of p0 that contains</span></span>
<span class="r-in"><span class="co"># additional constraints to ensure that the solution equitably</span></span>
<span class="r-in"><span class="co"># distributes conservation effort across different administrative areas</span></span>
<span class="r-in"><span class="co"># (e.g., countries) within the study region</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># to begin with, we will simulate a dataset describing the spatial extent of</span></span>
<span class="r-in"><span class="co"># four different administrative areas across the study region</span></span>
<span class="r-in"><span class="va">sim_admin</span> <span class="op">&lt;-</span> <span class="va">sim_pu_raster</span></span>
<span class="r-in"><span class="va">sim_admin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sp/man/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span><span class="va">sim_admin</span>, fact <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/pkg/raster/man/getValues.html" class="external-link">values</a></span><span class="op">(</span><span class="va">sim_admin</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/getValues.html" class="external-link">values</a></span><span class="op">(</span><span class="va">sim_admin</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="va">sim_admin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/resample.html" class="external-link">resample</a></span><span class="op">(</span><span class="va">sim_admin</span>, <span class="va">sim_pu_raster</span>, method <span class="op">=</span> <span class="st">"ngb"</span><span class="op">)</span></span>
<span class="r-in"><span class="va">sim_admin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/mask.html" class="external-link">mask</a></span><span class="op">(</span><span class="va">sim_admin</span>, <span class="va">sim_pu_raster</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># plot administrative areas layer,</span></span>
<span class="r-in"><span class="co"># we can see that the administrative areas subdivide</span></span>
<span class="r-in"><span class="co"># the study region into four quadrants, and the sim_admin object is a</span></span>
<span class="r-in"><span class="co"># RasterLayer with integer values denoting ids for the administrative areas</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sim_admin</span><span class="op">)</span></span>
<span class="r-plt img"><img src="add_linear_constraints-5.png" alt="" width="700" height="433"></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># next we will convert the sim_admin RasterLayer object into a RasterStack</span></span>
<span class="r-in"><span class="co"># object (with a layer for each administrative area) indicating which</span></span>
<span class="r-in"><span class="co"># planning units belong to each administrative area using binary</span></span>
<span class="r-in"><span class="co"># (presence/absence) values</span></span>
<span class="r-in"><span class="va">sim_admin2</span> <span class="op">&lt;-</span> <span class="fu"><a href="binary_stack.html">binary_stack</a></span><span class="op">(</span><span class="va">sim_admin</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># plot administrative areas stack</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sim_admin2</span><span class="op">)</span></span>
<span class="r-plt img"><img src="add_linear_constraints-6.png" alt="" width="700" height="433"></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># we will now calculate the total amount of planning units associated</span></span>
<span class="r-in"><span class="co"># with each administrative area, so that we can set the constraint threshold</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># since we are using raster data, we won't bother explicitly</span></span>
<span class="r-in"><span class="co"># accounting for the total area of each planning unit (because all</span></span>
<span class="r-in"><span class="co"># planning units have the same area in raster formats) -- but if we were</span></span>
<span class="r-in"><span class="co"># using vector data then we would need to account for the area of each unit</span></span>
<span class="r-in"><span class="va">admin_total</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="fu"><a href="rij_matrix.html">rij_matrix</a></span><span class="op">(</span><span class="va">sim_pu_raster</span>, <span class="va">sim_admin2</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># create a modified version of p0 with additional constraints for each</span></span>
<span class="r-in"><span class="co"># administrative area to specify that the planning units in the solution must</span></span>
<span class="r-in"><span class="co"># not encompass more than 10% of the total extent of the administrative</span></span>
<span class="r-in"><span class="co"># area</span></span>
<span class="r-in"><span class="va">p3</span> <span class="op">&lt;-</span> <span class="va">p0</span></span>
<span class="r-in"><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/nlayers.html" class="external-link">nlayers</a></span><span class="op">(</span><span class="va">sim_admin2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in">  <span class="va">p3</span> <span class="op">&lt;-</span> <span class="va">p3</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span>
<span class="r-in">        <span class="fu">add_linear_constraints</span><span class="op">(</span>threshold <span class="op">=</span> <span class="va">admin_total</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">*</span> <span class="fl">0.1</span>,</span>
<span class="r-in">                               sense <span class="op">=</span> <span class="st">"&lt;="</span>,</span>
<span class="r-in">                               data <span class="op">=</span> <span class="va">sim_admin2</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span class="r-in"><span class="op">}</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># solve problem</span></span>
<span class="r-in"><span class="va">s3</span> <span class="op">&lt;-</span> <span class="fu"><a href="solve.html">solve</a></span><span class="op">(</span><span class="va">p3</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># plot solutions s0 and s3 to compare them</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/stack.html" class="external-link">stack</a></span><span class="op">(</span><span class="va">s0</span>, <span class="va">s3</span><span class="op">)</span>, main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"s0"</span>, <span class="st">"s3"</span><span class="op">)</span>, axes <span class="op">=</span> <span class="cn">FALSE</span>, box <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span class="r-plt img"><img src="add_linear_constraints-7.png" alt="" width="700" height="433"></span>
<span class="r-in"><span class="co"># }</span></span>
<span class="r-in"></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by <a href="https://jeffrey-hanson.com" class="external-link">Jeffrey O Hanson</a>, <a href="http://www.richard-schuster.com" class="external-link">Richard Schuster</a>, Nina Morrell, <a href="http://strimas.com" class="external-link">Matthew Strimas-Mackey</a>, Brandon P M Edwards, Matthew E Watts, <a href="https://arcese.forestry.ubc.ca" class="external-link">Peter Arcese</a>, <a href="https://josephrbennett.wordpress.com" class="external-link">Joseph Bennett</a>, <a href="http://www.possinghamlab.org" class="external-link">Hugh P Possingham</a>.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer></div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '486efa122ea6783724263412c5f28ab3',
    indexName: 'prioritizr',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script></body></html>

