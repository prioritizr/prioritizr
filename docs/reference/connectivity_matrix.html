<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Create a matrix showing the connectivity between planning units. Connectivity
is calculated as the average conductance of two planning units multiplied
by the amount of shared boundary between the two planning units. Thus
planning units that each have higher a conductance and share a greater
boundary are associated with greater connectivity."><title>Connectivity matrix — connectivity_matrix • prioritizr</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Connectivity matrix — connectivity_matrix"><meta property="og:description" content="Create a matrix showing the connectivity between planning units. Connectivity
is calculated as the average conductance of two planning units multiplied
by the amount of shared boundary between the two planning units. Thus
planning units that each have higher a conductance and share a greater
boundary are associated with greater connectivity."><meta property="og:image" content="https://prioritizr.net/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-70466840-4"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-70466840-4');
</script></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">prioritizr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">8.0.3</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/prioritizr.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/package_overview.html">Package overview</a>
    <a class="dropdown-item" href="../articles/gurobi_installation_guide.html">Gurobi installation guide</a>
    <a class="dropdown-item" href="../articles/solver_benchmarks.html">Solver benchmarks</a>
    <a class="dropdown-item" href="../articles/publication_record.html">Publication record</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-tutorials">Tutorials</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-tutorials">
    <a class="dropdown-item" href="../articles/connectivity_tutorial.html">Connectivity</a>
    <a class="dropdown-item" href="../articles/calibrating_trade-offs_tutorial.html">Calibrating trade-offs</a>
    <a class="dropdown-item" href="../articles/management_zones_tutorial.html">Management zones</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/prioritizr/prioritizr/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Connectivity matrix</h1>
      <small class="dont-index">Source: <a href="https://github.com/prioritizr/prioritizr/blob/HEAD/R/connectivity_matrix.R" class="external-link"><code>R/connectivity_matrix.R</code></a></small>
      <div class="d-none name"><code>connectivity_matrix.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Create a matrix showing the connectivity between planning units. Connectivity
is calculated as the average conductance of two planning units multiplied
by the amount of shared boundary between the two planning units. Thus
planning units that each have higher a conductance and share a greater
boundary are associated with greater connectivity.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">connectivity_matrix</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for Spatial,Raster</span></span>
<span><span class="fu">connectivity_matrix</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for Spatial,character</span></span>
<span><span class="fu">connectivity_matrix</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for sf,character</span></span>
<span><span class="fu">connectivity_matrix</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for sf,Raster</span></span>
<span><span class="fu">connectivity_matrix</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for sf,SpatRaster</span></span>
<span><span class="fu">connectivity_matrix</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for Raster,Raster</span></span>
<span><span class="fu">connectivity_matrix</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for SpatRaster,SpatRaster</span></span>
<span><span class="fu">connectivity_matrix</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>x</dt>
<dd><p><code><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">terra::rast()</a></code> or <code><a href="https://r-spatial.github.io/sf/reference/sf.html" class="external-link">sf::sf()</a></code> object representing planning units.</p></dd>


<dt>y</dt>
<dd><p><code><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">terra::rast()</a></code> object showing the conductance
of different areas across the study area, or a <code>character</code> object
denoting a column name in the attribute table of <code>x</code> that contains
the conductance values. Note that argument to <code>y</code> can only be a
<code>character</code> object if the argument to <code>x</code> is a <code><a href="https://r-spatial.github.io/sf/reference/sf.html" class="external-link">sf::sf()</a></code> object.
Also, note that if the argument to <code>x</code> is a
<code><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">terra::rast()</a></code> object then
argument to <code>y</code> must have the same spatial properties as it
(i.e., coordinate system, extent, resolution).</p></dd>


<dt>...</dt>
<dd><p>additional arguments passed to <code><a href="fast_extract.html">fast_extract()</a></code> for
extracting and calculating the conductance values for each planning unit.
These arguments are only used if argument to <code>x</code> is a
<code><a href="https://r-spatial.github.io/sf/reference/sf.html" class="external-link">sf::sf()</a></code> object and argument to <code>y</code> is a <code><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">terra::rast()</a></code> object.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A <code><a href="https://rdrr.io/pkg/Matrix/man/dsCMatrix-class.html" class="external-link">dsCMatrix</a></code> symmetric sparse matrix object.
Each row and column represents a planning unit.
Cells values indicate the connectivity between different pairs of planning
units.
To reduce computational burden, cells among the matrix diagonal are
set to zero. Furthermore, if the argument to <code>x</code> is a
<code><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">terra::rast()</a></code> object, then cells with missing (<code>NA</code>)
values are set to zero too.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Shared boundary calculations are performed using
<code><a href="boundary_matrix.html">boundary_matrix()</a></code>.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Connectivity matrix data might need rescaling to improve optimization
performance, see <code><a href="rescale_matrix.html">rescale_matrix()</a></code> to perform these calculations.</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># load data</span></span></span>
<span class="r-in"><span><span class="va">sim_pu_raster</span> <span class="op">&lt;-</span> <span class="fu"><a href="sim_data.html">get_sim_pu_raster</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sim_pu_polygons</span> <span class="op">&lt;-</span> <span class="fu"><a href="sim_data.html">get_sim_pu_polygons</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sim_features</span> <span class="op">&lt;-</span> <span class="fu"><a href="sim_data.html">get_sim_features</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># create connectivity matrix using raster planning unit data using</span></span></span>
<span class="r-in"><span><span class="co"># the raster cost values to represent conductance</span></span></span>
<span class="r-in"><span><span class="co">## extract 9 planning units</span></span></span>
<span class="r-in"><span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/crop.html" class="external-link">crop</a></span><span class="op">(</span><span class="va">sim_pu_raster</span>, <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/ext.html" class="external-link">ext</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.3</span>, <span class="fl">0</span>, <span class="fl">0.3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## extract conductance data for the 9 planning units</span></span></span>
<span class="r-in"><span><span class="va">cd</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/crop.html" class="external-link">crop</a></span><span class="op">(</span><span class="va">sim_features</span>, <span class="va">r</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## make connectivity matrix using the habitat suitability data for the</span></span></span>
<span class="r-in"><span><span class="co">## second feature to represent the planning unit conductance data</span></span></span>
<span class="r-in"><span><span class="va">cm_raster</span> <span class="op">&lt;-</span> <span class="fu">connectivity_matrix</span><span class="op">(</span><span class="va">r</span>, <span class="va">cd</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## plot data and matrix</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">r</span>, main <span class="op">=</span> <span class="st">"planning units (raster)"</span>, axes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="connectivity_matrix-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cd</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, main <span class="op">=</span> <span class="st">"conductivity"</span>, axes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="connectivity_matrix-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu">Matrix</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/image.html" class="external-link">image</a></span><span class="op">(</span><span class="va">cm_raster</span>,  main <span class="op">=</span> <span class="st">"connectivity matrix"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="connectivity_matrix-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># create connectivity matrix using polygon planning unit data using</span></span></span>
<span class="r-in"><span><span class="co"># the habitat suitability data for the second feature to represent</span></span></span>
<span class="r-in"><span><span class="co"># planning unit conductances</span></span></span>
<span class="r-in"><span><span class="co">## subset data to 9 polygons</span></span></span>
<span class="r-in"><span><span class="va">ply</span> <span class="op">&lt;-</span> <span class="va">sim_pu_polygons</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="fl">11</span><span class="op">:</span><span class="fl">13</span>, <span class="fl">20</span><span class="op">:</span><span class="fl">22</span><span class="op">)</span>, <span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## make connectivity matrix</span></span></span>
<span class="r-in"><span><span class="va">cm_ply</span> <span class="op">&lt;-</span> <span class="fu">connectivity_matrix</span><span class="op">(</span><span class="va">ply</span>, <span class="va">sim_features</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## plot data and matrix</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">ply</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"planning units (polygons)"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="connectivity_matrix-4.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/crop.html" class="external-link">crop</a></span><span class="op">(</span><span class="va">sim_features</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, <span class="va">ply</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"connectivity"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="connectivity_matrix-5.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu">Matrix</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/image.html" class="external-link">image</a></span><span class="op">(</span><span class="va">cm_ply</span>, main <span class="op">=</span> <span class="st">"connectivity matrix"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="connectivity_matrix-6.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># create connectivity matrix using habitat suitability data for each feature,</span></span></span>
<span class="r-in"><span><span class="co"># this could be useful if prioritizations should spatially clump</span></span></span>
<span class="r-in"><span><span class="co"># together adjacent planning units that have suitable habitat</span></span></span>
<span class="r-in"><span><span class="co"># for the same species (e.g., to maintain functional connectivity)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## let's use the raster data for this example, and we can generate the</span></span></span>
<span class="r-in"><span><span class="co">## connectivity matrix that we would use in the prioritization by</span></span></span>
<span class="r-in"><span><span class="co">## (1) generating a connectivity matrix for each feature separately, and</span></span></span>
<span class="r-in"><span><span class="co">## and then (2) summing the values together</span></span></span>
<span class="r-in"><span><span class="va">cm_sum</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/as.list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="va">cd</span><span class="op">)</span>, <span class="va">connectivity_matrix</span>, x <span class="op">=</span> <span class="va">r</span><span class="op">)</span> <span class="co"># make matrices</span></span></span>
<span class="r-in"><span><span class="va">cm_sum</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/funprog.html" class="external-link">Reduce</a></span><span class="op">(</span><span class="st">"+"</span>, <span class="va">cm_sum</span><span class="op">)</span> <span class="co"># sum matrices together</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## plot data and matrix</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">r</span>, main <span class="op">=</span> <span class="st">"planning units (raster)"</span>, axes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="connectivity_matrix-7.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu">Matrix</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/image.html" class="external-link">image</a></span><span class="op">(</span><span class="va">cm_sum</span>, main <span class="op">=</span> <span class="st">"connectivity matrix"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="connectivity_matrix-8.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## we could take this example one step further, and use weights to indicate</span></span></span>
<span class="r-in"><span><span class="co">## relative importance of maintaining functional connectivity</span></span></span>
<span class="r-in"><span><span class="co">## for each feature (i.e., use the weighted sum instead of the sum)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## let's pretend that the first feature is 20 times more important</span></span></span>
<span class="r-in"><span><span class="co">## than all the other species</span></span></span>
<span class="r-in"><span><span class="va">weights</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## calculate connectivity matrix using weighted sum</span></span></span>
<span class="r-in"><span><span class="va">cm_wsum</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/as.list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="va">cd</span><span class="op">)</span>, <span class="va">connectivity_matrix</span>, x <span class="op">=</span> <span class="va">r</span><span class="op">)</span> <span class="co"># make matrices</span></span></span>
<span class="r-in"><span><span class="va">cm_wsum</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/funprog.html" class="external-link">Map</a></span><span class="op">(</span><span class="st">"*"</span>, <span class="va">cm_wsum</span>, <span class="va">weights</span><span class="op">)</span> <span class="co"># multiply by weights</span></span></span>
<span class="r-in"><span><span class="va">cm_wsum</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/funprog.html" class="external-link">Reduce</a></span><span class="op">(</span><span class="st">"+"</span>, <span class="va">cm_wsum</span><span class="op">)</span> <span class="co"># sum matrices together</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## plot data and matrix</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">r</span>, main <span class="op">=</span> <span class="st">"planning units (raster)"</span>, axes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="connectivity_matrix-9.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu">Matrix</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/image.html" class="external-link">image</a></span><span class="op">(</span><span class="va">cm_wsum</span>, main <span class="op">=</span> <span class="st">"connectivity matrix"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="connectivity_matrix-10.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## since the statistical distribution of the connectivity values</span></span></span>
<span class="r-in"><span><span class="co">## for each feature (e.g., the mean and standard deviation of the</span></span></span>
<span class="r-in"><span><span class="co">## connectivity values) are different, it might make sense -- depending</span></span></span>
<span class="r-in"><span><span class="co">## on the goal of the conservation planning exercise and the underlying</span></span></span>
<span class="r-in"><span><span class="co">## data -- to first normalize the conductance values before applying the</span></span></span>
<span class="r-in"><span><span class="co">## weights and summing the data for feature together</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">### calculate functional connectivity matrix using the weighted sum of</span></span></span>
<span class="r-in"><span><span class="co">### connectivity values that have been normalized by linearly re-scaling</span></span></span>
<span class="r-in"><span><span class="co">### values</span></span></span>
<span class="r-in"><span><span class="va">cm_lwsum</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/as.list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="va">cd</span><span class="op">)</span>, <span class="va">connectivity_matrix</span>, x <span class="op">=</span> <span class="va">r</span><span class="op">)</span> <span class="co"># make matrices</span></span></span>
<span class="r-in"><span><span class="va">cm_lwsum</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">cm_lwsum</span>, <span class="va">rescale_matrix</span>, max <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="co"># rescale matrices</span></span></span>
<span class="r-in"><span><span class="va">cm_lwsum</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/funprog.html" class="external-link">Map</a></span><span class="op">(</span><span class="st">"*"</span>, <span class="va">cm_lwsum</span>, <span class="va">weights</span><span class="op">)</span> <span class="co"># multiply by weights</span></span></span>
<span class="r-in"><span><span class="va">cm_lwsum</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/funprog.html" class="external-link">Reduce</a></span><span class="op">(</span><span class="st">"+"</span>, <span class="va">cm_lwsum</span><span class="op">)</span> <span class="co"># sum matrices together</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## plot data and matrix</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">r</span>, main <span class="op">=</span> <span class="st">"planning units (raster)"</span>, axes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="connectivity_matrix-11.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu">Matrix</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/image.html" class="external-link">image</a></span><span class="op">(</span><span class="va">cm_lwsum</span>, main <span class="op">=</span> <span class="st">"connectivity matrix"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="connectivity_matrix-12.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## another approach for normalizing the data could be using z-scores</span></span></span>
<span class="r-in"><span><span class="co">## note that after normalizing the data we would need to add a constant</span></span></span>
<span class="r-in"><span><span class="co">## value so that none of the connectivity values are negative</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">### define helper functions</span></span></span>
<span class="r-in"><span><span class="va">zscore</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span><span class="va">x</span><span class="op">@</span><span class="va">x</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">x</span><span class="op">@</span><span class="va">x</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/summarize-generics.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">@</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">x</span><span class="op">@</span><span class="va">x</span><span class="op">)</span>; <span class="va">x</span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="va">min_non_zero_value</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">x</span><span class="op">@</span><span class="va">x</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">add_non_zero_value</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span><span class="va">x</span><span class="op">@</span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">@</span><span class="va">x</span> <span class="op">+</span> <span class="va">y</span>; <span class="va">x</span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">### calculate functional connectivity matrix using the weighted sum of</span></span></span>
<span class="r-in"><span><span class="co">### connectivity values that have been normalized using z-scores,</span></span></span>
<span class="r-in"><span><span class="co">### and transformed to account for negative values</span></span></span>
<span class="r-in"><span><span class="va">cm_zwsum</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/as.list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="va">cd</span><span class="op">)</span>, <span class="va">connectivity_matrix</span>, x <span class="op">=</span> <span class="va">r</span><span class="op">)</span> <span class="co"># make matrices</span></span></span>
<span class="r-in"><span><span class="va">cm_zwsum</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">cm_zwsum</span>, <span class="va">zscore</span><span class="op">)</span> <span class="co"># normalize using z-scores</span></span></span>
<span class="r-in"><span><span class="va">min_value</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">cm_zwsum</span>, <span class="va">min_non_zero_value</span><span class="op">)</span><span class="op">)</span> <span class="co"># find min value</span></span></span>
<span class="r-in"><span><span class="va">min_value</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">min_value</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0.01</span> <span class="co"># prepare constant for adding to matrices</span></span></span>
<span class="r-in"><span><span class="va">cm_zwsum</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">cm_zwsum</span>, <span class="va">add_non_zero_value</span>, <span class="va">min_value</span><span class="op">)</span> <span class="co"># add constant</span></span></span>
<span class="r-in"><span><span class="va">cm_zwsum</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/funprog.html" class="external-link">Map</a></span><span class="op">(</span><span class="st">"*"</span>, <span class="va">cm_zwsum</span>, <span class="va">weights</span><span class="op">)</span> <span class="co"># multiply by weights</span></span></span>
<span class="r-in"><span><span class="va">cm_zwsum</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/funprog.html" class="external-link">Reduce</a></span><span class="op">(</span><span class="st">"+"</span>, <span class="va">cm_zwsum</span><span class="op">)</span> <span class="co"># sum matrices together</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## plot data and matrix</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">r</span>, main <span class="op">=</span> <span class="st">"planning units (raster)"</span>, axes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="connectivity_matrix-13.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu">Matrix</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/image.html" class="external-link">image</a></span><span class="op">(</span><span class="va">cm_zwsum</span>, main <span class="op">=</span> <span class="st">"connectivity matrix"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="connectivity_matrix-14.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by <a href="https://jeffrey-hanson.com" class="external-link">Jeffrey O Hanson</a>, <a href="http://www.richard-schuster.com" class="external-link">Richard Schuster</a>, Nina Morrell, <a href="http://strimas.com" class="external-link">Matthew Strimas-Mackey</a>, Brandon P M Edwards, Matthew E Watts, <a href="https://arcese.forestry.ubc.ca" class="external-link">Peter Arcese</a>, <a href="https://josephrbennett.wordpress.com" class="external-link">Joseph Bennett</a>, <a href="http://www.possinghamlab.org" class="external-link">Hugh P Possingham</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

