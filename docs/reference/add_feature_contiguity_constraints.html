<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Add constraints to a problem to ensure that each feature is
represented in a contiguous unit of dispersible habitat. These constraints
are a more advanced version of those implemented in the
add_contiguity_constraints() function, because they ensure that
each feature is represented in a contiguous unit and not that the entire
solution should form a contiguous unit. Additionally, this function
can use data showing the distribution of dispersible habitat for each
feature to ensure that all features can disperse throughout the areas
designated for their conservation."><title>Add feature contiguity constraints — add_feature_contiguity_constraints • prioritizr</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Add feature contiguity constraints — add_feature_contiguity_constraints"><meta property="og:description" content="Add constraints to a problem to ensure that each feature is
represented in a contiguous unit of dispersible habitat. These constraints
are a more advanced version of those implemented in the
add_contiguity_constraints() function, because they ensure that
each feature is represented in a contiguous unit and not that the entire
solution should form a contiguous unit. Additionally, this function
can use data showing the distribution of dispersible habitat for each
feature to ensure that all features can disperse throughout the areas
designated for their conservation."><meta property="og:image" content="https://prioritizr.net/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-70466840-4"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-70466840-4');
</script></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">prioritizr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">8.0.2.7</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/prioritizr.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/package_overview.html">Package overview</a>
    <a class="dropdown-item" href="../articles/gurobi_installation_guide.html">Gurobi installation guide</a>
    <a class="dropdown-item" href="../articles/solver_benchmarks.html">Solver benchmarks</a>
    <a class="dropdown-item" href="../articles/publication_record.html">Publication record</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-tutorials">Tutorials</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-tutorials">
    <a class="dropdown-item" href="../articles/connectivity_tutorial.html">Connectivity</a>
    <a class="dropdown-item" href="../articles/calibrating_trade-offs_tutorial.html">Calibrating trade-offs</a>
    <a class="dropdown-item" href="../articles/management_zones_tutorial.html">Management zones</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/prioritizr/prioritizr/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Add feature contiguity constraints</h1>
      <small class="dont-index">Source: <a href="https://github.com/prioritizr/prioritizr/blob/HEAD/R/add_feature_contiguity_constraints.R" class="external-link"><code>R/add_feature_contiguity_constraints.R</code></a></small>
      <div class="d-none name"><code>add_feature_contiguity_constraints.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Add constraints to a problem to ensure that each feature is
represented in a contiguous unit of dispersible habitat. These constraints
are a more advanced version of those implemented in the
<code><a href="add_contiguity_constraints.html">add_contiguity_constraints()</a></code> function, because they ensure that
each feature is represented in a contiguous unit and not that the entire
solution should form a contiguous unit. Additionally, this function
can use data showing the distribution of dispersible habitat for each
feature to ensure that all features can disperse throughout the areas
designated for their conservation.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="co"># S4 method for ConservationProblem,ANY,data.frame</span></span>
<span><span class="fu">add_feature_contiguity_constraints</span><span class="op">(</span><span class="va">x</span>, <span class="va">zones</span>, <span class="va">data</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for ConservationProblem,ANY,matrix</span></span>
<span><span class="fu">add_feature_contiguity_constraints</span><span class="op">(</span><span class="va">x</span>, <span class="va">zones</span>, <span class="va">data</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for ConservationProblem,ANY,ANY</span></span>
<span><span class="fu">add_feature_contiguity_constraints</span><span class="op">(</span><span class="va">x</span>, <span class="va">zones</span>, <span class="va">data</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>x</dt>
<dd><p><code><a href="problem.html">problem()</a></code> object.</p></dd>


<dt>zones</dt>
<dd><p><code>matrix</code>, <code>Matrix</code> or <code>list</code> object describing
the connection scheme for different zones. For <code>matrix</code> or
and <code>Matrix</code> arguments, each row and column corresponds
to a different zone in the argument to <code>x</code>, and cell values must
contain binary <code>numeric</code> values (i.e., one or zero) that indicate
if connected planning units (as specified in the argument to
<code>data</code>) should be still considered connected if they are allocated to
different zones. The cell values along the diagonal
of the matrix indicate if planning units should be subject to
contiguity constraints when they are allocated to a given zone. Note
arguments to <code>zones</code> must be symmetric, and that a row or column has
a value of one then the diagonal element for that row or column must also
have a value of one. If the connection scheme between different zones
should differ among the features, then the argument to <code>zones</code> should
be a <code>list</code> of <code>matrix</code> or <code>Matrix</code> objects that shows the
specific scheme for each feature using the conventions described above.
The default argument to <code>zones</code> is an identity
matrix (i.e., a matrix with ones along the matrix diagonal and zeros
elsewhere), so that planning units are only considered connected if they
are both allocated to the same zone.</p></dd>


<dt>data</dt>
<dd><p><code>NULL</code>, <code>matrix</code>, <code>Matrix</code>, <code>data.frame</code>
or <code>list</code> of <code>matrix</code>, <code>Matrix</code>, or <code>data.frame</code>
objects. The argument to data shows which planning units should be treated
as being connected when implementing constraints to ensure that features
are represented in contiguous units. If different features have
different dispersal capabilities, then it may be desirable to specify
which sets of planning units should be treated as being connected
for which features using a <code>list</code> of objects. The default argument
is <code>NULL</code> which means that the connection data is calculated
automatically using the <code><a href="adjacency_matrix.html">adjacency_matrix()</a></code> function and so
all adjacent planning units are treated as being connected for all
features. See the Data format section for more information.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>An updated <code><a href="problem.html">problem()</a></code> object with the constraints added to it.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function uses connection data to identify solutions that
represent features in contiguous units of dispersible habitat.
It was inspired by the mathematical formulations detailed in
Önal and Briers (2006) and Cardeira <em>et al.</em> 2010. For an
example that has used these constraints, see Hanson <em>et al.</em> (2019).
Please note
that these constraints require the expanded formulation and therefore
cannot be used with feature data that have negative vales.
<strong>Please note that adding these constraints to a problem will
drastically increase the amount of time required to solve it.</strong></p>
    </div>
    <div class="section level2">
    <h2 id="data-format">Data format<a class="anchor" aria-label="anchor" href="#data-format"></a></h2>
    


<p>The argument to <code>data</code> can be specified using the following formats.</p>
<dl><dt><code>data</code> as a <code>NULL</code> value</dt>
<dd><p>connection
data should be calculated automatically
using the <code><a href="adjacency_matrix.html">adjacency_matrix()</a></code> function. This is the default
argument and means that all adjacent planning units are treated
as potentially dispersible for all features.
Note that the connection data must be manually defined
using one of the other formats below when the planning unit data
in the argument to <code>x</code> is not spatially referenced (e.g.,
in <code>data.frame</code> or <code>numeric</code> format).</p></dd>


<dt><code>data</code> as a<code>matrix</code>/<code>Matrix</code> object</dt>
<dd><p>where rows and columns represent
different planning units and the value of each cell indicates if the
two planning units are connected or not. Cell values should be binary
<code>numeric</code> values (i.e., one or zero). Cells that occur along the
matrix diagonal have no effect on the solution at all because each
planning unit cannot be a connected with itself. Note that pairs
of connected planning units are treated as being potentially dispersible
for all features.</p></dd>


<dt><code>data</code> as a <code>data.frame</code> object</dt>
<dd><p>containing columns that are named
<code>"id1"</code>, <code>"id2"</code>, and <code>"boundary"</code>. Here, each row
denotes the connectivity between two planning units following the
<em>Marxan</em> format. The <code>"boundary"</code> column should contain
binary <code>numeric</code> values that indicate if the two planning units
specified in the <code>"id1"</code> and <code>"id2"</code> columns are connected
or not. This data can be used to describe symmetric or
asymmetric relationships between planning units. By default,
input data is assumed to be symmetric unless asymmetric data is
also included (e.g., if data is present for planning units 2 and 3, then
the same amount of connectivity is expected for planning units 3 and 2,
unless connectivity data is also provided for planning units 3 and 2).
Note that pairs of connected planning units are treated as being
potentially dispersible for all features.</p></dd>


<dt><code>data</code> as a <code>list</code> object</dt>
<dd><p>containing <code>matrix</code>, <code>Matrix</code>, or
<code>data.frame</code> objects showing which planning units
should be treated as connected for each feature. Each element in the
<code>list</code> should correspond to a different feature (specifically,
a different target in the problem), and should contain a <code>matrix</code>,
<code>Matrix</code>, or <code>data.frame</code> object that follows the conventions
detailed above.</p></dd>



</dl></div>
    <div class="section level2">
    <h2 id="notes">Notes<a class="anchor" aria-label="anchor" href="#notes"></a></h2>
    

<p>In early versions, it was named as the <code>add_corridor_constraints</code> function.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Önal H and Briers RA (2006) Optimal selection of a connected
reserve network. <em>Operations Research</em>, 54: 379--388.</p>
<p>Cardeira JO, Pinto LS, Cabeza M and Gaston KJ (2010) Species specific
connectivity in reserve-network design using graphs.
<em>Biological Conservation</em>, 2: 408--415.</p>
<p>Hanson JO, Fuller RA, &amp; Rhodes JR (2019) Conventional methods for enhancing
connectivity in conservation planning do not always maintain gene flow.
<em>Journal of Applied Ecology</em>, 56: 913--922.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>See <a href="constraints.html">constraints</a> for an overview of all functions for adding constraints.</p>
<p>Other constraints: 
<code><a href="add_contiguity_constraints.html">add_contiguity_constraints</a>()</code>,
<code><a href="add_linear_constraints.html">add_linear_constraints</a>()</code>,
<code><a href="add_locked_in_constraints.html">add_locked_in_constraints</a>()</code>,
<code><a href="add_locked_out_constraints.html">add_locked_out_constraints</a>()</code>,
<code><a href="add_mandatory_allocation_constraints.html">add_mandatory_allocation_constraints</a>()</code>,
<code><a href="add_manual_bounded_constraints.html">add_manual_bounded_constraints</a>()</code>,
<code><a href="add_manual_locked_constraints.html">add_manual_locked_constraints</a>()</code>,
<code><a href="add_neighbor_constraints.html">add_neighbor_constraints</a>()</code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># load data</span></span></span>
<span class="r-in"><span><span class="va">sim_pu_raster</span> <span class="op">&lt;-</span> <span class="fu"><a href="sim_data.html">get_sim_pu_raster</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sim_features</span> <span class="op">&lt;-</span> <span class="fu"><a href="sim_data.html">get_sim_features</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sim_zones_pu_raster</span> <span class="op">&lt;-</span> <span class="fu"><a href="sim_data.html">get_sim_zones_pu_raster</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sim_zones_features</span> <span class="op">&lt;-</span> <span class="fu"><a href="sim_data.html">get_sim_zones_features</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># create minimal problem</span></span></span>
<span class="r-in"><span><span class="va">p1</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="problem.html">problem</a></span><span class="op">(</span><span class="va">sim_pu_raster</span>, <span class="va">sim_features</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="add_min_set_objective.html">add_min_set_objective</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="add_relative_targets.html">add_relative_targets</a></span><span class="op">(</span><span class="fl">0.3</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="add_binary_decisions.html">add_binary_decisions</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="add_default_solver.html">add_default_solver</a></span><span class="op">(</span>verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># create problem with contiguity constraints</span></span></span>
<span class="r-in"><span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="va">p1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="add_contiguity_constraints.html">add_contiguity_constraints</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># create problem with constraints to represent features in contiguous</span></span></span>
<span class="r-in"><span><span class="co"># units</span></span></span>
<span class="r-in"><span><span class="va">p3</span> <span class="op">&lt;-</span> <span class="va">p1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">add_feature_contiguity_constraints</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># create problem with constraints to represent features in contiguous</span></span></span>
<span class="r-in"><span><span class="co"># units that contain highly suitable habitat values</span></span></span>
<span class="r-in"><span><span class="co"># (specifically in the top 5th percentile)</span></span></span>
<span class="r-in"><span><span class="va">cm4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/dimensions.html" class="external-link">nlyr</a></span><span class="op">(</span><span class="va">sim_features</span><span class="op">)</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="co"># create connectivity matrix using the i'th feature's habitat data</span></span></span>
<span class="r-in"><span>  <span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="connectivity_matrix.html">connectivity_matrix</a></span><span class="op">(</span><span class="va">sim_pu_raster</span>, <span class="va">sim_features</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="co"># convert matrix to 0/1 values denoting values in top 5th percentile</span></span></span>
<span class="r-in"><span>  <span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">m</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span>, <span class="fl">1</span> <span class="op">-</span> <span class="fl">0.05</span>, names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="co"># remove 0s from the sparse matrix</span></span></span>
<span class="r-in"><span>  <span class="va">m</span> <span class="op">&lt;-</span> <span class="fu">Matrix</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/drop0.html" class="external-link">drop0</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="co"># return matrix</span></span></span>
<span class="r-in"><span>  <span class="va">m</span></span></span>
<span class="r-in"><span><span class="op">}</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">p4</span> <span class="op">&lt;-</span> <span class="va">p1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">add_feature_contiguity_constraints</span><span class="op">(</span>data <span class="op">=</span> <span class="va">cm4</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># solve problems</span></span></span>
<span class="r-in"><span><span class="va">s1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="solve.html">solve</a></span><span class="op">(</span><span class="va">p1</span><span class="op">)</span>, <span class="fu"><a href="solve.html">solve</a></span><span class="op">(</span><span class="va">p2</span><span class="op">)</span>, <span class="fu"><a href="solve.html">solve</a></span><span class="op">(</span><span class="va">p3</span><span class="op">)</span>, <span class="fu"><a href="solve.html">solve</a></span><span class="op">(</span><span class="va">p4</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">s1</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="st">"basic solution"</span>, <span class="st">"contiguity constraints"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"feature contiguity constraints"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"feature contiguity constraints with data"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># plot solutions</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">s1</span>, axes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="add_feature_contiguity_constraints-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># create minimal problem with multiple zones, and limit the solver to</span></span></span>
<span class="r-in"><span><span class="co"># 30 seconds to obtain solutions in a feasible period of time</span></span></span>
<span class="r-in"><span><span class="va">p5</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="problem.html">problem</a></span><span class="op">(</span><span class="va">sim_zones_pu_raster</span>, <span class="va">sim_zones_features</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="add_min_set_objective.html">add_min_set_objective</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="add_relative_targets.html">add_relative_targets</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0.1</span>, ncol <span class="op">=</span> <span class="fl">3</span>, nrow <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="add_binary_decisions.html">add_binary_decisions</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="add_default_solver.html">add_default_solver</a></span><span class="op">(</span>time_limit <span class="op">=</span> <span class="fl">30</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># create problem with contiguity constraints that specify that the</span></span></span>
<span class="r-in"><span><span class="co"># planning units used to conserve each feature in different management</span></span></span>
<span class="r-in"><span><span class="co"># zones must form separate contiguous units</span></span></span>
<span class="r-in"><span><span class="va">p6</span> <span class="op">&lt;-</span> <span class="va">p5</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">add_feature_contiguity_constraints</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># create problem with contiguity constraints that specify that the</span></span></span>
<span class="r-in"><span><span class="co"># planning units used to conserve each feature must form a single</span></span></span>
<span class="r-in"><span><span class="co"># contiguous unit if the planning units are allocated to zones 1 and 2</span></span></span>
<span class="r-in"><span><span class="co"># and do not need to form a single contiguous unit if they are allocated</span></span></span>
<span class="r-in"><span><span class="co"># to zone 3</span></span></span>
<span class="r-in"><span><span class="va">zm7</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, ncol <span class="op">=</span> <span class="fl">3</span>, nrow <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">zm7</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">zm7</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      [,1] [,2] [,3]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,]    1    1    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,]    1    1    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,]    0    0    0</span>
<span class="r-in"><span><span class="va">p7</span> <span class="op">&lt;-</span> <span class="va">p5</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">add_feature_contiguity_constraints</span><span class="op">(</span><span class="va">zm7</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># create problem with contiguity constraints that specify that all of</span></span></span>
<span class="r-in"><span><span class="co"># the planning units in all three of the zones must conserve first feature</span></span></span>
<span class="r-in"><span><span class="co"># in a single contiguous unit but the planning units used to conserve the</span></span></span>
<span class="r-in"><span><span class="co"># remaining features do not need to be contiguous in any way</span></span></span>
<span class="r-in"><span><span class="va">zm8</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="number_of_features.html">number_of_features</a></span><span class="op">(</span><span class="va">sim_zones_features</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">i</span> <span class="op">==</span> <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">3</span>, nrow <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">zm8</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[1]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      [,1] [,2] [,3]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,]    1    1    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,]    1    1    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,]    1    1    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[2]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      [,1] [,2] [,3]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,]    0    0    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,]    0    0    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,]    0    0    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[3]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      [,1] [,2] [,3]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,]    0    0    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,]    0    0    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,]    0    0    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[4]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      [,1] [,2] [,3]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,]    0    0    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,]    0    0    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,]    0    0    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[5]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      [,1] [,2] [,3]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,]    0    0    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,]    0    0    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,]    0    0    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="va">p8</span> <span class="op">&lt;-</span> <span class="va">p5</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">add_feature_contiguity_constraints</span><span class="op">(</span><span class="va">zm8</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># solve problems</span></span></span>
<span class="r-in"><span><span class="va">s2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">p5</span>, <span class="va">p6</span>, <span class="va">p7</span>, <span class="va">p8</span><span class="op">)</span>, <span class="va">solve</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">s2</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">s2</span>, <span class="va">category_layer</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">s2</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"p5"</span>, <span class="st">"p6"</span>, <span class="st">"p7"</span>, <span class="st">"p8"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># plot solutions</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">s2</span>, axes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="add_feature_contiguity_constraints-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by <a href="https://jeffrey-hanson.com" class="external-link">Jeffrey O Hanson</a>, <a href="http://www.richard-schuster.com" class="external-link">Richard Schuster</a>, Nina Morrell, <a href="http://strimas.com" class="external-link">Matthew Strimas-Mackey</a>, Brandon P M Edwards, Matthew E Watts, <a href="https://arcese.forestry.ubc.ca" class="external-link">Peter Arcese</a>, <a href="https://josephrbennett.wordpress.com" class="external-link">Joseph Bennett</a>, <a href="http://www.possinghamlab.org" class="external-link">Hugh P Possingham</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

