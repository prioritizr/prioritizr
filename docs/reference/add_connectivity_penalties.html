<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Add connectivity penalties — add_connectivity_penalties • prioritizr</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>


<!-- docsearch -->
<script src="../docsearch.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous" />
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>


  <link href="../extra.css" rel="stylesheet">
  

<meta property="og:title" content="Add connectivity penalties — add_connectivity_penalties" />
<meta property="og:description" content="Add penalties to a conservation planning problem() to favor
solutions that select planning units with high connectivity between them." />
<meta property="og:image" content="https://prioritizr.net/logo.png" />






<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-70466840-4"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-70466840-4');
</script>


  

  

  </head>

  <body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">prioritizr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">7.1.0.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../articles/prioritizr.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/gurobi_installation.html">Gurobi Installation Guide</a>
    </li>
    <li>
      <a href="../articles/publication_record.html">Publication Record</a>
    </li>
    <li>
      <a href="../articles/saltspring.html">Salt Spring Island Tutorial</a>
    </li>
    <li>
      <a href="../articles/solver_benchmark.html">Solver Benchmarks</a>
    </li>
    <li>
      <a href="../articles/tasmania.html">Tasmania Tutorial</a>
    </li>
    <li>
      <a href="../articles/zones.html">Management Zones</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/prioritizr/prioritizr/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
      <form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
        </div>
      </form>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Add connectivity penalties</h1>
    <small class="dont-index">Source: <a href='https://github.com/prioritizr/prioritizr/blob/master/R/add_connectivity_penalties.R'><code>R/add_connectivity_penalties.R</code></a></small>
    <div class="hidden name"><code>add_connectivity_penalties.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Add penalties to a conservation planning <code><a href='problem.html'>problem()</a></code> to favor
solutions that select planning units with high connectivity between them.</p>
    </div>

    <div class="ref-usage sourceCode"><pre class='sourceCode r'><code><span class='co'># S4 method for ConservationProblem,ANY,ANY,matrix</span>
<span class='fu'>add_connectivity_penalties</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>penalty</span>, <span class='va'>zones</span>, <span class='va'>data</span><span class='op'>)</span>

<span class='co'># S4 method for ConservationProblem,ANY,ANY,Matrix</span>
<span class='fu'>add_connectivity_penalties</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>penalty</span>, <span class='va'>zones</span>, <span class='va'>data</span><span class='op'>)</span>

<span class='co'># S4 method for ConservationProblem,ANY,ANY,data.frame</span>
<span class='fu'>add_connectivity_penalties</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>penalty</span>, <span class='va'>zones</span>, <span class='va'>data</span><span class='op'>)</span>

<span class='co'># S4 method for ConservationProblem,ANY,ANY,dgCMatrix</span>
<span class='fu'>add_connectivity_penalties</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>penalty</span>, <span class='va'>zones</span>, <span class='va'>data</span><span class='op'>)</span>

<span class='co'># S4 method for ConservationProblem,ANY,ANY,array</span>
<span class='fu'>add_connectivity_penalties</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>penalty</span>, <span class='va'>zones</span>, <span class='va'>data</span><span class='op'>)</span></code></pre></div>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p><code><a href='problem.html'>problem()</a></code> (i.e. <code><a href='ConservationProblem-class.html'>ConservationProblem</a></code>) object.</p></td>
    </tr>
    <tr>
      <th>penalty</th>
      <td><p><code>numeric</code> penalty that is used to scale the importance
of selecting planning units with strong connectivity between them compared
to the main problem objective (e.g. solution cost when the argument to
<code>x</code> has a minimum set objective set using
<code><a href='add_min_set_objective.html'>add_min_set_objective()</a></code>). Higher <code>penalty</code> values
can be used to obtain solutions with a high degree of connectivity,
and smaller <code>penalty</code> values can be used to obtain solutions with a
small degree of connectivity. Note that negative <code>penalty</code> values can
be used to obtain solutions that have very little connectivity.</p></td>
    </tr>
    <tr>
      <th>zones</th>
      <td><p><code>matrix</code> or <code>Matrix</code> object describing the
level of connectivity between different zones. Each row and column
corresponds to a different zone in the argument to <code>x</code>, and cell
values indicate the level of connectivity between each combination
of zones. Cell values along the diagonal of the matrix represent
the level of connectivity between planning units allocated to the
same zone. Cell values must lay between 1 and -1, where negative
values favor solutions with weak connectivity. The default argument to
<code>zones</code> is an identity matrix (i.e. a matrix with ones along the
matrix diagonal and zeros elsewhere), so that planning units are
only considered to be connected when they are allocated to the same zone.
This argument is required when the argument to <code>data</code> is a
<code>matrix</code> or <code>Matrix</code> object. If the argument to <code>data</code> is
an <code>array</code> or <code>data.frame</code> with zone data, this argument
must explicitly be set to <code>NULL</code> otherwise an error will be thrown.</p></td>
    </tr>
    <tr>
      <th>data</th>
      <td><p><code>matrix</code>, <code>Matrix</code>, <code>data.frame</code>, or
<code>array</code> object containing connectivity data. The connectivity values
correspond to the strength of connectivity between
different planning units. Thus connections between planning units
that are associated with higher values are more favorable in the solution.
See the Data format section for more information.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>Object (i.e. <code><a href='ConservationProblem-class.html'>ConservationProblem</a></code>) with the penalties
added to it.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>This function adds penalties to conservation planning problem to penalize
solutions that have low connectivity.
Specifically, it <strong>favors</strong> pair-wise connections between planning units
that have high connectivity values.
It was inspired by Beger <em>et al.</em> (2010) and can symmetric and asymmetric
connectivity relationships between planning units.</p>
    <h2 class="hasAnchor" id="data-format"><a class="anchor" href="#data-format"></a>Data format</h2>

    

<p>The argument to <code>data</code> can be specified using several different formats.
These formats can be used to describe symmetric or
asymmetric relationships between planning units.</p>
<dl>

<dt><code>data</code> as a <code>matrix</code>/<code>Matrix</code> object</dt><dd><p>where rows and columns represent
different planning units and the value of each cell represents the
strength of connectivity between two different planning units. Cells
that occur along the matrix diagonal are treated as weights which
indicate that planning units are more desirable in the solution.
The argument to <code>zones</code> can be used to control
the strength of connectivity between planning units in different zones.
The default argument for <code>zones</code> is to treat planning units
allocated to different zones as having zero connectivity.</p></dd>

<dt><code>data</code> as a <code>data.frame</code> object</dt><dd><p>containing the fields (columns)
<code>"id1"</code>, <code>"id2"</code>, and <code>"boundary"</code>. Here, each row
denotes the connectivity between two planning units following the
<em>Marxan</em> format. The data can be used to denote symmetric or
asymmetric relationships between planning units. By default,
input data is assumed to be symmetric unless asymmetric data is
also included (e.g. if data is present for planning units 2 and 3, then
the same amount of connectivity is expected for planning units 3 and 2,
unless connectivity data is also provided for planning units 3 and 2).
If the argument to <code>x</code> contains multiple zones, then the columns
<code>"zone1"</code> and <code>"zone2"</code> can optionally be provided to manually
specify the connectivity values between planning units when they are
allocated to specific zones. If the columns <code>"zone1"</code> and
<code>"zone2"</code> are present, then the argument to <code>zones</code> must be
<code>NULL</code>.</p></dd>

<dt><code>data</code> as an <code>array</code> object</dt><dd><p>containing four-dimensions where cell values
indicate the strength of connectivity between planning units
when they are assigned to specific management zones. The first two
dimensions (i.e. rows and columns) indicate the strength of
connectivity between different planning units and the second two
dimensions indicate the different management zones. Thus
the <code>data[1, 2, 3, 4]</code> indicates the strength of
connectivity between planning unit 1 and planning unit 2 when planning
unit 1 is assigned to zone 3 and planning unit 2 is assigned to zone 4.</p></dd>


</dl>

    <h2 class="hasAnchor" id="mathematical-formulation"><a class="anchor" href="#mathematical-formulation"></a>Mathematical formulation</h2>

    

<p>The connectivity penalties are implemented using the following equations.
Let \(I\) represent the set of planning units
(indexed by \(i\) or \(j\)), \(Z\) represent the set
of management zones (indexed by \(z\) or \(y\)), and \(X_{iz}\)
represent the decision variable for planning unit \(i\) for in zone
\(z\) (e.g. with binary
values one indicating if planning unit is allocated or not). Also, let
\(p\) represent the argument to <code>penalty</code>, \(D\) represent the
argument to <code>data</code>, and \(W\) represent the argument
to <code>zones</code>.</p>
<p>If the argument to <code>data</code> is supplied as a <code>matrix</code> or
<code>Matrix</code> object, then the penalties are calculated as:</p>
<p>$$
\sum_{i}^{I} \sum_{j}^{I} \sum_{z}^{Z} \sum_{y}^{Z} (-p \times X_{iz}
\times X_{jy} \times D_{ij} \times W_{zy})$$</p>
<p>Otherwise, if the argument to <code>data</code> is supplied as a
<code>data.frame</code> or <code>array</code> object, then the penalties are
calculated as:</p>
<p>$$
\sum_{i}^{I} \sum_{j}^{I} \sum_{z}^{Z} \sum_{y}^{Z} (-p \times X_{iz}
\times X_{jy} \times D_{ijzy})$$</p>
<p>Note that when the problem objective is to maximize some measure of
benefit and not minimize some measure of cost, the term \(-p\) is
replaced with \(p\).</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Beger M, Linke S, Watts M, Game E, Treml E, Ball I, and Possingham, HP (2010)
Incorporating asymmetric connectivity into spatial decision making for
conservation, <em>Conservation Letters</em>, 3: 359--368.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p>See <a href='penalties.html'>penalties</a> for an overview of all functions for adding penalties.</p>
<p>Other penalties: 
<code><a href='add_boundary_penalties.html'>add_boundary_penalties</a>()</code>,
<code><a href='add_feature_weights.html'>add_feature_weights</a>()</code>,
<code><a href='add_linear_penalties.html'>add_linear_penalties</a>()</code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <div class="ref-examples sourceCode"><pre class='sourceCode r'><code><span class='r-in'><span class='co'># set seed for reproducibility</span></span>
<span class='r-in'><span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>600</span><span class='op'>)</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='co'># load Matrix package for visualizing matrices</span></span>
<span class='r-in'><span class='kw'><a href='https://rdrr.io/r/base/library.html'>require</a></span><span class='op'>(</span><span class='va'><a href='http://Matrix.R-forge.R-project.org/'>Matrix</a></span><span class='op'>)</span></span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> Loading required package: Matrix</span>
<span class='r-in'></span>
<span class='r-in'><span class='co'># load data</span></span>
<span class='r-in'><span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>sim_pu_polygons</span>, <span class='va'>sim_pu_zones_stack</span>, <span class='va'>sim_features</span>, <span class='va'>sim_features_zones</span><span class='op'>)</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='co'># define function to rescale values between zero and one so that we</span></span>
<span class='r-in'><span class='co'># can compare solutions from different connectivity matrices</span></span>
<span class='r-in'><span class='va'>rescale</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>to</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>1</span><span class='op'>)</span>, <span class='va'>from</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/range.html'>range</a></span><span class='op'>(</span><span class='va'>x</span>, na.rm <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span></span>
<span class='r-in'>  <span class='op'>(</span><span class='va'>x</span> <span class='op'>-</span> <span class='va'>from</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>)</span> <span class='op'>/</span> <span class='fu'><a href='https://rdrr.io/r/base/diff.html'>diff</a></span><span class='op'>(</span><span class='va'>from</span><span class='op'>)</span> <span class='op'>*</span> <span class='fu'><a href='https://rdrr.io/r/base/diff.html'>diff</a></span><span class='op'>(</span><span class='va'>to</span><span class='op'>)</span> <span class='op'>+</span> <span class='va'>to</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span></span>
<span class='r-in'><span class='op'>}</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='co'># create basic problem</span></span>
<span class='r-in'><span class='va'>p1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='problem.html'>problem</a></span><span class='op'>(</span><span class='va'>sim_pu_polygons</span>, <span class='va'>sim_features</span>, <span class='st'>"cost"</span><span class='op'>)</span> <span class='op'><a href='pipe.html'>%&gt;%</a></span></span>
<span class='r-in'>      <span class='fu'><a href='add_min_set_objective.html'>add_min_set_objective</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'><a href='pipe.html'>%&gt;%</a></span></span>
<span class='r-in'>      <span class='fu'><a href='add_relative_targets.html'>add_relative_targets</a></span><span class='op'>(</span><span class='fl'>0.2</span><span class='op'>)</span> <span class='op'><a href='pipe.html'>%&gt;%</a></span></span>
<span class='r-in'>      <span class='fu'><a href='add_default_solver.html'>add_default_solver</a></span><span class='op'>(</span>verbose <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='co'># create a symmetric connectivity matrix where the connectivity between</span></span>
<span class='r-in'><span class='co'># two planning units corresponds to their shared boundary length</span></span>
<span class='r-in'><span class='va'>b_matrix</span> <span class='op'>&lt;-</span> <span class='fu'><a href='boundary_matrix.html'>boundary_matrix</a></span><span class='op'>(</span><span class='va'>sim_pu_polygons</span><span class='op'>)</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='co'># standardize matrix values to lay between zero and one</span></span>
<span class='r-in'><span class='va'>b_matrix</span><span class='op'>[</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'>rescale</span><span class='op'>(</span><span class='va'>b_matrix</span><span class='op'>[</span><span class='op'>]</span><span class='op'>)</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='co'># visualize connectivity matrix</span></span>
<span class='r-in'><span class='co'># \dontrun{</span></span>
<span class='r-in'><span class='fu'><a href='https://rdrr.io/pkg/raster/man/image.html'>image</a></span><span class='op'>(</span><span class='va'>b_matrix</span><span class='op'>)</span></span>
<span class='r-plt'><img src='add_connectivity_penalties-1.png' alt='' width='700' height='433' /></span>
<span class='r-in'><span class='co'># }</span></span>
<span class='r-in'><span class='co'># create a symmetric connectivity matrix where the connectivity between</span></span>
<span class='r-in'><span class='co'># two planning units corresponds to their spatial proximity</span></span>
<span class='r-in'><span class='co'># i.e. planning units that are further apart share less connectivity</span></span>
<span class='r-in'><span class='va'>centroids</span> <span class='op'>&lt;-</span> <span class='fu'>rgeos</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/rgeos/man/topo-unary-gCentroid.html'>gCentroid</a></span><span class='op'>(</span><span class='va'>sim_pu_polygons</span>, byid <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span></span>
<span class='r-in'><span class='va'>d_matrix</span> <span class='op'>&lt;-</span> <span class='op'>(</span><span class='fl'>1</span> <span class='op'>/</span> <span class='op'>(</span><span class='fu'><a href='as.html'>as</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/dist.html'>dist</a></span><span class='op'>(</span><span class='va'>centroids</span><span class='op'>@</span><span class='va'>coords</span><span class='op'>)</span>, <span class='st'>"Matrix"</span><span class='op'>)</span> <span class='op'>+</span> <span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='co'># standardize matrix values to lay between zero and one</span></span>
<span class='r-in'><span class='va'>d_matrix</span><span class='op'>[</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'>rescale</span><span class='op'>(</span><span class='va'>d_matrix</span><span class='op'>[</span><span class='op'>]</span><span class='op'>)</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='co'># remove connections between planning units without connectivity to</span></span>
<span class='r-in'><span class='co'># reduce run-time</span></span>
<span class='r-in'><span class='va'>d_matrix</span><span class='op'>[</span><span class='va'>d_matrix</span> <span class='op'>&lt;</span> <span class='fl'>0.7</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fl'>0</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='co'># visualize connectivity matrix</span></span>
<span class='r-in'><span class='co'># \dontrun{</span></span>
<span class='r-in'><span class='fu'><a href='https://rdrr.io/pkg/raster/man/image.html'>image</a></span><span class='op'>(</span><span class='va'>d_matrix</span><span class='op'>)</span></span>
<span class='r-plt'><img src='add_connectivity_penalties-2.png' alt='' width='700' height='433' /></span>
<span class='r-in'><span class='co'># }</span></span>
<span class='r-in'><span class='co'># create a symmetric connectivity matrix where the connectivity</span></span>
<span class='r-in'><span class='co'># between adjacent two planning units corresponds to their combined</span></span>
<span class='r-in'><span class='co'># value in a field in the planning unit attribute data</span></span>
<span class='r-in'><span class='co'># for example, this field could describe the extent of native vegetation in</span></span>
<span class='r-in'><span class='co'># each planning unit and we could use connectivity penalties to identify</span></span>
<span class='r-in'><span class='co'># solutions that cluster planning units together that both contain large</span></span>
<span class='r-in'><span class='co'># amounts of native vegetation</span></span>
<span class='r-in'><span class='va'>c_matrix</span> <span class='op'>&lt;-</span> <span class='fu'><a href='connectivity_matrix.html'>connectivity_matrix</a></span><span class='op'>(</span><span class='va'>sim_pu_polygons</span>, <span class='st'>"cost"</span><span class='op'>)</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='co'># standardize matrix values to lay between zero and one</span></span>
<span class='r-in'><span class='va'>c_matrix</span><span class='op'>[</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'>rescale</span><span class='op'>(</span><span class='va'>c_matrix</span><span class='op'>[</span><span class='op'>]</span><span class='op'>)</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='co'># visualize connectivity matrix</span></span>
<span class='r-in'><span class='co'># \dontrun{</span></span>
<span class='r-in'><span class='fu'><a href='https://rdrr.io/pkg/raster/man/image.html'>image</a></span><span class='op'>(</span><span class='va'>c_matrix</span><span class='op'>)</span></span>
<span class='r-plt'><img src='add_connectivity_penalties-3.png' alt='' width='700' height='433' /></span>
<span class='r-in'><span class='co'># }</span></span>
<span class='r-in'><span class='co'># create an asymmetric connectivity matrix. Here, connectivity occurs between</span></span>
<span class='r-in'><span class='co'># adjacent planning units and, due to rivers flowing southwards</span></span>
<span class='r-in'><span class='co'># through the study area, connectivity from northern planning units to</span></span>
<span class='r-in'><span class='co'># southern planning units is ten times stronger than the reverse.</span></span>
<span class='r-in'><span class='va'>ac_matrix</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>sim_pu_polygons</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>sim_pu_polygons</span><span class='op'>)</span><span class='op'>)</span></span>
<span class='r-in'><span class='va'>ac_matrix</span> <span class='op'>&lt;-</span> <span class='fu'><a href='as.html'>as</a></span><span class='op'>(</span><span class='va'>ac_matrix</span>, <span class='st'>"Matrix"</span><span class='op'>)</span></span>
<span class='r-in'><span class='va'>adjacent_units</span> <span class='op'>&lt;-</span> <span class='fu'>rgeos</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/rgeos/man/pred-binary-gIntersects.html'>gIntersects</a></span><span class='op'>(</span><span class='va'>sim_pu_polygons</span>, byid <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span></span>
<span class='r-in'><span class='kw'>for</span> <span class='op'>(</span><span class='va'>i</span> <span class='kw'>in</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq_len</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>sim_pu_polygons</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span></span>
<span class='r-in'>  <span class='kw'>for</span> <span class='op'>(</span><span class='va'>j</span> <span class='kw'>in</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq_len</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>sim_pu_polygons</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span></span>
<span class='r-in'>    <span class='co'># find if planning units are adjacent</span></span>
<span class='r-in'>    <span class='kw'>if</span> <span class='op'>(</span><span class='va'>adjacent_units</span><span class='op'>[</span><span class='va'>i</span>, <span class='va'>j</span><span class='op'>]</span><span class='op'>)</span> <span class='op'>{</span></span>
<span class='r-in'>      <span class='co'># find if planning units lay north and south of each other</span></span>
<span class='r-in'>      <span class='co'># i.e. they have the same x-coordinate</span></span>
<span class='r-in'>      <span class='kw'>if</span> <span class='op'>(</span><span class='va'>centroids</span><span class='op'>@</span><span class='va'>coords</span><span class='op'>[</span><span class='va'>i</span>, <span class='fl'>1</span><span class='op'>]</span> <span class='op'>==</span> <span class='va'>centroids</span><span class='op'>@</span><span class='va'>coords</span><span class='op'>[</span><span class='va'>j</span>, <span class='fl'>1</span><span class='op'>]</span><span class='op'>)</span> <span class='op'>{</span></span>
<span class='r-in'>        <span class='kw'>if</span> <span class='op'>(</span><span class='va'>centroids</span><span class='op'>@</span><span class='va'>coords</span><span class='op'>[</span><span class='va'>i</span>, <span class='fl'>2</span><span class='op'>]</span> <span class='op'>&gt;</span> <span class='va'>centroids</span><span class='op'>@</span><span class='va'>coords</span><span class='op'>[</span><span class='va'>j</span>, <span class='fl'>2</span><span class='op'>]</span><span class='op'>)</span> <span class='op'>{</span></span>
<span class='r-in'>          <span class='co'># if i is north of j add 10 units of connectivity</span></span>
<span class='r-in'>          <span class='va'>ac_matrix</span><span class='op'>[</span><span class='va'>i</span>, <span class='va'>j</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='va'>ac_matrix</span><span class='op'>[</span><span class='va'>i</span>, <span class='va'>j</span><span class='op'>]</span> <span class='op'>+</span> <span class='fl'>10</span></span>
<span class='r-in'>        <span class='op'>}</span> <span class='kw'>else</span> <span class='kw'>if</span> <span class='op'>(</span><span class='va'>centroids</span><span class='op'>@</span><span class='va'>coords</span><span class='op'>[</span><span class='va'>i</span>, <span class='fl'>2</span><span class='op'>]</span> <span class='op'>&lt;</span> <span class='va'>centroids</span><span class='op'>@</span><span class='va'>coords</span><span class='op'>[</span><span class='va'>j</span>, <span class='fl'>2</span><span class='op'>]</span><span class='op'>)</span> <span class='op'>{</span></span>
<span class='r-in'>          <span class='co'># if i is south of j add 1 unit of connectivity</span></span>
<span class='r-in'>          <span class='va'>ac_matrix</span><span class='op'>[</span><span class='va'>i</span>, <span class='va'>j</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='va'>ac_matrix</span><span class='op'>[</span><span class='va'>i</span>, <span class='va'>j</span><span class='op'>]</span> <span class='op'>+</span> <span class='fl'>1</span></span>
<span class='r-in'>        <span class='op'>}</span></span>
<span class='r-in'>      <span class='op'>}</span></span>
<span class='r-in'>    <span class='op'>}</span></span>
<span class='r-in'>  <span class='op'>}</span></span>
<span class='r-in'><span class='op'>}</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='co'># standardize matrix values to lay between zero and one</span></span>
<span class='r-in'><span class='va'>ac_matrix</span><span class='op'>[</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'>rescale</span><span class='op'>(</span><span class='va'>ac_matrix</span><span class='op'>[</span><span class='op'>]</span><span class='op'>)</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='co'># visualize asymmetric connectivity matrix</span></span>
<span class='r-in'><span class='co'># \dontrun{</span></span>
<span class='r-in'><span class='fu'><a href='https://rdrr.io/pkg/raster/man/image.html'>image</a></span><span class='op'>(</span><span class='va'>ac_matrix</span><span class='op'>)</span></span>
<span class='r-plt'><img src='add_connectivity_penalties-4.png' alt='' width='700' height='433' /></span>
<span class='r-in'><span class='co'># }</span></span>
<span class='r-in'><span class='co'># create penalties</span></span>
<span class='r-in'><span class='va'>penalties</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>10</span>, <span class='fl'>25</span><span class='op'>)</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='co'># create problems using the different connectivity matrices and penalties</span></span>
<span class='r-in'><span class='va'>p2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='va'>p1</span>,</span>
<span class='r-in'>           <span class='va'>p1</span> <span class='op'><a href='pipe.html'>%&gt;%</a></span> <span class='fu'>add_connectivity_penalties</span><span class='op'>(</span><span class='va'>penalties</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, data <span class='op'>=</span> <span class='va'>b_matrix</span><span class='op'>)</span>,</span>
<span class='r-in'>           <span class='va'>p1</span> <span class='op'><a href='pipe.html'>%&gt;%</a></span> <span class='fu'>add_connectivity_penalties</span><span class='op'>(</span><span class='va'>penalties</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, data <span class='op'>=</span> <span class='va'>b_matrix</span><span class='op'>)</span>,</span>
<span class='r-in'>           <span class='va'>p1</span> <span class='op'><a href='pipe.html'>%&gt;%</a></span> <span class='fu'>add_connectivity_penalties</span><span class='op'>(</span><span class='va'>penalties</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, data <span class='op'>=</span> <span class='va'>d_matrix</span><span class='op'>)</span>,</span>
<span class='r-in'>           <span class='va'>p1</span> <span class='op'><a href='pipe.html'>%&gt;%</a></span> <span class='fu'>add_connectivity_penalties</span><span class='op'>(</span><span class='va'>penalties</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, data <span class='op'>=</span> <span class='va'>d_matrix</span><span class='op'>)</span>,</span>
<span class='r-in'>           <span class='va'>p1</span> <span class='op'><a href='pipe.html'>%&gt;%</a></span> <span class='fu'>add_connectivity_penalties</span><span class='op'>(</span><span class='va'>penalties</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, data <span class='op'>=</span> <span class='va'>c_matrix</span><span class='op'>)</span>,</span>
<span class='r-in'>           <span class='va'>p1</span> <span class='op'><a href='pipe.html'>%&gt;%</a></span> <span class='fu'>add_connectivity_penalties</span><span class='op'>(</span><span class='va'>penalties</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, data <span class='op'>=</span> <span class='va'>c_matrix</span><span class='op'>)</span>,</span>
<span class='r-in'>           <span class='va'>p1</span> <span class='op'><a href='pipe.html'>%&gt;%</a></span> <span class='fu'>add_connectivity_penalties</span><span class='op'>(</span><span class='va'>penalties</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, data <span class='op'>=</span> <span class='va'>ac_matrix</span><span class='op'>)</span>,</span>
<span class='r-in'>           <span class='va'>p1</span> <span class='op'><a href='pipe.html'>%&gt;%</a></span> <span class='fu'>add_connectivity_penalties</span><span class='op'>(</span><span class='va'>penalties</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, data <span class='op'>=</span> <span class='va'>ac_matrix</span><span class='op'>)</span><span class='op'>)</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='co'># assign names to the problems</span></span>
<span class='r-in'><span class='fu'><a href='https://rdrr.io/pkg/raster/man/names.html'>names</a></span><span class='op'>(</span><span class='va'>p2</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"basic problem"</span>,</span>
<span class='r-in'>               <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"b_matrix ("</span>, <span class='va'>penalties</span>,<span class='st'>")"</span><span class='op'>)</span>,</span>
<span class='r-in'>               <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"d_matrix ("</span>, <span class='va'>penalties</span>,<span class='st'>")"</span><span class='op'>)</span>,</span>
<span class='r-in'>               <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"c_matrix ("</span>, <span class='va'>penalties</span>,<span class='st'>")"</span><span class='op'>)</span>,</span>
<span class='r-in'>               <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"ac_matrix ("</span>, <span class='va'>penalties</span>,<span class='st'>")"</span><span class='op'>)</span><span class='op'>)</span></span>
<span class='r-in'><span class='co'># \dontrun{</span></span>
<span class='r-in'><span class='co'># solve problems</span></span>
<span class='r-in'><span class='va'>s2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>lapply</a></span><span class='op'>(</span><span class='va'>p2</span>, <span class='va'>solve</span><span class='op'>)</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='co'># plot solutions</span></span>
<span class='r-in'><span class='fu'><a href='https://rdrr.io/r/graphics/par.html'>par</a></span><span class='op'>(</span>mfrow <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>3</span>, <span class='fl'>3</span><span class='op'>)</span><span class='op'>)</span></span>
<span class='r-in'><span class='kw'>for</span> <span class='op'>(</span><span class='va'>i</span> <span class='kw'>in</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq_along</a></span><span class='op'>(</span><span class='va'>s2</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span></span>
<span class='r-in'>  <span class='fu'><a href='https://rdrr.io/pkg/raster/man/plot.html'>plot</a></span><span class='op'>(</span><span class='va'>s2</span><span class='op'>[[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>]</span>, main <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/raster/man/names.html'>names</a></span><span class='op'>(</span><span class='va'>p2</span><span class='op'>)</span><span class='op'>[</span><span class='va'>i</span><span class='op'>]</span>, cex <span class='op'>=</span> <span class='fl'>1.5</span>, col <span class='op'>=</span> <span class='st'>"white"</span><span class='op'>)</span></span>
<span class='r-in'>  <span class='fu'><a href='https://rdrr.io/pkg/raster/man/plot.html'>plot</a></span><span class='op'>(</span><span class='va'>s2</span><span class='op'>[[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>]</span><span class='op'>[</span><span class='va'>s2</span><span class='op'>[[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>]</span><span class='op'>$</span><span class='va'>solution_1</span> <span class='op'>==</span> <span class='fl'>1</span>, <span class='op'>]</span>, col <span class='op'>=</span> <span class='st'>"darkgreen"</span>, add <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span></span>
<span class='r-in'><span class='op'>}</span></span>
<span class='r-plt'><img src='add_connectivity_penalties-5.png' alt='' width='700' height='433' /></span>
<span class='r-in'><span class='co'># }</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='co'># create minimal multi-zone problem and limit solver to one minute</span></span>
<span class='r-in'><span class='co'># to obtain solutions in a short period of time</span></span>
<span class='r-in'><span class='va'>p3</span> <span class='op'>&lt;-</span> <span class='fu'><a href='problem.html'>problem</a></span><span class='op'>(</span><span class='va'>sim_pu_zones_stack</span>, <span class='va'>sim_features_zones</span><span class='op'>)</span> <span class='op'><a href='pipe.html'>%&gt;%</a></span></span>
<span class='r-in'>      <span class='fu'><a href='add_min_set_objective.html'>add_min_set_objective</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'><a href='pipe.html'>%&gt;%</a></span></span>
<span class='r-in'>      <span class='fu'><a href='add_relative_targets.html'>add_relative_targets</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='fl'>0.15</span>, nrow <span class='op'>=</span> <span class='fl'>5</span>, ncol <span class='op'>=</span> <span class='fl'>3</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='pipe.html'>%&gt;%</a></span></span>
<span class='r-in'>      <span class='fu'><a href='add_binary_decisions.html'>add_binary_decisions</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'><a href='pipe.html'>%&gt;%</a></span></span>
<span class='r-in'>      <span class='fu'><a href='add_default_solver.html'>add_default_solver</a></span><span class='op'>(</span>time_limit <span class='op'>=</span> <span class='fl'>60</span>, verbose <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='co'># create matrix showing which planning units are adjacent to other units</span></span>
<span class='r-in'><span class='va'>a_matrix</span> <span class='op'>&lt;-</span> <span class='fu'><a href='adjacency_matrix.html'>adjacency_matrix</a></span><span class='op'>(</span><span class='va'>sim_pu_zones_stack</span><span class='op'>)</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='co'># visualize matrix</span></span>
<span class='r-in'><span class='co'># \dontrun{</span></span>
<span class='r-in'><span class='fu'><a href='https://rdrr.io/pkg/raster/man/image.html'>image</a></span><span class='op'>(</span><span class='va'>a_matrix</span><span class='op'>)</span></span>
<span class='r-plt'><img src='add_connectivity_penalties-6.png' alt='' width='700' height='433' /></span>
<span class='r-in'><span class='co'># }</span></span>
<span class='r-in'><span class='co'># create a zone matrix where connectivities are only present between</span></span>
<span class='r-in'><span class='co'># planning units that are allocated to the same zone</span></span>
<span class='r-in'><span class='va'>zm1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='as.html'>as</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/diag.html'>diag</a></span><span class='op'>(</span><span class='fl'>3</span><span class='op'>)</span>, <span class='st'>"Matrix"</span><span class='op'>)</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='co'># print zone matrix</span></span>
<span class='r-in'><span class='fu'><a href='print.html'>print</a></span><span class='op'>(</span><span class='va'>zm1</span><span class='op'>)</span></span>
<span class='r-out co'><span class='r-pr'>#&gt;</span>      [,1] [,2] [,3]</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> [1,]    1    .    .</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> [2,]    .    1    .</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> [3,]    .    .    1</span>
<span class='r-in'></span>
<span class='r-in'><span class='co'># create a zone matrix where connectivities are strongest between</span></span>
<span class='r-in'><span class='co'># planning units allocated to different zones</span></span>
<span class='r-in'><span class='va'>zm2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='fl'>1</span>, ncol <span class='op'>=</span> <span class='fl'>3</span>, nrow <span class='op'>=</span> <span class='fl'>3</span><span class='op'>)</span></span>
<span class='r-in'><span class='fu'><a href='https://rdrr.io/r/base/diag.html'>diag</a></span><span class='op'>(</span><span class='va'>zm2</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fl'>0</span></span>
<span class='r-in'><span class='va'>zm2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='as.html'>as</a></span><span class='op'>(</span><span class='va'>zm2</span>, <span class='st'>"Matrix"</span><span class='op'>)</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='co'># print zone matrix</span></span>
<span class='r-in'><span class='fu'><a href='print.html'>print</a></span><span class='op'>(</span><span class='va'>zm2</span><span class='op'>)</span></span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> 3 x 3 Matrix of class "dsyMatrix"</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span>      [,1] [,2] [,3]</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> [1,]    0    1    1</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> [2,]    1    0    1</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> [3,]    1    1    0</span>
<span class='r-in'></span>
<span class='r-in'><span class='co'># create a zone matrix that indicates that connectivities between planning</span></span>
<span class='r-in'><span class='co'># units assigned to the same zone are much higher than connectivities</span></span>
<span class='r-in'><span class='co'># assigned to different zones</span></span>
<span class='r-in'><span class='va'>zm3</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='fl'>0.1</span>, ncol <span class='op'>=</span> <span class='fl'>3</span>, nrow <span class='op'>=</span> <span class='fl'>3</span><span class='op'>)</span></span>
<span class='r-in'><span class='fu'><a href='https://rdrr.io/r/base/diag.html'>diag</a></span><span class='op'>(</span><span class='va'>zm3</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fl'>1</span></span>
<span class='r-in'><span class='va'>zm3</span> <span class='op'>&lt;-</span> <span class='fu'><a href='as.html'>as</a></span><span class='op'>(</span><span class='va'>zm3</span>, <span class='st'>"Matrix"</span><span class='op'>)</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='co'># print zone matrix</span></span>
<span class='r-in'><span class='fu'><a href='print.html'>print</a></span><span class='op'>(</span><span class='va'>zm3</span><span class='op'>)</span></span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> 3 x 3 Matrix of class "dsyMatrix"</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span>      [,1] [,2] [,3]</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> [1,]  1.0  0.1  0.1</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> [2,]  0.1  1.0  0.1</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> [3,]  0.1  0.1  1.0</span>
<span class='r-in'></span>
<span class='r-in'><span class='co'># create a zone matrix that indicates that connectivities between planning</span></span>
<span class='r-in'><span class='co'># units allocated to zone 1 are very high, connectivities between planning</span></span>
<span class='r-in'><span class='co'># units allocated to zones 1 and 2 are moderately high, and connectivities</span></span>
<span class='r-in'><span class='co'># planning units allocated to other zones are low</span></span>
<span class='r-in'><span class='va'>zm4</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='fl'>0.1</span>, ncol <span class='op'>=</span> <span class='fl'>3</span>, nrow <span class='op'>=</span> <span class='fl'>3</span><span class='op'>)</span></span>
<span class='r-in'><span class='va'>zm4</span><span class='op'>[</span><span class='fl'>1</span>, <span class='fl'>1</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fl'>1</span></span>
<span class='r-in'><span class='va'>zm4</span><span class='op'>[</span><span class='fl'>1</span>, <span class='fl'>2</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fl'>0.5</span></span>
<span class='r-in'><span class='va'>zm4</span><span class='op'>[</span><span class='fl'>2</span>, <span class='fl'>1</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fl'>0.5</span></span>
<span class='r-in'><span class='va'>zm4</span> <span class='op'>&lt;-</span> <span class='fu'><a href='as.html'>as</a></span><span class='op'>(</span><span class='va'>zm4</span>, <span class='st'>"Matrix"</span><span class='op'>)</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='co'># print zone matrix</span></span>
<span class='r-in'><span class='fu'><a href='print.html'>print</a></span><span class='op'>(</span><span class='va'>zm4</span><span class='op'>)</span></span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> 3 x 3 Matrix of class "dsyMatrix"</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span>      [,1] [,2] [,3]</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> [1,]  1.0  0.5  0.1</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> [2,]  0.5  0.1  0.1</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> [3,]  0.1  0.1  0.1</span>
<span class='r-in'></span>
<span class='r-in'><span class='co'># create a zone matrix with strong connectivities between planning units</span></span>
<span class='r-in'><span class='co'># allocated to the same zone, moderate connectivities between planning</span></span>
<span class='r-in'><span class='co'># unit allocated to zone 1 and zone 2, and negative connectivities between</span></span>
<span class='r-in'><span class='co'># planning units allocated to zone 3 and the other two zones</span></span>
<span class='r-in'><span class='va'>zm5</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>1</span>, ncol <span class='op'>=</span> <span class='fl'>3</span>, nrow <span class='op'>=</span> <span class='fl'>3</span><span class='op'>)</span></span>
<span class='r-in'><span class='va'>zm5</span><span class='op'>[</span><span class='fl'>1</span>, <span class='fl'>2</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fl'>0.5</span></span>
<span class='r-in'><span class='va'>zm5</span><span class='op'>[</span><span class='fl'>2</span>, <span class='fl'>1</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fl'>0.5</span></span>
<span class='r-in'><span class='fu'><a href='https://rdrr.io/r/base/diag.html'>diag</a></span><span class='op'>(</span><span class='va'>zm5</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fl'>1</span></span>
<span class='r-in'><span class='va'>zm5</span> <span class='op'>&lt;-</span> <span class='fu'><a href='as.html'>as</a></span><span class='op'>(</span><span class='va'>zm5</span>, <span class='st'>"Matrix"</span><span class='op'>)</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='co'># print zone matrix</span></span>
<span class='r-in'><span class='fu'><a href='print.html'>print</a></span><span class='op'>(</span><span class='va'>zm5</span><span class='op'>)</span></span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> 3 x 3 Matrix of class "dsyMatrix"</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span>      [,1] [,2] [,3]</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> [1,]  1.0  0.5   -1</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> [2,]  0.5  1.0   -1</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> [3,] -1.0 -1.0    1</span>
<span class='r-in'></span>
<span class='r-in'><span class='co'># create vector of penalties to use creating problems</span></span>
<span class='r-in'><span class='va'>penalties2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>5</span>, <span class='fl'>15</span><span class='op'>)</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='co'># create multi-zone problems using the adjacent connectivity matrix and</span></span>
<span class='r-in'><span class='co'># different zone matrices</span></span>
<span class='r-in'><span class='va'>p4</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span></span>
<span class='r-in'>  <span class='va'>p3</span>,</span>
<span class='r-in'>  <span class='va'>p3</span> <span class='op'><a href='pipe.html'>%&gt;%</a></span> <span class='fu'>add_connectivity_penalties</span><span class='op'>(</span><span class='va'>penalties2</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, <span class='va'>zm1</span>, <span class='va'>a_matrix</span><span class='op'>)</span>,</span>
<span class='r-in'>  <span class='va'>p3</span> <span class='op'><a href='pipe.html'>%&gt;%</a></span> <span class='fu'>add_connectivity_penalties</span><span class='op'>(</span><span class='va'>penalties2</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, <span class='va'>zm1</span>, <span class='va'>a_matrix</span><span class='op'>)</span>,</span>
<span class='r-in'>  <span class='va'>p3</span> <span class='op'><a href='pipe.html'>%&gt;%</a></span> <span class='fu'>add_connectivity_penalties</span><span class='op'>(</span><span class='va'>penalties2</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, <span class='va'>zm2</span>, <span class='va'>a_matrix</span><span class='op'>)</span>,</span>
<span class='r-in'>  <span class='va'>p3</span> <span class='op'><a href='pipe.html'>%&gt;%</a></span> <span class='fu'>add_connectivity_penalties</span><span class='op'>(</span><span class='va'>penalties2</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, <span class='va'>zm2</span>, <span class='va'>a_matrix</span><span class='op'>)</span>,</span>
<span class='r-in'>  <span class='va'>p3</span> <span class='op'><a href='pipe.html'>%&gt;%</a></span> <span class='fu'>add_connectivity_penalties</span><span class='op'>(</span><span class='va'>penalties2</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, <span class='va'>zm3</span>, <span class='va'>a_matrix</span><span class='op'>)</span>,</span>
<span class='r-in'>  <span class='va'>p3</span> <span class='op'><a href='pipe.html'>%&gt;%</a></span> <span class='fu'>add_connectivity_penalties</span><span class='op'>(</span><span class='va'>penalties2</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, <span class='va'>zm3</span>, <span class='va'>a_matrix</span><span class='op'>)</span>,</span>
<span class='r-in'>  <span class='va'>p3</span> <span class='op'><a href='pipe.html'>%&gt;%</a></span> <span class='fu'>add_connectivity_penalties</span><span class='op'>(</span><span class='va'>penalties2</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, <span class='va'>zm4</span>, <span class='va'>a_matrix</span><span class='op'>)</span>,</span>
<span class='r-in'>  <span class='va'>p3</span> <span class='op'><a href='pipe.html'>%&gt;%</a></span> <span class='fu'>add_connectivity_penalties</span><span class='op'>(</span><span class='va'>penalties2</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, <span class='va'>zm4</span>, <span class='va'>a_matrix</span><span class='op'>)</span>,</span>
<span class='r-in'>  <span class='va'>p3</span> <span class='op'><a href='pipe.html'>%&gt;%</a></span> <span class='fu'>add_connectivity_penalties</span><span class='op'>(</span><span class='va'>penalties2</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, <span class='va'>zm5</span>, <span class='va'>a_matrix</span><span class='op'>)</span>,</span>
<span class='r-in'>  <span class='va'>p3</span> <span class='op'><a href='pipe.html'>%&gt;%</a></span> <span class='fu'>add_connectivity_penalties</span><span class='op'>(</span><span class='va'>penalties2</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, <span class='va'>zm5</span>, <span class='va'>a_matrix</span><span class='op'>)</span><span class='op'>)</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='co'># assign names to the problems</span></span>
<span class='r-in'><span class='fu'><a href='https://rdrr.io/pkg/raster/man/names.html'>names</a></span><span class='op'>(</span><span class='va'>p4</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"basic problem"</span>,</span>
<span class='r-in'>               <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"zm"</span>, <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq_len</a></span><span class='op'>(</span><span class='fl'>5</span><span class='op'>)</span>, each <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>, <span class='st'>" ("</span>,</span>
<span class='r-in'>                      <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='va'>penalties2</span>, <span class='fl'>2</span><span class='op'>)</span>, <span class='st'>")"</span><span class='op'>)</span><span class='op'>)</span></span>
<span class='r-in'><span class='co'># \dontrun{</span></span>
<span class='r-in'><span class='co'># solve problems</span></span>
<span class='r-in'><span class='va'>s4</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>lapply</a></span><span class='op'>(</span><span class='va'>p4</span>, <span class='va'>solve</span><span class='op'>)</span></span>
<span class='r-in'><span class='va'>s4</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>lapply</a></span><span class='op'>(</span><span class='va'>s4</span>, <span class='va'>category_layer</span><span class='op'>)</span></span>
<span class='r-in'><span class='va'>s4</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/raster/man/stack.html'>stack</a></span><span class='op'>(</span><span class='va'>s4</span><span class='op'>)</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='co'># plot solutions</span></span>
<span class='r-in'><span class='fu'><a href='https://rdrr.io/pkg/raster/man/plot.html'>plot</a></span><span class='op'>(</span><span class='va'>s4</span>, main <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/raster/man/names.html'>names</a></span><span class='op'>(</span><span class='va'>p4</span><span class='op'>)</span>, axes <span class='op'>=</span> <span class='cn'>FALSE</span>, box <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span></span>
<span class='r-plt'><img src='add_connectivity_penalties-7.png' alt='' width='700' height='433' /></span>
<span class='r-in'><span class='co'># }</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='co'># create an array to manually specify the connectivities between</span></span>
<span class='r-in'><span class='co'># each planning unit when they are allocated to each different zone</span></span>
<span class='r-in'><span class='co'># for real-world problems, these connectivities would be generated using</span></span>
<span class='r-in'><span class='co'># data - but here these connectivity values are assigned as random</span></span>
<span class='r-in'><span class='co'># ones or zeros</span></span>
<span class='r-in'><span class='va'>c_array</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/array.html'>array</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fu'><a href='OptimizationProblem-methods.html'>ncell</a></span><span class='op'>(</span><span class='va'>sim_pu_zones_stack</span><span class='op'>[[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>]</span><span class='op'>)</span>, <span class='fl'>2</span><span class='op'>)</span>, <span class='fl'>3</span>, <span class='fl'>3</span><span class='op'>)</span><span class='op'>)</span></span>
<span class='r-in'><span class='kw'>for</span> <span class='op'>(</span><span class='va'>z1</span> <span class='kw'>in</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq_len</a></span><span class='op'>(</span><span class='fl'>3</span><span class='op'>)</span><span class='op'>)</span></span>
<span class='r-in'>  <span class='kw'>for</span> <span class='op'>(</span><span class='va'>z2</span> <span class='kw'>in</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq_len</a></span><span class='op'>(</span><span class='fl'>3</span><span class='op'>)</span><span class='op'>)</span></span>
<span class='r-in'>    <span class='va'>c_array</span><span class='op'>[</span>, , <span class='va'>z1</span>, <span class='va'>z2</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/Uniform.html'>runif</a></span><span class='op'>(</span><span class='fu'><a href='OptimizationProblem-methods.html'>ncell</a></span><span class='op'>(</span><span class='va'>sim_pu_zones_stack</span><span class='op'>[[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>]</span><span class='op'>)</span> <span class='op'>^</span> <span class='fl'>2</span>,</span>
<span class='r-in'>                                       <span class='fl'>0</span>, <span class='fl'>0.505</span><span class='op'>)</span><span class='op'>)</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='co'># create a problem with the manually specified connectivity array</span></span>
<span class='r-in'><span class='co'># note that the zones argument is set to NULL because the connectivity</span></span>
<span class='r-in'><span class='co'># data is an array</span></span>
<span class='r-in'><span class='va'>p5</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='va'>p3</span>,</span>
<span class='r-in'>           <span class='va'>p3</span> <span class='op'><a href='pipe.html'>%&gt;%</a></span> <span class='fu'>add_connectivity_penalties</span><span class='op'>(</span><span class='fl'>15</span>, zones <span class='op'>=</span> <span class='cn'>NULL</span>, <span class='va'>c_array</span><span class='op'>)</span><span class='op'>)</span></span>
<span class='r-in'></span>
<span class='r-in'></span>
<span class='r-in'><span class='co'># assign names to the problems</span></span>
<span class='r-in'><span class='fu'><a href='https://rdrr.io/pkg/raster/man/names.html'>names</a></span><span class='op'>(</span><span class='va'>p5</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"basic problem"</span>, <span class='st'>"connectivity array"</span><span class='op'>)</span></span>
<span class='r-in'><span class='co'># \dontrun{</span></span>
<span class='r-in'><span class='co'># solve problems</span></span>
<span class='r-in'><span class='va'>s5</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>lapply</a></span><span class='op'>(</span><span class='va'>p5</span>, <span class='va'>solve</span><span class='op'>)</span></span>
<span class='r-in'><span class='va'>s5</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>lapply</a></span><span class='op'>(</span><span class='va'>s5</span>, <span class='va'>category_layer</span><span class='op'>)</span></span>
<span class='r-in'><span class='va'>s5</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/raster/man/stack.html'>stack</a></span><span class='op'>(</span><span class='va'>s5</span><span class='op'>)</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='co'># plot solutions</span></span>
<span class='r-in'><span class='fu'><a href='https://rdrr.io/pkg/raster/man/plot.html'>plot</a></span><span class='op'>(</span><span class='va'>s5</span>, main <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/raster/man/names.html'>names</a></span><span class='op'>(</span><span class='va'>p5</span><span class='op'>)</span>, axes <span class='op'>=</span> <span class='cn'>FALSE</span>, box <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span></span>
<span class='r-plt'><img src='add_connectivity_penalties-8.png' alt='' width='700' height='433' /></span>
<span class='r-in'><span class='co'># }</span></span>
</code></pre></div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p><p>Developed by <a href="https://jeffrey-hanson.com" class="external-link">Jeffrey O Hanson</a>, <a href="http://www.richard-schuster.com" class="external-link">Richard Schuster</a>, Nina Morrell, <a href="http://strimas.com" class="external-link">Matthew Strimas-Mackey</a>, Matthew E Watts, <a href="https://arcese.forestry.ubc.ca" class="external-link">Peter Arcese</a>, <a href="https://josephrbennett.wordpress.com" class="external-link">Joseph Bennett</a>, <a href="http://www.possinghamlab.org" class="external-link">Hugh P Possingham</a>.</p></p>
</div>

<div class="pkgdown">
  <p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 1.6.1.9001.</p></p>
</div>

      </footer>
   </div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script>
<script>
  docsearch({
    
    
    apiKey: '486efa122ea6783724263412c5f28ab3',
    indexName: 'prioritizr',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>



  

  </body>
</html>


