<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Add neighbor constraints — add_neighbor_constraints • prioritizr</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><!-- katex math --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous"><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script><script src="../katex-auto.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Add neighbor constraints — add_neighbor_constraints"><meta name="description" content="Add constraints to a conservation planning problem to ensure
that all selected planning units in the solution have at least a certain
number of neighbors that are also selected in the solution."><meta property="og:description" content="Add constraints to a conservation planning problem to ensure
that all selected planning units in the solution have at least a certain
number of neighbors that are also selected in the solution."><meta property="og:image" content="https://prioritizr.net/logo.png"><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-70466840-4"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-70466840-4');
</script></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">prioritizr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">8.1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/prioritizr.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/package_overview.html">Package overview</a></li>
    <li><a class="dropdown-item" href="../articles/gurobi_installation_guide.html">Gurobi installation guide</a></li>
    <li><a class="dropdown-item" href="../articles/solver_benchmarks.html">Solver benchmarks</a></li>
    <li><a class="dropdown-item" href="../articles/publication_record.html">Publication record</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-tutorials" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Tutorials</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-tutorials"><li><a class="dropdown-item" href="../articles/connectivity_tutorial.html">Connectivity</a></li>
    <li><a class="dropdown-item" href="../articles/calibrating_trade-offs_tutorial.html">Calibrating trade-offs</a></li>
    <li><a class="dropdown-item" href="../articles/management_zones_tutorial.html">Management zones</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/prioritizr/prioritizr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Add neighbor constraints</h1>
      <small class="dont-index">Source: <a href="https://github.com/prioritizr/prioritizr/blob/HEAD/R/add_neighbor_constraints.R" class="external-link"><code>R/add_neighbor_constraints.R</code></a></small>
      <div class="d-none name"><code>add_neighbor_constraints.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Add constraints to a conservation planning problem to ensure
that all selected planning units in the solution have at least a certain
number of neighbors that are also selected in the solution.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="co"># S4 method for class 'ConservationProblem,ANY,ANY,ANY,ANY'</span></span>
<span><span class="fu">add_neighbor_constraints</span><span class="op">(</span><span class="va">x</span>, <span class="va">k</span>, <span class="va">clamp</span>, <span class="va">zones</span>, <span class="va">data</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for class 'ConservationProblem,ANY,ANY,ANY,data.frame'</span></span>
<span><span class="fu">add_neighbor_constraints</span><span class="op">(</span><span class="va">x</span>, <span class="va">k</span>, <span class="va">clamp</span>, <span class="va">zones</span>, <span class="va">data</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for class 'ConservationProblem,ANY,ANY,ANY,matrix'</span></span>
<span><span class="fu">add_neighbor_constraints</span><span class="op">(</span><span class="va">x</span>, <span class="va">k</span>, <span class="va">clamp</span>, <span class="va">zones</span>, <span class="va">data</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for class 'ConservationProblem,ANY,ANY,ANY,array'</span></span>
<span><span class="fu">add_neighbor_constraints</span><span class="op">(</span><span class="va">x</span>, <span class="va">k</span>, <span class="va">clamp</span>, <span class="va">zones</span>, <span class="va">data</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p><code><a href="problem.html">problem()</a></code> object.</p></dd>


<dt id="arg-k">k<a class="anchor" aria-label="anchor" href="#arg-k"></a></dt>
<dd><p><code>integer</code> minimum number of neighbors for selected
planning units in the solution. For problems with multiple zones,
the argument to <code>k</code> must have an element for each zone.</p></dd>


<dt id="arg-clamp">clamp<a class="anchor" aria-label="anchor" href="#arg-clamp"></a></dt>
<dd><p><code>logical</code> should the minimum number of neighbors
for selected planning units in the solution be clamped to feasibility?
For example, if a planning unit has two neighbors,
<code>k = 3</code>, and <code>clamp = FALSE</code>, then the planning unit could not
ever be selected in the solution. However, if <code>clamp = TRUE</code>,
then the planning unit could potentially be selected in the solution if
both of its two neighbors were also selected.
Defaults to <code>TRUE</code>.</p></dd>


<dt id="arg-zones">zones<a class="anchor" aria-label="anchor" href="#arg-zones"></a></dt>
<dd><p><code>matrix</code> or <code>Matrix</code> object describing the
neighborhood scheme for different zones. Each row and column corresponds
to a different zone in the argument to <code>x</code>, and cell values must
contain binary <code>numeric</code> values (i.e., one or zero) that indicate
if neighboring planning units (as specified in the argument to
<code>data</code>) should be considered neighbors if they are allocated to
different zones. The cell values along the diagonal
of the matrix indicate if planning units that are allocated to the same
zone should be considered neighbors or not. The default argument to
<code>zones</code> is an identity matrix (i.e., a matrix with ones along the
matrix diagonal and zeros elsewhere), so that planning units are
only considered neighbors if they are both allocated to the same zone.</p></dd>


<dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p><code>NULL</code>, <code>matrix</code>, <code>Matrix</code>, <code>data.frame</code>, or
<code>array</code> object showing which planning units are neighbors with each
other. The argument defaults to <code>NULL</code> which means that the
neighborhood data is calculated automatically using the
<code><a href="adjacency_matrix.html">adjacency_matrix()</a></code> function.
See the Data format section for more information.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An updated <code><a href="problem.html">problem()</a></code> object with the constraints added to it.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function uses neighborhood data to identify solutions that
surround planning units with a minimum number of neighbors. It
was inspired by the mathematical formulations detailed in
Billionnet (2013) and Beyer <em>et al.</em> (2016).</p>
    </div>
    <div class="section level2">
    <h2 id="data-format">Data format<a class="anchor" aria-label="anchor" href="#data-format"></a></h2>


<p>The argument to <code>data</code> can be specified using the following formats:</p>
<dl><dt><code>data</code> as a <code>NULL</code> value</dt>
<dd><p>neighborhood data should be calculated
automatically
using the <code><a href="adjacency_matrix.html">adjacency_matrix()</a></code> function. This is the default
argument. Note that the neighborhood data must be manually defined
using one of the other formats below when the planning unit data
in the argument to <code>x</code> is not spatially referenced (e.g.,
in <code>data.frame</code> or <code>numeric</code> format).</p></dd>


<dt><code>data</code> as a <code>matrix</code>/<code>Matrix</code> object</dt>
<dd><p>where rows and columns represent
different planning units and the value of each cell indicates if the
two planning units are neighbors or not. Cell values should be binary
<code>numeric</code> values (i.e., one or zero). Cells that occur along the
matrix diagonal have no effect on the solution at all because each
planning unit cannot be a neighbor with itself.</p></dd>


<dt><code>data</code> as a <code>data.frame</code> object</dt>
<dd><p>containing columns that are named
<code>"id1"</code>, <code>"id2"</code>, and <code>"boundary"</code>. Here, each row
denotes the connectivity between two planning units following the
<em>Marxan</em> format. The <code>"boundary"</code> column should contain
binary <code>numeric</code> values that indicate if the two planning units
specified in the <code>"id1"</code> and <code>"id2"</code> columns are neighbors
or not. This data can be used to describe symmetric or
asymmetric relationships between planning units. By default,
input data is assumed to be symmetric unless asymmetric data is
also included (e.g., if data is present for planning units 2 and 3, then
the same amount of connectivity is expected for planning units 3 and 2,
unless connectivity data is also provided for planning units 3 and 2).
If the argument to <code>x</code> contains multiple zones, then the
<code>"zone1"</code> and <code>"zone2"</code> columns can optionally be provided to manually
specify if the neighborhood data pertain to specific zones. The
<code>"zone1"</code> and <code>"zone2"</code> columns should contain the <code>character</code>
names of the zones. If the columns <code>"zone1"</code> and <code>"zone2"</code>
are present, then the argument to <code>zones</code> must be <code>NULL</code>.</p></dd>


<dt><code>data</code> as an <code>array</code> object</dt>
<dd><p>containing four-dimensions where binary
<code>numeric</code> values indicate if planning unit should be treated
as being neighbors with every other planning unit when they
are allocated to every combination of management zone. The first two
dimensions (i.e., rows and columns) correspond to the planning units,
and second two dimensions correspond to the management zones. For
example, if the argument to <code>data</code> had a value of 1 at the index
<code>data[1, 2, 3, 4]</code> this would indicate that planning unit 1 and
planning unit 2 should be treated as neighbors when they are
allocated to zones 3 and 4 respectively.</p></dd>



</dl></div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Beyer HL, Dujardin Y, Watts ME, and Possingham HP (2016) Solving
conservation planning problems with integer linear programming.
<em>Ecological Modelling</em>, 228: 14–22.</p>
<p>Billionnet A (2013) Mathematical optimization ideas for biodiversity
conservation. <em>European Journal of Operational Research</em>, 231:
514–534.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Other functions for adding constraints:
<code><a href="add_contiguity_constraints.html">add_contiguity_constraints</a>()</code>,
<code><a href="add_feature_contiguity_constraints.html">add_feature_contiguity_constraints</a>()</code>,
<code><a href="add_linear_constraints.html">add_linear_constraints</a>()</code>,
<code><a href="add_locked_in_constraints.html">add_locked_in_constraints</a>()</code>,
<code><a href="add_locked_out_constraints.html">add_locked_out_constraints</a>()</code>,
<code><a href="add_mandatory_allocation_constraints.html">add_mandatory_allocation_constraints</a>()</code>,
<code><a href="add_manual_bounded_constraints.html">add_manual_bounded_constraints</a>()</code>,
<code><a href="add_manual_locked_constraints.html">add_manual_locked_constraints</a>()</code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># load data</span></span></span>
<span class="r-in"><span><span class="va">sim_pu_raster</span> <span class="op">&lt;-</span> <span class="fu"><a href="sim_data.html">get_sim_pu_raster</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sim_features</span> <span class="op">&lt;-</span> <span class="fu"><a href="sim_data.html">get_sim_features</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sim_zones_pu_raster</span> <span class="op">&lt;-</span> <span class="fu"><a href="sim_data.html">get_sim_zones_pu_raster</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sim_zones_features</span> <span class="op">&lt;-</span> <span class="fu"><a href="sim_data.html">get_sim_zones_features</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># create minimal problem</span></span></span>
<span class="r-in"><span><span class="va">p1</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="problem.html">problem</a></span><span class="op">(</span><span class="va">sim_pu_raster</span>, <span class="va">sim_features</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="add_min_set_objective.html">add_min_set_objective</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="add_relative_targets.html">add_relative_targets</a></span><span class="op">(</span><span class="fl">0.1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="add_default_solver.html">add_default_solver</a></span><span class="op">(</span>verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># create problem with constraints that require 1 neighbor</span></span></span>
<span class="r-in"><span><span class="co"># and neighbors are defined using a rook-style neighborhood</span></span></span>
<span class="r-in"><span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="va">p1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">add_neighbor_constraints</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># create problem with constraints that require 2 neighbor</span></span></span>
<span class="r-in"><span><span class="co"># and neighbors are defined using a rook-style neighborhood</span></span></span>
<span class="r-in"><span><span class="va">p3</span> <span class="op">&lt;-</span> <span class="va">p1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">add_neighbor_constraints</span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># create problem with constraints that require 3 neighbor</span></span></span>
<span class="r-in"><span><span class="co"># and neighbors are defined using a queen-style neighborhood</span></span></span>
<span class="r-in"><span><span class="va">p4</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>  <span class="va">p1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu">add_neighbor_constraints</span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="fl">3</span>, data <span class="op">=</span> <span class="fu"><a href="adjacency_matrix.html">adjacency_matrix</a></span><span class="op">(</span><span class="va">sim_pu_raster</span>, directions <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># solve problems</span></span></span>
<span class="r-in"><span><span class="va">s1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="solve.html">solve</a></span><span class="op">(</span><span class="va">p1</span><span class="op">)</span>, <span class="fu"><a href="solve.html">solve</a></span><span class="op">(</span><span class="va">p2</span><span class="op">)</span>, <span class="fu"><a href="solve.html">solve</a></span><span class="op">(</span><span class="va">p3</span><span class="op">)</span>, <span class="fu"><a href="solve.html">solve</a></span><span class="op">(</span><span class="va">p4</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">s1</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"basic solution"</span>, <span class="st">"1 neighbor"</span>, <span class="st">"2 neighbors"</span>, <span class="st">"3 neighbors"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># plot solutions</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">s1</span>, axes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="add_neighbor_constraints-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># create minimal problem with multiple zones</span></span></span>
<span class="r-in"><span><span class="va">p5</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="problem.html">problem</a></span><span class="op">(</span><span class="va">sim_zones_pu_raster</span>, <span class="va">sim_zones_features</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="add_min_set_objective.html">add_min_set_objective</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="add_relative_targets.html">add_relative_targets</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0.1</span>, ncol <span class="op">=</span> <span class="fl">3</span>, nrow <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="add_default_solver.html">add_default_solver</a></span><span class="op">(</span>verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># create problem where selected planning units require at least 2 neighbors</span></span></span>
<span class="r-in"><span><span class="co"># for each zone and planning units are only considered neighbors if they</span></span></span>
<span class="r-in"><span><span class="co"># are allocated to the same zone</span></span></span>
<span class="r-in"><span><span class="va">z6</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">z6</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      [,1] [,2] [,3]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,]    1    0    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,]    0    1    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,]    0    0    1</span>
<span class="r-in"><span><span class="va">p6</span> <span class="op">&lt;-</span> <span class="va">p5</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">add_neighbor_constraints</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>, zones <span class="op">=</span> <span class="va">z6</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># create problem where the planning units in zone 1 don't explicitly require</span></span></span>
<span class="r-in"><span><span class="co"># any neighbors, planning units in zone 2 require at least 1 neighbors, and</span></span></span>
<span class="r-in"><span><span class="co"># planning units in zone 3 require at least 2 neighbors. As before, planning</span></span></span>
<span class="r-in"><span><span class="co"># units are still only considered neighbors if they are allocated to the</span></span></span>
<span class="r-in"><span><span class="co"># same zone</span></span></span>
<span class="r-in"><span><span class="va">p7</span> <span class="op">&lt;-</span> <span class="va">p5</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">add_neighbor_constraints</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, zones <span class="op">=</span> <span class="va">z6</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># create problem given the same constraints as outlined above, except</span></span></span>
<span class="r-in"><span><span class="co"># that when determining which selected planning units are neighbors,</span></span></span>
<span class="r-in"><span><span class="co"># planning units that are allocated to zone 1 and zone 2 can also treated</span></span></span>
<span class="r-in"><span><span class="co"># as being neighbors with each other</span></span></span>
<span class="r-in"><span><span class="va">z8</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">z8</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span></span>
<span class="r-in"><span><span class="va">z8</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">z8</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      [,1] [,2] [,3]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,]    1    1    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,]    1    1    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,]    0    0    1</span>
<span class="r-in"><span><span class="va">p8</span> <span class="op">&lt;-</span> <span class="va">p5</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">add_neighbor_constraints</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, zones <span class="op">=</span> <span class="va">z8</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># solve problems</span></span></span>
<span class="r-in"><span><span class="va">s2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">p5</span>, <span class="va">p6</span>, <span class="va">p7</span>, <span class="va">p8</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">s2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">s2</span>, <span class="va">solve</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">s2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">s2</span>, <span class="va">category_layer</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">s2</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">s2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">s2</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"basic problem"</span>, <span class="st">"p6"</span>, <span class="st">"p7"</span>, <span class="st">"p8"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># plot solutions</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">s2</span>, main <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">s2</span><span class="op">)</span>, axes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="add_neighbor_constraints-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://jeffrey-hanson.com" class="external-link">Jeffrey O Hanson</a>, <a href="http://www.richard-schuster.com" class="external-link">Richard Schuster</a>, Nina Morrell, <a href="http://strimas.com" class="external-link">Matthew Strimas-Mackey</a>, Brandon P M Edwards, Matthew E Watts, <a href="https://arcese.forestry.ubc.ca" class="external-link">Peter Arcese</a>, Joseph R Bennett, <a href="http://www.possinghamlab.org" class="external-link">Hugh P Possingham</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

