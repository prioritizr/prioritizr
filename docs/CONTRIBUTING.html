<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Contributing • prioritizr</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png"><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><link href="extra.css" rel="stylesheet"><meta property="og:title" content="Contributing"><meta property="og:image" content="https://prioritizr.net/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-70466840-4"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-70466840-4');
</script></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">prioritizr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">8.0.3.4</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="articles/prioritizr.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="articles/package_overview.html">Package overview</a>
    <a class="dropdown-item" href="articles/gurobi_installation_guide.html">Gurobi installation guide</a>
    <a class="dropdown-item" href="articles/solver_benchmarks.html">Solver benchmarks</a>
    <a class="dropdown-item" href="articles/publication_record.html">Publication record</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-tutorials">Tutorials</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-tutorials">
    <a class="dropdown-item" href="articles/connectivity_tutorial.html">Connectivity</a>
    <a class="dropdown-item" href="articles/calibrating_trade-offs_tutorial.html">Calibrating trade-offs</a>
    <a class="dropdown-item" href="articles/management_zones_tutorial.html">Management zones</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/prioritizr/prioritizr/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-title-body">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="logo.png" class="logo" alt=""><h1>Contributing</h1>
      <small class="dont-index">Source: <a href="https://github.com/prioritizr/prioritizr/blob/HEAD/CONTRIBUTING.md" class="external-link"><code>CONTRIBUTING.md</code></a></small>
    </div>

<div id="contributing" class="section level1">
<!--- CONTRIBUTING.md is generated from CONTRIBUTING.Rmd. Please edit that file --><p>First of all, thanks for thinking about contributing to the <em>prioritizr R</em> package! This is an open source project, and contributions are extremely welcome.</p>
<div class="section level2">
<h2 id="how-you-can-contribute">How you can contribute<a class="anchor" aria-label="anchor" href="#how-you-can-contribute"></a></h2>
<p>There are several ways you can contribute to this project. If you want to know more about why and how to contribute to open source projects like this one, see this <a href="https://opensource.guide/how-to-contribute/" class="external-link">Open Source Guide</a>.</p>
<div class="section level3">
<h3 id="ask-a-question">Ask a question<a class="anchor" aria-label="anchor" href="#ask-a-question"></a></h3>
<p>Using the package and got stuck? Browse the <a href="https://prioritizr.net">documentation</a> to see if you can find a solution. Still stuck? Post your question as an <a href="https://github.com/prioritizr/prioritizr/issues/new" class="external-link">issue on GitHub</a>. While we cannot offer user support, we’ll try to do our best to address it, as questions often lead to better documentation or the discovery of bugs.</p>
<p>Want to ask a question in private? Please feel free to email the package developers <a href="mailto:jeffrey.hanson@uqconnect.edu.au">Jeffrey Hanson</a> or <a href="mailto:richard.schuster@natureconservancy.ca">Richard Schuster</a>.</p>
</div>
<div class="section level3">
<h3 id="propose-an-idea">Propose an idea<a class="anchor" aria-label="anchor" href="#propose-an-idea"></a></h3>
<p>Have an idea for a new feature? Take a look at the <a href="https://prioritizr.net">documentation</a> and <a href="https://github.com/prioritizr/prioritizr/issues" class="external-link">issue tracker</a> to see if it isn’t included or suggested yet. If not, suggest your idea as an <a href="https://github.com/prioritizr/prioritizr/issues/new" class="external-link">issue on GitHub</a>. While we can’t promise to implement your idea, it helps to:</p>
<ul><li>Explain in detail how it would work.</li>
<li>Keep the scope as narrow as possible.</li>
</ul><p>See below if you want to contribute code for your idea as well.</p>
</div>
<div class="section level3">
<h3 id="report-a-bug">Report a bug<a class="anchor" aria-label="anchor" href="#report-a-bug"></a></h3>
<p>Using the package and discovered a bug? That’s annoying! Don’t let others have the same experience and report it as an <a href="https://github.com/prioritizr/prioritizr/issues/new" class="external-link">issue on GitHub</a> so we can fix it. A good bug report makes it easier for us to do so, so please include:</p>
<ul><li>Your operating system name and version (e.g., Mac OS 10.13.6).</li>
<li>Details about your local setup that might be helpful in troubleshooting, such as your session information (via <code><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo()</a></code>).</li>
<li>Detailed steps to reproduce the bug.</li>
</ul></div>
<div class="section level3">
<h3 id="improve-the-documentation">Improve the documentation<a class="anchor" aria-label="anchor" href="#improve-the-documentation"></a></h3>
<p>Noticed a typo on the website? Think a function could use a better example? Good documentation makes all the difference, so your help to improve it is very welcome!</p>
<div class="section level4">
<h4 id="the-website">The website<a class="anchor" aria-label="anchor" href="#the-website"></a></h4>
<p><a href="https://prioritizr.net">This website</a> is generated using the <a href="http://pkgdown.r-lib.org/" class="external-link"><em>pkgdown R</em> package</a> package. That means we don’t have to write any html: content is pulled together from documentation in the code, vignettes, <a href="https://guides.github.com/features/mastering-markdown/" class="external-link">Markdown</a> files, the package <code>DESCRIPTION</code> and <code>_pkgdown.yml</code> settings. If you know your way around <code>pkgdown</code>, you can <a href="https://help.github.com/articles/editing-files-in-another-user-s-repository/" class="external-link">propose a file change</a> to improve documentation. If not, <a href="https://github.com/prioritizr/prioritizr/issues/new" class="external-link">report an issue</a> and we can point you in the right direction.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="learning-resources">Learning resources<a class="anchor" aria-label="anchor" href="#learning-resources"></a></h2>
<p>If you’re new too R package development, we recommend reading the <a href="http://adv-r.had.co.nz/" class="external-link"><em>Advanced R</em></a> book. Since a large part of the code base is written in the C++ programming language using the <a href="https://www.rcpp.org/" class="external-link"><em>Rcpp R</em> package</a>, we also recommend reading the <a href="https://teuder.github.io/rcpp4everyone_en/" class="external-link"><em>Rcpp for everyone</em></a> book. Both of these are books are free, online, and absolutely fantastic resources.</p>
<div class="section level4">
<h4 id="function-documentation">Function documentation<a class="anchor" aria-label="anchor" href="#function-documentation"></a></h4>
<p>Functions are described as comments near their code and translated to documentation using the <a href="https://github.com/r-lib/roxygen2" class="external-link"><em>roxygen2 R</em> package</a> package. If you want to improve a function description:</p>
<ol style="list-style-type: decimal"><li>Go to <code>R/</code> directory in the <a href="https://github.com/prioritizr/prioritizr" class="external-link">code repository</a>.</li>
<li>Look for the file with the name of the function.</li>
<li>
<a href="https://help.github.com/articles/editing-files-in-another-user-s-repository/" class="external-link">Propose a file change</a> to update the function documentation in the roxygen comments (starting with <code>#'</code>).</li>
</ol></div>
<div class="section level3">
<h3 id="contribute-code">Contribute code<a class="anchor" aria-label="anchor" href="#contribute-code"></a></h3>
<p>Care to fix bugs or implement new functionality? That’s brilliant! Have a look at the <a href="https://github.com/prioritizr/prioritizr/issues" class="external-link">issue list</a> and leave a comment on the things you want to work on. See also the development guidelines below. Please note that we use American spelling for the package, and follow the <a href="https://style.tidyverse.org/" class="external-link">tidyverse style guide</a>.</p>
</div>
</div>
<div class="section level2">
<h2 id="development-guidelines">Development guidelines<a class="anchor" aria-label="anchor" href="#development-guidelines"></a></h2>
<p>We try to follow the <a href="https://guides.github.com/introduction/flow/" class="external-link">GitHub flow</a> for development.</p>
<ol style="list-style-type: decimal"><li>Fork <a href="https://github.com/prioritizr/prioritizr" class="external-link">this repo</a> and clone it to your computer. To learn more about this process, see <a href="https://guides.github.com/activities/forking/" class="external-link">this guide</a>.</li>
<li>If you have forked and cloned the project before and it has been a while since you worked on it, <a href="https://help.github.com/articles/merging-an-upstream-repository-into-your-fork/" class="external-link">pull changes from the original repo</a> to your clone by using <code>git pull upstream master</code>.</li>
<li>Open the RStudio project file (<code>.Rproj</code>).</li>
<li>Make your changes:<ul><li>Write your code.</li>
<li>Test your code (bonus points for adding unit tests).</li>
<li>Document your code (see function documentation above).</li>
<li>Check your code with <code><a href="https://devtools.r-lib.org/reference/check.html" class="external-link">devtools::check()</a></code> and aim for 0 errors and warnings.</li>
</ul></li>
<li>Commit and push your changes.</li>
<li>Submit a <a href="https://guides.github.com/activities/forking/#making-a-pull-request" class="external-link">pull request</a>.</li>
</ol></div>
<div class="section level2">
<h2 id="internal-design">Internal design<a class="anchor" aria-label="anchor" href="#internal-design"></a></h2>
<p>Here we describe the internal design of the package. A <code>ConservationProblem</code> class (defined in <code>R/ConservationProblem-class.R</code>) is used to store the data and problem formulation of the conservation planning problem. Additionally, an <code>OptimizationProblem</code> class (defined in <code>R/OptimizationProblem-class.R</code>) is used to store the precise mathematical formulation of a conservation planning problem. When a <code>ConservationProblem</code> object is solved (using the <code><a href="reference/solve.html">solve()</a></code> function), the <code>ConservationProblem</code> object is first compiled into an <code>OptimizationProblem</code> object (using the <code><a href="reference/compile.html">compile()</a></code> function) and the <code>OptimizationProblem</code> object is then solved (using the <code><a href="reference/solve.html">solve()</a></code> function). This distinction is important because if you want to add a new objective, constraint, penalty, or decision function, then you’ll need to write code that adds the mathematical formulation of the function to a <code>OptimizationProblem</code> object.</p>
<p>All <code>OptimizationProblem</code> objects are simply a wrapper to an external pointer pointer (<code>XPtr</code>) that points to a C++ <code>OPTIMIZATIONPROBLEM</code> class object (defined in <code>src/optimization_problem.h</code>). The C++ <code>OPTIMIZATIONPROBLEM</code> class contains the standard data needed to formulate a mixed integer linear programming problem (i.e., model sense, problem objective , constraint matrix, constraint senses, right-hand-side values, variable decision types, and variable bounds). This class also contains additional data that pertain to conservation problems (i.e., number of features, planning units, and zones). If you’re is unfamiliar with the standard representation of a mixed integer linear programming problem, we encourage them to read the documentation for the <a href="http://www.gurobi.com/documentation/8.0/refman/r_api_overview.html#r:problem" class="external-link"><em>gurobi R</em> package</a>. The fields <code>A_i</code>, <code>A_j</code>, and <code>A_x</code> correspond the row, column, and cells values for the constraint matrix of the optimization problem (respectively). The other fields follow standard conventions. Note that the constraint matrix is, ultimately, constructed as a <code><a href="https://rdrr.io/pkg/Matrix/man/sparseMatrix.html" class="external-link">Matrix::sparseMatrix()</a></code> so row and column indices do not need to be sequential. Additionally, all C++ constraint and penalty functions should be independent. In other words, though it may be computationally efficient to reuse constraints and variables encoded in other functions, each C++ constraint and penalty function define its own constraints and variables. All conservation planning problems are defined following one of two standard mathematical formulations: the compressed and the expanded formulation.</p>
<p>The compressed formulation defines a problem which assumes that all instances of a conserved feature are used to achieve the target or count towards the benefit of a solution. Although the expanded formulation can provide identical solutions to the compressed formulation, the compressed formulation is provided because it is simpler and can be used with much larger sized problems. Currently, all constraints use the compressed formulation except for the <code><a href="reference/add_feature_contiguity_constraints.html">add_feature_contiguity_constraints()</a></code> function. Under this formulation, the first set of decision variables (the first number of planning units <span class="math inline">×</span> number of zones) always pertain to the state of the planning units. Thus in a problem containing 3 planning units and 2 zones, the first six variables indicate the allocation of: planning unit 1 in zone 1, planning unit 2 in zone 1, planning unit 3 in zone 1, planning unit 1 in zone 2, planning unit 2 in zone 2, planning unit 3 in zone 2. The first set of constraints (rows) always correspond to each target (noting that some objectives use “fake” targets to initialize the feature by planning unit data, see <code>R/compile.R</code>). These rows, which each correspond to a single target, contain the amount of each feature in each zone for which the target pertains. Thus rows for targets which pertain to a single zone will only contain feature abundance data for planning units (columns) in a single zone, and rows for targets which pertain to a single feature in multiple zones will contain feature abundance data for planning units (columns) in multiple zones.</p>
<p>To help illustrate the compressed formulation, consider the following problem:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># simulate data</span></span>
<span><span class="va">pu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, cost_1 <span class="op">=</span> <span class="fl">4</span><span class="op">:</span><span class="fl">6</span>, cost_2 <span class="op">=</span> <span class="fl">7</span><span class="op">:</span><span class="fl">9</span><span class="op">)</span></span>
<span><span class="va">zone</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"z1"</span>, <span class="st">"z2"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">feature</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"f1"</span>, <span class="st">"f2"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">rij</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>pu <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, species <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, zone <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">rij</span><span class="op">$</span><span class="va">amount</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">rij</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">rij</span><span class="op">)</span></span>
<span><span class="va">targets</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span>, nrow <span class="op">=</span> <span class="fl">2</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create problem</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="reference/problem.html">problem</a></span><span class="op">(</span><span class="va">pu</span>, <span class="va">feature</span>, <span class="va">rij</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cost_1"</span>, <span class="st">"cost_2"</span><span class="op">)</span>, <span class="va">zone</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="reference/add_absolute_targets.html">add_absolute_targets</a></span><span class="op">(</span><span class="va">targets</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print problem</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="do">## A conservation problem (&lt;ConservationProblem&gt;)</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="do">## ├•data</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="do">## │├•zones:       "z1" and "z2" (2 total)</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="do">## │├•features:    "f1" and "f2" (2 total)</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="do">## │└•planning units:</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="do">## │ ├•data:       &lt;data.frame&gt; (3 total)</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="do">## │ ├•costs:      continuous values (between 4 and 9)</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="do">## │ ├•extent:     NA</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="do">## │ └•CRS:        NA</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="do">## └•formulation</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="do">##  ├•objective:   none specified</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="do">##  ├•penalties:   none specified</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="do">##  ├•targets:     absolute targets (between 1 and 1)</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a><span class="do">##  ├•constraints: none specified</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a><span class="do">##  ├•decisions:   binary decision</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a><span class="do">##  ├•portfolio:   shuffle portfolio (`number_solutions` = 1, …)</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a><span class="do">##  └•solver:      gurobi solver (`gap` = 0.1, `time_limit` = 2147483647, `first_feasible` = FALSE, …)</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a><span class="do">## # ℹ Use `summary(...)` to see complete formulation.</span></span></code></pre></div>
<p>The compressed formulation expresses the planning unit and feature data using the following constraint matrix. Here, each variable (column) corresponds to a different planning unit and a different zone allocation, each constraint (row) corresponds to a different target, and each cell corresponds to the amount of a each feature in each planning unit given a different zone (based on the <em>rij</em> data and the targets).</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 x 6 sparse Matrix of class "dgCMatrix"</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="do">##              pu1_z1 pu2_z1 pu3_z1 pu1_z2 pu2_z2 pu3_z2</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="do">## target_f1_z1     13     14     15      .      .      .</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="do">## target_f2_z1     16     17     18      .      .      .</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="do">## target_f1_z2      .      .      .     19     20     21</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="do">## target_f2_z2      .      .      .     22     23     24</span></span></code></pre></div>
<p>The expanded formulation, on the other hand, defines a problem which can allow for some instances of conserved features to not be used for achieving the targets or maximizing the conservation benefit. This formulation is a generalized version of the compressed formulation. It contains additional variables (columns) and constraints (rows) for each combination of feature, planning unit, and zone that indicate if a given planning unit allocated to a specific zone is also allocated to conserve a given feature.</p>
<p>Given the previous problem, the expanded formulation expresses the planning unit and feature data in the constraint matrix as:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># generate targets</span></span>
<span><span class="va">targets2</span> <span class="op">&lt;-</span> <span class="va">p</span><span class="op">$</span><span class="va">targets</span><span class="op">$</span><span class="fu">output</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create matrix</span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span>
<span>  <span class="cn">NA</span>,</span>
<span>  ncol <span class="op">=</span></span>
<span>    <span class="op">(</span><span class="va">p</span><span class="op">$</span><span class="fu">number_of_zones</span><span class="op">(</span><span class="op">)</span> <span class="op">*</span> <span class="va">p</span><span class="op">$</span><span class="fu">number_of_planning_units</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="op">(</span><span class="va">p</span><span class="op">$</span><span class="fu">number_of_zones</span><span class="op">(</span><span class="op">)</span> <span class="op">*</span> <span class="va">p</span><span class="op">$</span><span class="fu">number_of_planning_units</span><span class="op">(</span><span class="op">)</span> <span class="op">*</span></span>
<span>      <span class="va">p</span><span class="op">$</span><span class="fu">number_of_features</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  nrow <span class="op">=</span></span>
<span>    <span class="op">(</span><span class="va">p</span><span class="op">$</span><span class="fu">number_of_zones</span><span class="op">(</span><span class="op">)</span> <span class="op">*</span> <span class="va">p</span><span class="op">$</span><span class="fu">number_of_planning_units</span><span class="op">(</span><span class="op">)</span> <span class="op">*</span></span>
<span>      <span class="va">p</span><span class="op">$</span><span class="fu">number_of_features</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="op">(</span><span class="va">p</span><span class="op">$</span><span class="fu">number_of_features</span><span class="op">(</span><span class="op">)</span> <span class="op">*</span> <span class="va">p</span><span class="op">$</span><span class="fu">number_of_zones</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># add row names</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>    <span class="st">"pu"</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">p</span><span class="op">$</span><span class="fu">number_of_planning_units</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      <span class="va">p</span><span class="op">$</span><span class="fu">number_of_zones</span><span class="op">(</span><span class="op">)</span> <span class="op">*</span> <span class="va">p</span><span class="op">$</span><span class="fu">number_of_features</span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="st">"_"</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">p</span><span class="op">$</span><span class="fu">feature_names</span><span class="op">(</span><span class="op">)</span>, each <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="fu">number_of_planning_units</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      <span class="va">p</span><span class="op">$</span><span class="fu">number_of_zones</span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="st">"_"</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span></span>
<span>      <span class="va">p</span><span class="op">$</span><span class="fu">zone_names</span><span class="op">(</span><span class="op">)</span>,</span>
<span>      each <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="fu">number_of_planning_units</span><span class="op">(</span><span class="op">)</span> <span class="op">*</span> <span class="va">p</span><span class="op">$</span><span class="fu">number_of_features</span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>    <span class="st">"target_"</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span></span>
<span>      <span class="va">p</span><span class="op">$</span><span class="fu">feature_names</span><span class="op">(</span><span class="op">)</span>, <span class="va">p</span><span class="op">$</span><span class="fu">number_of_zones</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>, <span class="st">"_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">p</span><span class="op">$</span><span class="fu">zone_names</span><span class="op">(</span><span class="op">)</span>,</span>
<span>      each <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="fu">number_of_features</span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># add column names</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>    <span class="st">"pu"</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">p</span><span class="op">$</span><span class="fu">number_of_planning_units</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>, <span class="va">p</span><span class="op">$</span><span class="fu">number_of_zones</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="st">"_"</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">p</span><span class="op">$</span><span class="fu">zone_names</span><span class="op">(</span><span class="op">)</span>, each <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="fu">number_of_planning_units</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>    <span class="st">"pu"</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">p</span><span class="op">$</span><span class="fu">number_of_planning_units</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      <span class="va">p</span><span class="op">$</span><span class="fu">number_of_zones</span><span class="op">(</span><span class="op">)</span> <span class="op">*</span> <span class="va">p</span><span class="op">$</span><span class="fu">number_of_features</span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="st">"_"</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">p</span><span class="op">$</span><span class="fu">feature_names</span><span class="op">(</span><span class="op">)</span>, each <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="fu">number_of_planning_units</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      <span class="va">p</span><span class="op">$</span><span class="fu">number_of_zones</span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="st">"_"</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span></span>
<span>      <span class="va">p</span><span class="op">$</span><span class="fu">zone_names</span><span class="op">(</span><span class="op">)</span>,</span>
<span>      each <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="fu">number_of_planning_units</span><span class="op">(</span><span class="op">)</span> <span class="op">*</span></span>
<span>      <span class="va">p</span><span class="op">$</span><span class="fu">number_of_features</span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># add in indicator variables and constraints</span></span>
<span><span class="va">curr_row</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">z</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">p</span><span class="op">$</span><span class="fu">number_of_zones</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">p</span><span class="op">$</span><span class="fu">number_of_features</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">p</span><span class="op">$</span><span class="fu">number_of_planning_units</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">curr_row</span> <span class="op">&lt;-</span> <span class="va">curr_row</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>      <span class="va">curr_col1</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="op">(</span><span class="va">z</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="va">p</span><span class="op">$</span><span class="fu">number_of_planning_units</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="va">j</span></span>
<span>      <span class="va">curr_col2</span> <span class="op">&lt;-</span></span>
<span>        <span class="op">(</span><span class="va">p</span><span class="op">$</span><span class="fu">number_of_planning_units</span><span class="op">(</span><span class="op">)</span> <span class="op">*</span> <span class="va">p</span><span class="op">$</span><span class="fu">number_of_zones</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="op">(</span><span class="op">(</span><span class="va">z</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="va">p</span><span class="op">$</span><span class="fu">number_of_features</span><span class="op">(</span><span class="op">)</span> <span class="op">*</span> <span class="va">p</span><span class="op">$</span><span class="fu">number_of_planning_units</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="op">(</span><span class="op">(</span><span class="va">i</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="va">p</span><span class="op">$</span><span class="fu">number_of_planning_units</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="va">j</span></span>
<span>      <span class="va">m</span><span class="op">[</span><span class="va">curr_row</span>, <span class="va">curr_col1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">1</span></span>
<span>      <span class="va">m</span><span class="op">[</span><span class="va">curr_row</span>, <span class="va">curr_col2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># add in targets</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">targets2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># extract indices</span></span>
<span>  <span class="va">curr_row</span> <span class="op">&lt;-</span> <span class="va">curr_row</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>  <span class="va">curr_feature</span> <span class="op">&lt;-</span> <span class="va">targets2</span><span class="op">$</span><span class="va">feature</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>  <span class="va">curr_zone</span> <span class="op">&lt;-</span> <span class="va">targets2</span><span class="op">$</span><span class="va">zone</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">curr_cols</span> <span class="op">&lt;-</span></span>
<span>    <span class="op">(</span><span class="va">p</span><span class="op">$</span><span class="fu">number_of_planning_units</span><span class="op">(</span><span class="op">)</span> <span class="op">*</span> <span class="va">p</span><span class="op">$</span><span class="fu">number_of_zones</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="op">(</span><span class="op">(</span><span class="va">curr_zone</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="va">p</span><span class="op">$</span><span class="fu">number_of_features</span><span class="op">(</span><span class="op">)</span> <span class="op">*</span> <span class="va">p</span><span class="op">$</span><span class="fu">number_of_planning_units</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="op">(</span><span class="op">(</span><span class="va">curr_feature</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="va">p</span><span class="op">$</span><span class="fu">number_of_planning_units</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">p</span><span class="op">$</span><span class="fu">number_of_planning_units</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">curr_amount</span> <span class="op">&lt;-</span></span>
<span>    <span class="va">rij</span><span class="op">$</span><span class="va">amount</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">rij</span><span class="op">$</span><span class="va">zone</span><span class="op">)</span> <span class="op">==</span> <span class="va">curr_zone</span> <span class="op">&amp;</span> <span class="va">rij</span><span class="op">$</span><span class="va">species</span> <span class="op">==</span> <span class="va">curr_feature</span><span class="op">]</span></span>
<span>  <span class="co"># set matrix values</span></span>
<span>  <span class="va">m</span><span class="op">[</span><span class="va">curr_row</span>, <span class="va">curr_cols</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">curr_amount</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># convert to sparse matrix</span></span>
<span><span class="va">m</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu">as</span><span class="op">(</span><span class="va">m</span>, <span class="st">"sparseMatrix"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print matrix</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="do">## 16 x 18 sparse Matrix of class "dgCMatrix"</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="do">##   [[ suppressing 18 column names 'pu1_z1', 'pu2_z1', 'pu3_z1' ... ]]</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="do">##                                                                   </span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="do">## pu1_f1_z1    -1  .  .  .  .  .  1  .  .  .  .  .  .  .  .  .  .  .</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="do">## pu2_f1_z1     . -1  .  .  .  .  .  1  .  .  .  .  .  .  .  .  .  .</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="do">## pu3_f1_z1     .  . -1  .  .  .  .  .  1  .  .  .  .  .  .  .  .  .</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="do">## pu1_f2_z1    -1  .  .  .  .  .  .  .  .  1  .  .  .  .  .  .  .  .</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="do">## pu2_f2_z1     . -1  .  .  .  .  .  .  .  .  1  .  .  .  .  .  .  .</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="do">## pu3_f2_z1     .  . -1  .  .  .  .  .  .  .  .  1  .  .  .  .  .  .</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="do">## pu1_f1_z2     .  .  . -1  .  .  .  .  .  .  .  .  1  .  .  .  .  .</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="do">## pu2_f1_z2     .  .  .  . -1  .  .  .  .  .  .  .  .  1  .  .  .  .</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="do">## pu3_f1_z2     .  .  .  .  . -1  .  .  .  .  .  .  .  .  1  .  .  .</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="do">## pu1_f2_z2     .  .  . -1  .  .  .  .  .  .  .  .  .  .  .  1  .  .</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="do">## pu2_f2_z2     .  .  .  . -1  .  .  .  .  .  .  .  .  .  .  .  1  .</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="do">## pu3_f2_z2     .  .  .  .  . -1  .  .  .  .  .  .  .  .  .  .  .  1</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="do">## target_f1_z1  .  .  .  .  .  . 13 14 15  .  .  .  .  .  .  .  .  .</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="do">## target_f2_z1  .  .  .  .  .  .  .  .  . 16 17 18  .  .  .  .  .  .</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="do">## target_f1_z2  .  .  .  .  .  .  .  .  .  .  .  . 19 20 21  .  .  .</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="do">## target_f2_z2  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 22 23 24</span></span></code></pre></div>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by <a href="https://jeffrey-hanson.com" class="external-link">Jeffrey O Hanson</a>, <a href="http://www.richard-schuster.com" class="external-link">Richard Schuster</a>, Nina Morrell, <a href="http://strimas.com" class="external-link">Matthew Strimas-Mackey</a>, Brandon P M Edwards, Matthew E Watts, <a href="https://arcese.forestry.ubc.ca" class="external-link">Peter Arcese</a>, <a href="https://josephrbennett.wordpress.com" class="external-link">Joseph Bennett</a>, <a href="http://www.possinghamlab.org" class="external-link">Hugh P Possingham</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

