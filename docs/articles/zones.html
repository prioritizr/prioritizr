<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Management Zones • prioritizr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Management Zones">
<meta property="og:description" content="prioritizr">
<meta property="og:image" content="https://prioritizr.net/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-70466840-4"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-70466840-4');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">prioritizr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">5.0.1.6</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/prioritizr.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/gurobi_installation.html">Gurobi Installation Guide</a>
    </li>
    <li>
      <a href="../articles/publication_record.html">Publication Record</a>
    </li>
    <li>
      <a href="../articles/saltspring.html">Salt Spring Island Tutorial</a>
    </li>
    <li>
      <a href="../articles/tasmania.html">Tasmania Tutorial</a>
    </li>
    <li>
      <a href="../articles/zones.html">Management Zones</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/prioritizr/prioritizr/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Management Zones</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/prioritizr/prioritizr/blob/master/vignettes/zones.Rmd"><code>vignettes/zones.Rmd</code></a></small>
      <div class="hidden name"><code>zones.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>One of the main aims in conservation planning is to identify the most cost-effective set of areas to manage biodiversity <span class="citation">(Margules &amp; Pressey 2000)</span>. To achieve this, prioritizations are generally created to identify areas for expanding protected area systems. However, many real-world conservation problems do not simply involve deciding if an area should be protected or not <span class="citation">(e.g. Klein <em>et al.</em> 2009; Stigner <em>et al.</em> 2016)</span>. Instead, many real-world problems involve a range of different management categories and the goal is to determine which areas should be allocated to which management category. For example, a manager might have a range of different methods (e.g. baiting or trapping at various intensities) for controlling invasive pests in a set of different areas <span class="citation">(e.g. Cattarino <em>et al.</em> 2018)</span>. They would need a prioritization that shows which control methods should be implemented in which areas. In this particular case, a binary prioritization showing which areas contain the most biodiversity is simply not helpful. Furthermore, many real-world problems require decisions that meet multiple, and sometimes conflicting, objectives from different stakeholders. For example, a manager might need to implement a set of no-take and partial-take areas to prevent overfishing, but also ensure that there still remain plenty of areas for fishing activities <span class="citation">(e.g. Wilson <em>et al.</em> 2010; Klein <em>et al.</em> 2013)</span>. Popularized by <em>Marxan with Zones</em> <span class="citation">(Watts <em>et al.</em> 2009)</span>, this concept has become known as “zones” and is becoming increasingly important in conservation planning.</p>
<p>The aim of this vignette is to showcase the zones functionality of the <em>prioritizr R</em> package. It will assume a certain level of familiarity with conservation planning terminology and the <em>prioritizr R</em> package. We recommend reading the <a href="prioritizr.html"><em>prioritizr</em> vignette</a> first if you don’t have much experience in either of these topics.</p>
</div>
<div id="usage" class="section level2">
<h2 class="hasAnchor">
<a href="#usage" class="anchor"></a>Usage</h2>
<div id="simple-minimum-set-problem" class="section level3">
<h3 class="hasAnchor">
<a href="#simple-minimum-set-problem" class="anchor"></a>Simple minimum set problem</h3>
<p>In the <em>prioritizr R</em> package, all conservation planning problems—including those which contain multiple management zones or actions—are initialized using the <code>problem</code> function. To refresh our memory on how we can construct problems using the <em>prioritizr R</em> package, let us quickly construct a simple conservation planning problem. This problem will use the simulated built-in planning unit and feature data distributed with the package. It will have a minimum set objective, targets which require that solution secure to 10 % of the habitat in the study area for each feature, and binary decision variables indicating that planning units are selected or not selected for protection.</p>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># load prioritizr package</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">prioritizr</span>)</pre></body></html></div>
<pre><code>## Loading required package: raster</code></pre>
<pre><code>## Loading required package: sp</code></pre>
<pre><code>## Loading required package: sf</code></pre>
<pre><code>## Linking to GEOS 3.5.1, GDAL 2.2.2, PROJ 4.9.2</code></pre>
<pre><code>## Loading required package: proto</code></pre>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># load data</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="no">sim_pu_raster</span>, <span class="no">sim_features</span>)

<span class="co"># create targets for each of the five features</span>
<span class="no">t1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">0.1</span>, <span class="fl">5</span>)

<span class="co"># build single-zone problem</span>
<span class="no">p1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/problem.html">problem</a></span>(<span class="no">sim_pu_raster</span>, <span class="no">sim_features</span>) <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/add_min_set_objective.html">add_min_set_objective</a></span>() <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/add_relative_targets.html">add_relative_targets</a></span>(<span class="no">t1</span>) <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/add_binary_decisions.html">add_binary_decisions</a></span>()

<span class="co"># print problem</span>
<span class="fu"><a href="../reference/print.html">print</a></span>(<span class="no">p1</span>)</pre></body></html></div>
<pre><code>## Conservation Problem
##   planning units: RasterLayer (90 units)
##   cost:           min: 190.13276, max: 215.86384
##   features:       layer.1, layer.2, layer.3, ... (5 features)
##   objective:      Minimum set objective 
##   targets:        Relative targets [targets (min: 0.1, max: 0.1)]
##   decisions:      Binary decision 
##   constraints:    &lt;none&gt;
##   penalties:      &lt;none&gt;
##   portfolio:      default
##   solver:         default</code></pre>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># solve problem</span>
<span class="no">s1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/solve.html">solve</a></span>(<span class="no">p1</span>)</pre></body></html></div>
<pre><code>## Gurobi Optimizer version 9.0.1 build v9.0.1rc0 (linux64)
## Optimize a model with 5 rows, 90 columns and 450 nonzeros
## Model fingerprint: 0x6442bf6e
## Variable types: 0 continuous, 90 integer (90 binary)
## Coefficient statistics:
##   Matrix range     [2e-01, 9e-01]
##   Objective range  [2e+02, 2e+02]
##   Bounds range     [1e+00, 1e+00]
##   RHS range        [3e+00, 8e+00]
## Found heuristic solution: objective 2337.9617505
## Presolve time: 0.00s
## Presolved: 5 rows, 90 columns, 450 nonzeros
## Variable types: 0 continuous, 90 integer (90 binary)
## Presolved: 5 rows, 90 columns, 450 nonzeros
## 
## 
## Root relaxation: objective 1.931582e+03, 12 iterations, 0.00 seconds
## 
##     Nodes    |    Current Node    |     Objective Bounds      |     Work
##  Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time
## 
##      0     0 1931.58191    0    4 2337.96175 1931.58191  17.4%     -    0s
## H    0     0                    1987.3985265 1931.58191  2.81%     -    0s
## 
## Explored 1 nodes (12 simplex iterations) in 0.00 seconds
## Thread count was 1 (of 4 available processors)
## 
## Solution count 2: 1987.4 2337.96 
## 
## Optimal solution found (tolerance 1.00e-01)
## Best objective 1.987398526526e+03, best bound 1.931581908865e+03, gap 2.8085%</code></pre>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># calculate feature representation</span>
<span class="no">r1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/feature_representation.html">feature_representation</a></span>(<span class="no">p1</span>, <span class="no">s1</span>)
<span class="fu"><a href="../reference/print.html">print</a></span>(<span class="no">r1</span>)</pre></body></html></div>
<pre><code>## # A tibble: 5 x 3
##   feature absolute_held relative_held
##   &lt;chr&gt;           &lt;dbl&gt;         &lt;dbl&gt;
## 1 layer.1          8.91         0.107
## 2 layer.2          3.13         0.100
## 3 layer.3          7.34         0.102
## 4 layer.4          4.35         0.102
## 5 layer.5          6.01         0.106</code></pre>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># plot solution</span>
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">s1</span>, <span class="kw">main</span> <span class="kw">=</span> <span class="st">"solution"</span>, <span class="kw">axes</span> <span class="kw">=</span> <span class="fl">FALSE</span>, <span class="kw">box</span> <span class="kw">=</span> <span class="fl">FALSE</span>)</pre></body></html></div>
<p><img src="zones_files/figure-html/unnamed-chunk-2-1.png" width="700" style="display: block; margin: auto;"></p>
</div>
<div id="adding-management-zones" class="section level3">
<h3 class="hasAnchor">
<a href="#adding-management-zones" class="anchor"></a>Adding management zones</h3>
<p>Now let us imagine that instead of having a single management zone (e.g. protected area), we have two management zones. Similar to the example above, we require a solution that secures 10 % of the habitat in the study area for each feature in the first management zone. But we also require a solution that secures 5 % of the habitat in the study area for each feature in the second management zone. Each planning unit must be allocated to either zone or not selected for management at all. In this example, each planning unit costs the same when it is allocated to either of the two zones. We can formulate and solve this problem using the following code.</p>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># create a matrix with the targets</span>
<span class="co"># here each column corresponds to a different zone,</span>
<span class="co"># each row corresponds to a different feature, and</span>
<span class="co"># each cell value corresponds to the target</span>
<span class="no">t2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="fl">NA</span>, <span class="kw">ncol</span> <span class="kw">=</span> <span class="fl">2</span>, <span class="kw">nrow</span> <span class="kw">=</span> <span class="fl">5</span>)
<span class="no">t2</span>[, <span class="fl">1</span>] <span class="kw">&lt;-</span> <span class="fl">0.1</span>
<span class="no">t2</span>[, <span class="fl">2</span>] <span class="kw">&lt;-</span> <span class="fl">0.05</span>

<span class="co"># print targets</span>
<span class="fu"><a href="../reference/print.html">print</a></span>(<span class="no">t2</span>)</pre></body></html></div>
<pre><code>##      [,1] [,2]
## [1,]  0.1 0.05
## [2,]  0.1 0.05
## [3,]  0.1 0.05
## [4,]  0.1 0.05
## [5,]  0.1 0.05</code></pre>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># create a zones object that contains the amount of each feature</span>
<span class="co"># in each planning unit when it is allocated to each zone</span>
<span class="co"># since our zones pertain to the same habitat data, we will</span>
<span class="co"># to specify the same habitat data for each zone</span>
<span class="no">z2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/zones.html">zones</a></span>(<span class="st">"zone 1"</span> <span class="kw">=</span> <span class="no">sim_features</span>, <span class="st">"zone 2"</span> <span class="kw">=</span> <span class="no">sim_features</span>)

<span class="co"># print zones</span>
<span class="fu"><a href="../reference/print.html">print</a></span>(<span class="no">z2</span>)</pre></body></html></div>
<pre><code>## Zones
##   zones: zone 1, zone 2 (2 zones)
##   features: 1, 2, 3, ... (5 features)
##   data type: RasterStack</code></pre>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># create a raster stack with the planning unit data</span>
<span class="co"># since our planning unit costs are the same for each zone,</span>
<span class="co"># we will create a stack with two replicates of the cost data</span>
<span class="no">pu2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/stack.html">stack</a></span>(<span class="no">sim_pu_raster</span>, <span class="no">sim_pu_raster</span>)

<span class="co"># print stack</span>
<span class="fu"><a href="../reference/print.html">print</a></span>(<span class="no">pu2</span>)</pre></body></html></div>
<pre><code>## class      : RasterStack 
## dimensions : 10, 10, 100, 2  (nrow, ncol, ncell, nlayers)
## resolution : 0.1, 0.1  (x, y)
## extent     : 0, 1, 0, 1  (xmin, xmax, ymin, ymax)
## crs        : NA 
## names      :  layer.1,  layer.2 
## min values : 190.1328, 190.1328 
## max values : 215.8638, 215.8638</code></pre>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># build two-zone problem</span>
<span class="no">p2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/problem.html">problem</a></span>(<span class="no">pu2</span>, <span class="no">z2</span>) <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/add_min_set_objective.html">add_min_set_objective</a></span>() <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/add_relative_targets.html">add_relative_targets</a></span>(<span class="no">t2</span>) <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/add_binary_decisions.html">add_binary_decisions</a></span>()

<span class="co"># print problem</span>
<span class="fu"><a href="../reference/print.html">print</a></span>(<span class="no">p2</span>)</pre></body></html></div>
<pre><code>## Conservation Problem
##   zones:          zone 1, zone 2 (2 zones)
##   planning units: RasterStack (90 units)
##   cost:           min: 190.13276, max: 215.86384
##   features:       1, 2, 3, ... (5 features)
##   objective:      Minimum set objective 
##   targets:        Relative targets [targets (min: 0.05, max: 0.1)]
##   decisions:      Binary decision 
##   constraints:    &lt;none&gt;
##   penalties:      &lt;none&gt;
##   portfolio:      default
##   solver:         default</code></pre>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># solve problem</span>
<span class="no">s2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/solve.html">solve</a></span>(<span class="no">p2</span>)</pre></body></html></div>
<pre><code>## Gurobi Optimizer version 9.0.1 build v9.0.1rc0 (linux64)
## Optimize a model with 100 rows, 180 columns and 1080 nonzeros
## Model fingerprint: 0xbdab1647
## Variable types: 0 continuous, 180 integer (180 binary)
## Coefficient statistics:
##   Matrix range     [2e-01, 1e+00]
##   Objective range  [2e+02, 2e+02]
##   Bounds range     [1e+00, 1e+00]
##   RHS range        [1e+00, 8e+00]
## Found heuristic solution: objective 3568.4931394
## Presolve time: 0.00s
## Presolved: 100 rows, 180 columns, 1080 nonzeros
## Variable types: 0 continuous, 180 integer (180 binary)
## Presolved: 100 rows, 180 columns, 1080 nonzeros
## 
## 
## Root relaxation: objective 2.911333e+03, 73 iterations, 0.00 seconds
## 
##     Nodes    |    Current Node    |     Objective Bounds      |     Work
##  Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time
## 
##      0     0 2911.33335    0    9 3568.49314 2911.33335  18.4%     -    0s
## H    0     0                    3174.6681958 2911.33335  8.29%     -    0s
## 
## Explored 1 nodes (73 simplex iterations) in 0.01 seconds
## Thread count was 1 (of 4 available processors)
## 
## Solution count 2: 3174.67 3568.49 
## 
## Optimal solution found (tolerance 1.00e-01)
## Best objective 3.174668195776e+03, best bound 2.911333350606e+03, gap 8.2949%</code></pre>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># calculate feature representation</span>
<span class="no">r2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/feature_representation.html">feature_representation</a></span>(<span class="no">p2</span>, <span class="no">s2</span>)
<span class="fu"><a href="../reference/print.html">print</a></span>(<span class="no">r2</span>)</pre></body></html></div>
<pre><code>## # A tibble: 10 x 4
##    feature zone   absolute_held relative_held
##    &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;         &lt;dbl&gt;
##  1 1       zone 1          8.93        0.107 
##  2 2       zone 1          3.13        0.100 
##  3 3       zone 1          7.44        0.103 
##  4 4       zone 1          4.27        0.100 
##  5 5       zone 1          5.97        0.105 
##  6 1       zone 2          5.15        0.0618
##  7 2       zone 2          1.84        0.0590
##  8 3       zone 2          4.08        0.0567
##  9 4       zone 2          2.52        0.0590
## 10 5       zone 2          3.67        0.0648</code></pre>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># plot solution</span>
<span class="co"># here we use the category layer function to generate raster showing the zone</span>
<span class="co"># that each planning unit was allocated. Specifically, pixels with the</span>
<span class="co"># value 1 are allocated to "zone 1" and pixels with the value 2 are allocated</span>
<span class="co"># to "zone 2". Thus units depicted in gray are not allocated</span>
<span class="co"># to any zone, units depicted in yellow are allocated to zone 1, and units</span>
<span class="co"># depicted in green are allocated to zone 2</span>
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="fu"><a href="../reference/category_layer.html">category_layer</a></span>(<span class="no">s2</span>), <span class="kw">main</span> <span class="kw">=</span> <span class="st">"solution"</span>, <span class="kw">axes</span> <span class="kw">=</span> <span class="fl">FALSE</span>, <span class="kw">box</span> <span class="kw">=</span> <span class="fl">FALSE</span>)</pre></body></html></div>
<p><img src="zones_files/figure-html/unnamed-chunk-3-1.png" width="700" style="display: block; margin: auto;"></p>
</div>
<div id="multiple-zones-with-varying-costs" class="section level3">
<h3 class="hasAnchor">
<a href="#multiple-zones-with-varying-costs" class="anchor"></a>Multiple zones with varying costs</h3>
<p>Real-world problems often have different costs for managing planning units under different zones. These problems also tend to have different expected amounts of each feature when planning units are managed differently. So let us consider a slightly more complex example. Similar to before we will have two management zones. But this time, the cost of managing each planning unit is different depending on which management zone it is assigned to in the solution. Furthermore, when we assign a planning unit to the second zone, we only expect to end up with half of the habitat we would get if we managed the unit in the first zone (e.g. because the second zone is a partial-take zone and the first zone is a no-take zone). We will use the same target data as in the previous example.</p>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># create new planning unit and cost data</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="no">sim_pu_zones_stack</span>)
<span class="no">pu3</span> <span class="kw">&lt;-</span> <span class="no">sim_pu_zones_stack</span><span class="kw">[[</span><span class="fl">1</span>:<span class="fl">2</span>]]

<span class="co"># plot cost data</span>
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">pu3</span>, <span class="kw">main</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"zone 1"</span>, <span class="st">"zone 2"</span>), <span class="kw">axes</span> <span class="kw">=</span> <span class="fl">FALSE</span>, <span class="kw">box</span> <span class="kw">=</span> <span class="fl">FALSE</span>)</pre></body></html></div>
<p><img src="zones_files/figure-html/unnamed-chunk-4-1.png" width="384" style="display: block; margin: auto;"></p>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># create problem</span>
<span class="no">p3</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/problem.html">problem</a></span>(<span class="no">pu3</span>, <span class="fu"><a href="../reference/zones.html">zones</a></span>(<span class="no">sim_features</span>, <span class="no">sim_features</span> * <span class="fl">0.5</span>)) <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/add_min_set_objective.html">add_min_set_objective</a></span>() <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/add_relative_targets.html">add_relative_targets</a></span>(<span class="no">t2</span>) <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/add_binary_decisions.html">add_binary_decisions</a></span>()

<span class="co"># print problem</span>
<span class="fu"><a href="../reference/print.html">print</a></span>(<span class="no">p3</span>)</pre></body></html></div>
<pre><code>## Conservation Problem
##   zones:          1, 2 (2 zones)
##   planning units: RasterStack (90 units)
##   cost:           min: 182.60173, max: 221.36296
##   features:       1, 2, 3, ... (5 features)
##   objective:      Minimum set objective 
##   targets:        Relative targets [targets (min: 0.05, max: 0.1)]
##   decisions:      Binary decision 
##   constraints:    &lt;none&gt;
##   penalties:      &lt;none&gt;
##   portfolio:      default
##   solver:         default</code></pre>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># solve problem</span>
<span class="no">s3</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/solve.html">solve</a></span>(<span class="no">p3</span>)</pre></body></html></div>
<pre><code>## Gurobi Optimizer version 9.0.1 build v9.0.1rc0 (linux64)
## Optimize a model with 100 rows, 180 columns and 1080 nonzeros
## Model fingerprint: 0x07455a48
## Variable types: 0 continuous, 180 integer (180 binary)
## Coefficient statistics:
##   Matrix range     [1e-01, 1e+00]
##   Objective range  [2e+02, 2e+02]
##   Bounds range     [1e+00, 1e+00]
##   RHS range        [8e-01, 8e+00]
## Found heuristic solution: objective 3667.7708672
## Presolve time: 0.00s
## Presolved: 100 rows, 180 columns, 1080 nonzeros
## Variable types: 0 continuous, 180 integer (180 binary)
## Presolved: 100 rows, 180 columns, 1080 nonzeros
## 
## 
## Root relaxation: objective 2.884872e+03, 38 iterations, 0.00 seconds
## 
##     Nodes    |    Current Node    |     Objective Bounds      |     Work
##  Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time
## 
##      0     0 2884.87200    0    8 3667.77087 2884.87200  21.3%     -    0s
## H    0     0                    2958.1201508 2884.87200  2.48%     -    0s
## 
## Explored 1 nodes (38 simplex iterations) in 0.00 seconds
## Thread count was 1 (of 4 available processors)
## 
## Solution count 2: 2958.12 3667.77 
## 
## Optimal solution found (tolerance 1.00e-01)
## Best objective 2.958120150795e+03, best bound 2.884871999973e+03, gap 2.4762%</code></pre>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># calculate feature representation</span>
<span class="no">r3</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/feature_representation.html">feature_representation</a></span>(<span class="no">p3</span>, <span class="no">s3</span>)
<span class="fu"><a href="../reference/print.html">print</a></span>(<span class="no">r3</span>)</pre></body></html></div>
<pre><code>## # A tibble: 10 x 4
##    feature zone  absolute_held relative_held
##    &lt;chr&gt;   &lt;chr&gt;         &lt;dbl&gt;         &lt;dbl&gt;
##  1 1       1             8.94         0.107 
##  2 2       1             3.13         0.100 
##  3 3       1             7.42         0.103 
##  4 4       1             4.29         0.101 
##  5 5       1             6.01         0.106 
##  6 1       2             2.19         0.0527
##  7 2       2             0.794        0.0509
##  8 3       2             1.87         0.0519
##  9 4       2             1.08         0.0505
## 10 5       2             1.44         0.0509</code></pre>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># plot solution</span>
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="fu"><a href="../reference/category_layer.html">category_layer</a></span>(<span class="no">s3</span>), <span class="kw">main</span> <span class="kw">=</span> <span class="st">"solution"</span>, <span class="kw">axes</span> <span class="kw">=</span> <span class="fl">FALSE</span>, <span class="kw">box</span> <span class="kw">=</span> <span class="fl">FALSE</span>)</pre></body></html></div>
<p><img src="zones_files/figure-html/unnamed-chunk-5-1.png" width="700" style="display: block; margin: auto;"></p>
</div>
<div id="multiple-zones-with-complex-targets" class="section level3">
<h3 class="hasAnchor">
<a href="#multiple-zones-with-complex-targets" class="anchor"></a>Multiple zones with complex targets</h3>
<p>So far, we have dealt with problems where each feature has a target that pertains to a single zone. But sometimes we have targets that pertain to multiple zones. For example, what if we were in charge of managing pest control in a set of areas and we had three different pest control methods we could implement in any given planning unit. We could (1) set up a few traps in a given planning unit and make 10 % of the habitat in the unit pest-free, (2) set up a lot of traps and make 50 % of the habitat in the unit pest-free, or (3) drop baits over a given planning unit and make 80 % of the planning unit pest-free. Each of these different actions has a different cost, with a few low intensity trapping costing $100 per planning unit, a high intensity trapping costing $300, and baiting costing $200 (please note these costs aren’t meant to be realistic). After defining our management actions and costs, we require a solution that will yield 8 units of pest free habitat per feature. It’s important to note that unlike the previous examples, here we don’t have targets for each feature in each zone, but rather our targets are for each feature and across multiple zones. In other words, we don’t really care which management actions we implement, we just want the set of actions that will meet our targets for minimum expenditure. We can formulate and solve this problem using the following code.</p>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># create planning unit data with costs</span>
<span class="no">pu4</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/stack.html">stack</a></span>(<span class="fu">Which</span>(!<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">sim_pu_raster</span>)) * <span class="fl">100</span>,
             <span class="fu">Which</span>(!<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">sim_pu_raster</span>)) * <span class="fl">300</span>,
             <span class="fu">Which</span>(!<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">sim_pu_raster</span>)) * <span class="fl">200</span>)
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">pu4</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"few.traps"</span>, <span class="st">"many.traps"</span>, <span class="st">"baiting"</span>)

<span class="co"># plot planning unit data</span>
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">pu4</span>, <span class="kw">nr</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">axes</span> <span class="kw">=</span> <span class="fl">FALSE</span>, <span class="kw">box</span> <span class="kw">=</span> <span class="fl">FALSE</span>)</pre></body></html></div>
<p><img src="zones_files/figure-html/unnamed-chunk-6-1.png" width="432" style="display: block; margin: auto;"></p>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># create targets</span>
<span class="no">t4</span> <span class="kw">&lt;-</span> <span class="kw pkg">tibble</span><span class="kw ns">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span>(<span class="kw">feature</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">sim_features</span>),
                     <span class="kw">zone</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">pu4</span>))[<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">1</span>, <span class="fl">5</span>)],
                     <span class="kw">target</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">8</span>, <span class="fl">5</span>),
                     <span class="kw">type</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="st">"absolute"</span>, <span class="fl">5</span>))

<span class="co"># print targets</span>
<span class="fu"><a href="../reference/print.html">print</a></span>(<span class="no">t4</span>)</pre></body></html></div>
<pre><code>## # A tibble: 5 x 4
##   feature zone      target type    
##   &lt;chr&gt;   &lt;list&gt;     &lt;dbl&gt; &lt;chr&gt;   
## 1 layer.1 &lt;chr [3]&gt;      8 absolute
## 2 layer.2 &lt;chr [3]&gt;      8 absolute
## 3 layer.3 &lt;chr [3]&gt;      8 absolute
## 4 layer.4 &lt;chr [3]&gt;      8 absolute
## 5 layer.5 &lt;chr [3]&gt;      8 absolute</code></pre>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># create problem</span>
<span class="no">p4</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/problem.html">problem</a></span>(<span class="no">pu4</span>, <span class="fu"><a href="../reference/zones.html">zones</a></span>(<span class="kw">few.traps</span> <span class="kw">=</span> <span class="no">sim_features</span> * <span class="fl">0.1</span>,
                         <span class="kw">many.traps</span> <span class="kw">=</span> <span class="no">sim_features</span> * <span class="fl">0.5</span>,
                         <span class="kw">baiting</span> <span class="kw">=</span> <span class="no">sim_features</span> * <span class="fl">0.8</span>,
                         <span class="kw">feature_names</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">sim_features</span>))) <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/add_min_set_objective.html">add_min_set_objective</a></span>() <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/add_manual_targets.html">add_manual_targets</a></span>(<span class="no">t4</span>) <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/add_binary_decisions.html">add_binary_decisions</a></span>()

<span class="co"># print problem</span>
<span class="fu"><a href="../reference/print.html">print</a></span>(<span class="no">p4</span>)</pre></body></html></div>
<pre><code>## Conservation Problem
##   zones:          few.traps, many.traps, baiting (3 zones)
##   planning units: RasterStack (100 units)
##   cost:           min: 0, max: 300
##   features:       layer.1, layer.2, layer.3, ... (5 features)
##   objective:      Minimum set objective 
##   targets:        Absolute targets [targets (min: 8, max: 8)]
##   decisions:      Binary decision 
##   constraints:    &lt;none&gt;
##   penalties:      &lt;none&gt;
##   portfolio:      default
##   solver:         default</code></pre>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># solve problem</span>
<span class="no">s4</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/solve.html">solve</a></span>(<span class="no">p4</span>)</pre></body></html></div>
<pre><code>## Gurobi Optimizer version 9.0.1 build v9.0.1rc0 (linux64)
## Optimize a model with 105 rows, 300 columns and 1800 nonzeros
## Model fingerprint: 0xd67e7fdc
## Variable types: 0 continuous, 300 integer (300 binary)
## Coefficient statistics:
##   Matrix range     [2e-02, 1e+00]
##   Objective range  [1e+02, 3e+02]
##   Bounds range     [1e+00, 1e+00]
##   RHS range        [1e+00, 8e+00]
## Found heuristic solution: objective 9400.0000000
## Presolve removed 14 rows and 120 columns
## Presolve time: 0.00s
## Presolved: 91 rows, 180 columns, 360 nonzeros
## Found heuristic solution: objective 4800.0000000
## Variable types: 0 continuous, 180 integer (180 binary)
## Presolved: 91 rows, 180 columns, 360 nonzeros
## 
## 
## Root relaxation: objective 3.663237e+03, 1 iterations, 0.00 seconds
## 
##     Nodes    |    Current Node    |     Objective Bounds      |     Work
##  Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time
## 
##      0     0 3663.23657    0    1 4800.00000 3663.23657  23.7%     -    0s
## H    0     0                    3800.0000000 3663.23657  3.60%     -    0s
## 
## Explored 1 nodes (1 simplex iterations) in 0.00 seconds
## Thread count was 1 (of 4 available processors)
## 
## Solution count 3: 3800 4800 9400 
## 
## Optimal solution found (tolerance 1.00e-01)
## Best objective 3.800000000000e+03, best bound 3.700000000000e+03, gap 2.6316%</code></pre>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># calculate feature representation</span>
<span class="no">r4</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/feature_representation.html">feature_representation</a></span>(<span class="no">p4</span>, <span class="no">s4</span>)
<span class="fu"><a href="../reference/print.html">print</a></span>(<span class="no">r4</span>)</pre></body></html></div>
<pre><code>## # A tibble: 15 x 4
##    feature zone       absolute_held relative_held
##    &lt;chr&gt;   &lt;chr&gt;              &lt;dbl&gt;         &lt;dbl&gt;
##  1 layer.1 few.traps           0            0    
##  2 layer.2 few.traps           0            0    
##  3 layer.3 few.traps           0            0    
##  4 layer.4 few.traps           0            0    
##  5 layer.5 few.traps           0            0    
##  6 layer.1 many.traps          0            0    
##  7 layer.2 many.traps          0            0    
##  8 layer.3 many.traps          0            0    
##  9 layer.4 many.traps          0            0    
## 10 layer.5 many.traps          0            0    
## 11 layer.1 baiting            18.3          0.275
## 12 layer.2 baiting             8.19         0.328
## 13 layer.3 baiting            15.2          0.264
## 14 layer.4 baiting            11.6          0.340
## 15 layer.5 baiting            12.7          0.281</code></pre>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># plot solution</span>
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="fu"><a href="../reference/category_layer.html">category_layer</a></span>(<span class="no">s4</span>), <span class="kw">main</span> <span class="kw">=</span> <span class="st">"solution"</span>, <span class="kw">axes</span> <span class="kw">=</span> <span class="fl">FALSE</span>, <span class="kw">box</span> <span class="kw">=</span> <span class="fl">FALSE</span>)</pre></body></html></div>
<p><img src="zones_files/figure-html/unnamed-chunk-7-1.png" width="700" style="display: block; margin: auto;"></p>
</div>
<div id="multiple-zones-with-extra-constraints" class="section level3">
<h3 class="hasAnchor">
<a href="#multiple-zones-with-extra-constraints" class="anchor"></a>Multiple zones with extra constraints</h3>
<p>So it looks like baiting is the way to go! Except that we might recall that we can’t use baits in most of the planning units because they contain native species that are susceptible to baits. So now we need to specify that which of our planning units cannot be assigned to the third zone (baiting) to obtain a more useful solution.</p>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># create data.frame to specify that we cannot bait in the first 40 units</span>
<span class="no">l5</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">pu</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">1</span>, <span class="fl">80</span>),
                 <span class="kw">zone</span> <span class="kw">=</span> <span class="st">"baiting"</span>,
                 <span class="kw">status</span> <span class="kw">=</span> <span class="fl">0</span>)

<span class="co"># preview locked data</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">l5</span>)</pre></body></html></div>
<pre><code>##   pu    zone status
## 1  1 baiting      0
## 2  2 baiting      0
## 3  3 baiting      0
## 4  4 baiting      0
## 5  5 baiting      0
## 6  6 baiting      0</code></pre>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># create problem</span>
<span class="no">p5</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/problem.html">problem</a></span>(<span class="no">pu4</span>, <span class="fu"><a href="../reference/zones.html">zones</a></span>(<span class="kw">few.traps</span> <span class="kw">=</span> <span class="no">sim_features</span> * <span class="fl">0.1</span>,
                         <span class="kw">many.traps</span> <span class="kw">=</span> <span class="no">sim_features</span> * <span class="fl">0.5</span>,
                         <span class="kw">baiting</span> <span class="kw">=</span> <span class="no">sim_features</span> * <span class="fl">0.8</span>,
                         <span class="kw">feature_names</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">sim_features</span>))) <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/add_min_set_objective.html">add_min_set_objective</a></span>() <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/add_manual_targets.html">add_manual_targets</a></span>(<span class="no">t4</span>) <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/add_manual_locked_constraints.html">add_manual_locked_constraints</a></span>(<span class="no">l5</span>) <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/add_binary_decisions.html">add_binary_decisions</a></span>()

<span class="co"># print problem</span>
<span class="fu"><a href="../reference/print.html">print</a></span>(<span class="no">p5</span>)</pre></body></html></div>
<pre><code>## Conservation Problem
##   zones:          few.traps, many.traps, baiting (3 zones)
##   planning units: RasterStack (100 units)
##   cost:           min: 0, max: 300
##   features:       layer.1, layer.2, layer.3, ... (5 features)
##   objective:      Minimum set objective 
##   targets:        Absolute targets [targets (min: 8, max: 8)]
##   decisions:      Binary decision 
##   constraints:    &lt;Manually locked planning units [80 locked units]&gt;
##   penalties:      &lt;none&gt;
##   portfolio:      default
##   solver:         default</code></pre>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># solve problem</span>
<span class="no">s5</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/solve.html">solve</a></span>(<span class="no">p5</span>)</pre></body></html></div>
<pre><code>## Gurobi Optimizer version 9.0.1 build v9.0.1rc0 (linux64)
## Optimize a model with 105 rows, 300 columns and 1800 nonzeros
## Model fingerprint: 0x4ad99e4b
## Variable types: 0 continuous, 300 integer (300 binary)
## Coefficient statistics:
##   Matrix range     [2e-02, 1e+00]
##   Objective range  [1e+02, 3e+02]
##   Bounds range     [1e+00, 1e+00]
##   RHS range        [1e+00, 8e+00]
## Found heuristic solution: objective 13600.000000
## Presolve removed 14 rows and 120 columns
## Presolve time: 0.00s
## Presolved: 91 rows, 180 columns, 360 nonzeros
## Found heuristic solution: objective 9600.0000000
## Variable types: 0 continuous, 180 integer (180 binary)
## Presolved: 91 rows, 180 columns, 360 nonzeros
## 
## 
## Root relaxation: objective 6.938068e+03, 1 iterations, 0.00 seconds
## 
##     Nodes    |    Current Node    |     Objective Bounds      |     Work
##  Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time
## 
##      0     0 6938.06818    0    1 9600.00000 6938.06818  27.7%     -    0s
## H    0     0                    7000.0000000 6938.06818  0.88%     -    0s
##      0     0 6938.06818    0    1 7000.00000 6938.06818  0.88%     -    0s
## 
## Explored 1 nodes (1 simplex iterations) in 0.00 seconds
## Thread count was 1 (of 4 available processors)
## 
## Solution count 3: 7000 9600 13600 
## 
## Optimal solution found (tolerance 1.00e-01)
## Best objective 7.000000000000e+03, best bound 7.000000000000e+03, gap 0.0000%</code></pre>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># calculate feature representation</span>
<span class="no">r5</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/feature_representation.html">feature_representation</a></span>(<span class="no">p5</span>, <span class="no">s5</span>)
<span class="fu"><a href="../reference/print.html">print</a></span>(<span class="no">r5</span>)</pre></body></html></div>
<pre><code>## # A tibble: 15 x 4
##    feature zone       absolute_held relative_held
##    &lt;chr&gt;   &lt;chr&gt;              &lt;dbl&gt;         &lt;dbl&gt;
##  1 layer.1 few.traps           0            0    
##  2 layer.2 few.traps           0            0    
##  3 layer.3 few.traps           0            0    
##  4 layer.4 few.traps           0            0    
##  5 layer.5 few.traps           0            0    
##  6 layer.1 many.traps          7.40         0.178
##  7 layer.2 many.traps          3.42         0.219
##  8 layer.3 many.traps          6.00         0.167
##  9 layer.4 many.traps          4.84         0.227
## 10 layer.5 many.traps          5.26         0.186
## 11 layer.1 baiting            14.4          0.217
## 12 layer.2 baiting             4.62         0.185
## 13 layer.3 baiting            11.7          0.203
## 14 layer.4 baiting             6.05         0.177
## 15 layer.5 baiting             9.98         0.220</code></pre>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># plot solution</span>
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="fu"><a href="../reference/category_layer.html">category_layer</a></span>(<span class="no">s5</span>), <span class="kw">main</span> <span class="kw">=</span> <span class="st">"solution"</span>, <span class="kw">axes</span> <span class="kw">=</span> <span class="fl">FALSE</span>, <span class="kw">box</span> <span class="kw">=</span> <span class="fl">FALSE</span>)</pre></body></html></div>
<p><img src="zones_files/figure-html/unnamed-chunk-8-1.png" width="700" style="display: block; margin: auto;"></p>
</div>
<div id="multiple-zones-with-fragmentation-penalties" class="section level3">
<h3 class="hasAnchor">
<a href="#multiple-zones-with-fragmentation-penalties" class="anchor"></a>Multiple zones with fragmentation penalties</h3>
<p>So now the best strategy seems to be a combination of high intensity trapping and baiting. But we can also see that this solution is fairly fragmented, so we can add penalties to cluster managed planning units together. Here we will add penalties that will cluster the planning units allocated to the two trapping zones together, and penalties that will cluster the planning units allocated to the baiting zone together. We will also set an overall penalty factor to 640 to strongly penalize fragmented solutions.</p>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># create matrix that describe boundary penalties between planning units</span>
<span class="co"># allocated to different zones</span>
<span class="no">z6</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span>(<span class="fl">3</span>)
<span class="no">z6</span>[<span class="fl">1</span>, <span class="fl">2</span>] <span class="kw">&lt;-</span> <span class="fl">1</span>
<span class="no">z6</span>[<span class="fl">2</span>, <span class="fl">1</span>] <span class="kw">&lt;-</span> <span class="fl">1</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">z6</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"few.traps"</span>, <span class="st">"many.traps"</span>, <span class="st">"baiting"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(<span class="no">z6</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">z6</span>)

<span class="co"># print matrix</span>
<span class="fu"><a href="../reference/print.html">print</a></span>(<span class="no">z6</span>)</pre></body></html></div>
<pre><code>##            few.traps many.traps baiting
## few.traps          1          1       0
## many.traps         1          1       0
## baiting            0          0       1</code></pre>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># create problem</span>
<span class="no">p6</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/problem.html">problem</a></span>(<span class="no">pu4</span>, <span class="fu"><a href="../reference/zones.html">zones</a></span>(<span class="st">"few.traps"</span> <span class="kw">=</span> <span class="no">sim_features</span> * <span class="fl">0.1</span>,
                         <span class="st">"many.traps"</span> <span class="kw">=</span> <span class="no">sim_features</span> * <span class="fl">0.5</span>,
                         <span class="st">"baiting"</span> <span class="kw">=</span> <span class="no">sim_features</span> * <span class="fl">0.8</span>,
                         <span class="kw">feature_names</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">sim_features</span>))) <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/add_min_set_objective.html">add_min_set_objective</a></span>() <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/add_manual_targets.html">add_manual_targets</a></span>(<span class="no">t4</span>) <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/add_manual_locked_constraints.html">add_manual_locked_constraints</a></span>(<span class="no">l5</span>) <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/add_boundary_penalties.html">add_boundary_penalties</a></span>(<span class="kw">penalty</span> <span class="kw">=</span> <span class="fl">640</span>, <span class="kw">zones</span> <span class="kw">=</span> <span class="no">z6</span>) <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/add_binary_decisions.html">add_binary_decisions</a></span>()

<span class="co"># print problem</span>
<span class="fu"><a href="../reference/print.html">print</a></span>(<span class="no">p6</span>)</pre></body></html></div>
<pre><code>## Conservation Problem
##   zones:          few.traps, many.traps, baiting (3 zones)
##   planning units: RasterStack (100 units)
##   cost:           min: 0, max: 300
##   features:       layer.1, layer.2, layer.3, ... (5 features)
##   objective:      Minimum set objective 
##   targets:        Absolute targets [targets (min: 8, max: 8)]
##   decisions:      Binary decision 
##   constraints:    &lt;Manually locked planning units [80 locked units]&gt;
##   penalties:      &lt;Boundary penalties [edge factor (min: 0.5, max: 0.5), penalty (640), zones]&gt;
##   portfolio:      default
##   solver:         default</code></pre>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># solve problem</span>
<span class="no">s6</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/solve.html">solve</a></span>(<span class="no">p6</span>)</pre></body></html></div>
<pre><code>## Gurobi Optimizer version 9.0.1 build v9.0.1rc0 (linux64)
## Optimize a model with 1905 rows, 1200 columns and 5400 nonzeros
## Model fingerprint: 0xb44cc86f
## Variable types: 0 continuous, 1200 integer (1200 binary)
## Coefficient statistics:
##   Matrix range     [2e-02, 1e+00]
##   Objective range  [1e+02, 6e+02]
##   Bounds range     [1e+00, 1e+00]
##   RHS range        [1e+00, 8e+00]
## Found heuristic solution: objective 20096.000000
## Presolve removed 308 rows and 232 columns
## Presolve time: 0.02s
## Presolved: 1597 rows, 968 columns, 4872 nonzeros
## Variable types: 0 continuous, 968 integer (968 binary)
## Presolve removed 720 rows and 0 columns
## Presolved: 877 rows, 968 columns, 2712 nonzeros
## 
## 
## Root relaxation: objective 1.005410e+04, 546 iterations, 0.01 seconds
## 
##     Nodes    |    Current Node    |     Objective Bounds      |     Work
##  Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time
## 
##      0     0 10054.0986    0   57 20096.0000 10054.0986  50.0%     -    0s
## H    0     0                    11300.000000 10054.0986  11.0%     -    0s
## H    0     0                    10264.000000 10054.0986  2.05%     -    0s
## 
## Explored 1 nodes (825 simplex iterations) in 0.08 seconds
## Thread count was 1 (of 4 available processors)
## 
## Solution count 3: 10264 11300 20096 
## 
## Optimal solution found (tolerance 1.00e-01)
## Best objective 1.026400000000e+04, best bound 1.005600000000e+04, gap 2.0265%</code></pre>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># calculate feature representation</span>
<span class="no">r6</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/feature_representation.html">feature_representation</a></span>(<span class="no">p6</span>, <span class="no">s6</span>)
<span class="fu"><a href="../reference/print.html">print</a></span>(<span class="no">r6</span>)</pre></body></html></div>
<pre><code>## # A tibble: 15 x 4
##    feature zone       absolute_held relative_held
##    &lt;chr&gt;   &lt;chr&gt;              &lt;dbl&gt;         &lt;dbl&gt;
##  1 layer.1 few.traps           0            0    
##  2 layer.2 few.traps           0            0    
##  3 layer.3 few.traps           0            0    
##  4 layer.4 few.traps           0            0    
##  5 layer.5 few.traps           0            0    
##  6 layer.1 many.traps          7.51         0.180
##  7 layer.2 many.traps          3.38         0.217
##  8 layer.3 many.traps          5.75         0.160
##  9 layer.4 many.traps          4.99         0.234
## 10 layer.5 many.traps          5.46         0.192
## 11 layer.1 baiting            14.4          0.217
## 12 layer.2 baiting             4.62         0.185
## 13 layer.3 baiting            11.7          0.203
## 14 layer.4 baiting             6.05         0.177
## 15 layer.5 baiting             9.98         0.220</code></pre>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># plot solution</span>
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="fu"><a href="../reference/category_layer.html">category_layer</a></span>(<span class="no">s6</span>), <span class="kw">main</span> <span class="kw">=</span> <span class="st">"solution"</span>, <span class="kw">axes</span> <span class="kw">=</span> <span class="fl">FALSE</span>, <span class="kw">box</span> <span class="kw">=</span> <span class="fl">FALSE</span>)</pre></body></html></div>
<p><img src="zones_files/figure-html/unnamed-chunk-9-1.png" width="700" style="display: block; margin: auto;"></p>
<p>Finally, it appears we might have a viable solution for this made-up conservation problem.</p>
</div>
<div id="multiple-zones-with-fragmentation-penalties-and-mandatory-allocations" class="section level3">
<h3 class="hasAnchor">
<a href="#multiple-zones-with-fragmentation-penalties-and-mandatory-allocations" class="anchor"></a>Multiple zones with fragmentation penalties and mandatory allocations</h3>
<p>Finally, we might be interested in conservation planning scenarios where every single planning unit must be allocated to a management zone. This is often the case when developing land-use plans where every single planning unit needs to be allocated to a specific management zone. Though it makes less sense here, let’s see what happens to the solution if we needed to do at least one form of control in every single planning unit.</p>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># create matrix that describe boundary penalties between planning units</span>
<span class="co"># allocated to different zones</span>
<span class="no">p7</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/problem.html">problem</a></span>(<span class="no">pu4</span>, <span class="fu"><a href="../reference/zones.html">zones</a></span>(<span class="st">"few.traps"</span> <span class="kw">=</span> <span class="no">sim_features</span> * <span class="fl">0.1</span>,
                         <span class="st">"many.traps"</span> <span class="kw">=</span> <span class="no">sim_features</span> * <span class="fl">0.5</span>,
                         <span class="st">"baiting"</span> <span class="kw">=</span> <span class="no">sim_features</span> * <span class="fl">0.8</span>,
                         <span class="kw">feature_names</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">sim_features</span>))) <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/add_min_set_objective.html">add_min_set_objective</a></span>() <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/add_manual_targets.html">add_manual_targets</a></span>(<span class="no">t4</span>) <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/add_mandatory_allocation_constraints.html">add_mandatory_allocation_constraints</a></span>() <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/add_manual_locked_constraints.html">add_manual_locked_constraints</a></span>(<span class="no">l5</span>) <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/add_boundary_penalties.html">add_boundary_penalties</a></span>(<span class="kw">penalty</span> <span class="kw">=</span> <span class="fl">640</span>, <span class="kw">zones</span> <span class="kw">=</span> <span class="no">z6</span>) <span class="kw">%&gt;%</span>
      <span class="fu"><a href="../reference/add_binary_decisions.html">add_binary_decisions</a></span>()

<span class="co"># print problem</span>
<span class="fu"><a href="../reference/print.html">print</a></span>(<span class="no">p7</span>)</pre></body></html></div>
<pre><code>## Conservation Problem
##   zones:          few.traps, many.traps, baiting (3 zones)
##   planning units: RasterStack (100 units)
##   cost:           min: 0, max: 300
##   features:       layer.1, layer.2, layer.3, ... (5 features)
##   objective:      Minimum set objective 
##   targets:        Absolute targets [targets (min: 8, max: 8)]
##   decisions:      Binary decision 
##   constraints:    &lt;Manually locked planning units [80 locked units]
##                    Mandatory allocation constraints [apply constraints? (1)]&gt;
##   penalties:      &lt;Boundary penalties [edge factor (min: 0.5, max: 0.5), penalty (640), zones]&gt;
##   portfolio:      default
##   solver:         default</code></pre>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># solve problem</span>
<span class="no">s7</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/solve.html">solve</a></span>(<span class="no">p7</span>)</pre></body></html></div>
<pre><code>## Gurobi Optimizer version 9.0.1 build v9.0.1rc0 (linux64)
## Optimize a model with 1905 rows, 1200 columns and 5400 nonzeros
## Model fingerprint: 0x89a9dafb
## Variable types: 0 continuous, 1200 integer (1200 binary)
## Coefficient statistics:
##   Matrix range     [2e-02, 1e+00]
##   Objective range  [1e+02, 6e+02]
##   Bounds range     [1e+00, 1e+00]
##   RHS range        [1e+00, 8e+00]
## Found heuristic solution: objective 19600.000000
## Presolve removed 392 rows and 316 columns
## Presolve time: 0.05s
## Presolved: 1513 rows, 884 columns, 4608 nonzeros
## Variable types: 0 continuous, 884 integer (884 binary)
## Presolve removed 728 rows and 8 columns
## Presolved: 785 rows, 876 columns, 2448 nonzeros
## 
## 
## Root relaxation: objective 1.323093e+04, 262 iterations, 0.02 seconds
## 
##     Nodes    |    Current Node    |     Objective Bounds      |     Work
##  Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time
## 
##      0     0 13230.9255    0  102 19600.0000 13230.9255  32.5%     -    0s
## H    0     0                    13260.000000 13230.9255  0.22%     -    0s
## 
## Explored 1 nodes (403 simplex iterations) in 0.14 seconds
## Thread count was 1 (of 4 available processors)
## 
## Solution count 2: 13260 19600 
## 
## Optimal solution found (tolerance 1.00e-01)
## Best objective 1.326000000000e+04, best bound 1.323200000000e+04, gap 0.2112%</code></pre>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># calculate feature representation</span>
<span class="no">r7</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/feature_representation.html">feature_representation</a></span>(<span class="no">p7</span>, <span class="no">s7</span>)
<span class="fu"><a href="../reference/print.html">print</a></span>(<span class="no">r7</span>)</pre></body></html></div>
<pre><code>## # A tibble: 15 x 4
##    feature zone       absolute_held relative_held
##    &lt;chr&gt;   &lt;chr&gt;              &lt;dbl&gt;         &lt;dbl&gt;
##  1 layer.1 few.traps           5.92        0.711 
##  2 layer.2 few.traps           2.33        0.745 
##  3 layer.3 few.traps           5.25        0.730 
##  4 layer.4 few.traps           3.18        0.745 
##  5 layer.5 few.traps           4.00        0.706 
##  6 layer.1 many.traps          3.02        0.0725
##  7 layer.2 many.traps          1.09        0.0700
##  8 layer.3 many.traps          2.41        0.0670
##  9 layer.4 many.traps          1.66        0.0779
## 10 layer.5 many.traps          2.11        0.0743
## 11 layer.1 baiting            14.4         0.217 
## 12 layer.2 baiting             4.62        0.185 
## 13 layer.3 baiting            11.7         0.203 
## 14 layer.4 baiting             6.05        0.177 
## 15 layer.5 baiting             9.98        0.220</code></pre>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># plot solution</span>
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="fu"><a href="../reference/category_layer.html">category_layer</a></span>(<span class="no">s7</span>), <span class="kw">main</span> <span class="kw">=</span> <span class="st">"solution"</span>, <span class="kw">axes</span> <span class="kw">=</span> <span class="fl">FALSE</span>, <span class="kw">box</span> <span class="kw">=</span> <span class="fl">FALSE</span>)</pre></body></html></div>
<p><img src="zones_files/figure-html/unnamed-chunk-10-1.png" width="700" style="display: block; margin: auto;"></p>
</div>
</div>
<div id="conclusion" class="section level2">
<h2 class="hasAnchor">
<a href="#conclusion" class="anchor"></a>Conclusion</h2>
<p>Hopefully, this vignette has provided an informative introduction to building and solving problems with multiple zones using the <em>prioritizr R</em> package. Although we have examined only a few different functions here, almost every single function for modifying conservation planning problems is compatible with problems that contain zones. It’s worth noting that working with multiple zones is a lot trickier than working with a single zone, so we would recommend playing around with the code in the Examples sections of the help pages to get a feel for what different functions do when they are applied to problems with multiple zones.</p>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<div id="refs" class="references">
<div id="ref-r25">
<p>Cattarino, L., Hermoso, V., Carwardine, J., Adams, V.M., Kennard, M.J. &amp; Linke, S. (2018). Information uncertainty influences conservation outcomes when prioritizing multi-action management efforts. <em>Journal of Applied Ecology</em>, Available at: https://doi.org/10.1111/1365–2664.13147.</p>
</div>
<div id="ref-r27">
<p>Klein, C.J., Tulloch, V.J., Halpern, B.S., Selkoe, K.A., Watts, M.E., Steinback, C., Scholz, A. &amp; Possingham, H.P. (2013). Tradeoffs in marine reserve design: Habitat condition, representation, and socioeconomic costs. <em>Conservation Letters</em>, <em>6</em>, 324–332.</p>
</div>
<div id="ref-r5">
<p>Klein, C., Wilson, K., Watts, M., Stein, J., Berry, S., Carwardine, J., Smith, M.S., Mackey, B. &amp; Possingham, H. (2009). Incorporating ecological and evolutionary processes into continental-scale conservation planning. <em>Ecological Applications</em>, <em>19</em>, 206–217.</p>
</div>
<div id="ref-r4">
<p>Margules, C.R. &amp; Pressey, R.L. (2000). Systematic conservation planning. <em>Nature</em>, <em>405</em>, 243–253.</p>
</div>
<div id="ref-r18">
<p>Stigner, M.G., Beyer, H.L., Klein, C.J. &amp; Fuller, R.A. (2016). Reconciling recreational use and conservation values in a coastal protected area. <em>Journal of Applied Ecology</em>, <em>53</em>, 1206–1214.</p>
</div>
<div id="ref-r2">
<p>Watts, M.E., Ball, I.R., Stewart, R.S., Klein, C.J., Wilson, K., Steinback, C., Lourival, R., Kircher, L. &amp; Possingham, H.P. (2009). Marxan with Zones: Software for optimal conservation based land- and sea-use zoning. <em>Environmental Modelling &amp; Software</em>, <em>24</em>, 1513–1521.</p>
</div>
<div id="ref-r26">
<p>Wilson, K.A., Meijaard, E., Drummond, S., Grantham, H.S., Boitani, L., Catullo, G., Christie, L., Dennis, R., Dutton, I., Falcucci, A. &amp; others. (2010). Conserving biodiversity in production landscapes. <em>Ecological Applications</em>, <em>20</em>, 1721–1732.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://jeffrey-hanson.com">Jeffrey O Hanson</a>, <a href="http://www.richard-schuster.com">Richard Schuster</a>, Nina Morrell, <a href="http://strimas.com">Matthew Strimas-Mackey</a>, Matthew E Watts, <a href="https://arcese.forestry.ubc.ca">Peter Arcese</a>, <a href="https://josephrbennett.wordpress.com">Joseph Bennett</a>, <a href="http://www.possinghamlab.org">Hugh P Possingham</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '486efa122ea6783724263412c5f28ab3',
    indexName: 'prioritizr',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
