<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Salt Spring Island Tutorial • prioritizr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Salt Spring Island Tutorial">
<meta property="og:description" content="prioritizr">
<meta property="og:image" content="https://prioritizr.net/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-70466840-4"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-70466840-4');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">prioritizr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">7.0.1.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/prioritizr.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/gurobi_installation.html">Gurobi Installation Guide</a>
    </li>
    <li>
      <a href="../articles/publication_record.html">Publication Record</a>
    </li>
    <li>
      <a href="../articles/saltspring.html">Salt Spring Island Tutorial</a>
    </li>
    <li>
      <a href="../articles/tasmania.html">Tasmania Tutorial</a>
    </li>
    <li>
      <a href="../articles/zones.html">Management Zones</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/prioritizr/prioritizr/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Salt Spring Island Tutorial</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/prioritizr/prioritizr/blob/master/vignettes/saltspring.Rmd"><code>vignettes/saltspring.Rmd</code></a></small>
      <div class="hidden name"><code>saltspring.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>This aim of this tutorial is to show how raster data can used to build conservation problems with the <em>prioritizr R</em> package. The data used here is a subset of a much larger dataset for the Georgia Basin obtained as part of an online <em>Marxan</em>-based planning tool created for the Coastal Douglas-fir Conservation Partnership <span class="citation">(CDFCP; Morrell <em>et al.</em> 2017)</span>. For simplicity, we focus only on Salt Spring Island, British Columbia. Salt Spring Island is central to the region and supports a diverse and globally unique mix of dry forest and savanna habitats. Today, these habitats are critically threatened due to land conversion, invasive species, and altered disturbance regimes. Known broadly as the Georgia Depression-Puget Lowlands, this region includes threatened Coastal Douglas-fir forest and Oak-Savannah habitats, also referred to as Garry oak ecosystems. Please note that this tutorial uses data from the <em>prioritizrdata R</em> package, so ensure that it is installed before trying out the code yourself. For more information on the dataset refer to the <a href="https://arcese.forestry.ubc.ca/marxan-tool/">Marxan tool portal</a> and the <a href="http://peter-arcese-lab.sites.olt.ubc.ca/files/2016/09/CDFCP_tutorial_2017_05.pdf">tool tutorial</a>.</p>
<center>
<div class="figure">
<img src="figures/map.jpg" alt="Extent of Coastal Douglas-fir Conservation Partnership Tool area and location of Salt Spring Island"><p class="caption"><em>Extent of Coastal Douglas-fir Conservation Partnership Tool area and location of Salt Spring Island</em></p>
</div>
</center>
</div>
<div id="exploring-the-data" class="section level2">
<h2 class="hasAnchor">
<a href="#exploring-the-data" class="anchor"></a>Exploring the data</h2>
<p>This dataset contains two items. First, a single-band raster planning unit layer where each one hectare pixel represents a planning unit and contains its corresponding cost <span class="citation">(BC Assessment 2015)</span>. Second, a raster stack containing ecological community feature data. Field and remote sensed data were used to calculate the probability of occurrence of five key ecological communities found on Salt Spring island. Each layer in the stack represents a different community type. In order these are; Old Forest, Savannah, Wetland, Shrub, and a layer representing the inverse probability of occurrence of human commensal species. For a given layer, the cell value indicates the composite probability of encountering the suite of bird species most commonly associated with that community type.</p>
<p>First, load the required packages and the data.</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># load packages</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://prioritizr.github.io/prioritizrdata">prioritizrdata</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://prioritizr.net">prioritizr</a></span><span class="op">)</span>

<span class="co"># load planning unit data</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">salt_pu</span><span class="op">)</span>

<span class="co"># load conservation feature data</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">salt_features</span><span class="op">)</span></code></pre></div>
<p>Let’s have a look at the planning unit data. Note that we log-transformed the raster to better visualize the variation in planning unit cost.</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># print planning unit data</span>
<span class="fu"><a href="../reference/print.html">print</a></span><span class="op">(</span><span class="va">salt_pu</span><span class="op">)</span></code></pre></div>
<pre><code>## class      : RasterLayer 
## dimensions : 280, 200, 56000  (nrow, ncol, ncell)
## resolution : 100, 100  (x, y)
## extent     : 454589.9, 474589.9, 5394614, 5422614  (xmin, xmax, ymin, ymax)
## crs        : +proj=utm +zone=10 +datum=WGS84 +units=m +no_defs +ellps=WGS84 +towgs84=0,0,0 
## source     : memory
## names      : salt_pu 
## values     : 0.02552, 10000  (min, max)</code></pre>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># plot histogram of the planning unit costs</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="fu">values</span><span class="op">(</span><span class="va">salt_pu</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"Distribution of costs"</span>,
     xlab <span class="op">=</span> <span class="st">"Planning unit costs"</span><span class="op">)</span></code></pre></div>
<p><img src="saltspring_files/figure-html/unnamed-chunk-3-1.png" width="336" style="display: block; margin: auto;"></p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># plot map showing the planning units costs on a log-scale</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">salt_pu</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"Planning unit costs (log)"</span><span class="op">)</span></code></pre></div>
<p><img src="saltspring_files/figure-html/unnamed-chunk-4-1.png" width="336" style="display: block; margin: auto;"></p>
<p>Next, let’s look at the feature data.</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># print features</span>
<span class="fu"><a href="../reference/print.html">print</a></span><span class="op">(</span><span class="va">salt_features</span><span class="op">)</span></code></pre></div>
<pre><code>## class      : RasterStack 
## dimensions : 280, 200, 56000, 5  (nrow, ncol, ncell, nlayers)
## resolution : 100, 100  (x, y)
## extent     : 454589.9, 474589.9, 5394614, 5422614  (xmin, xmax, ymin, ymax)
## crs        : +proj=utm +zone=10 +datum=WGS84 +units=m +no_defs +ellps=WGS84 +towgs84=0,0,0 
## names      : salt_features.1, salt_features.2, salt_features.3, salt_features.4, salt_features.5 
## min values :       0.3595050,       0.2979212,       0.1132785,       0.4013101,       0.3703639 
## max values :       0.9312289,       0.6608167,       0.6434712,       0.8249719,       0.9032656</code></pre>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># plot map showing the distribution of the features</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">salt_features</span>, main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">salt_features</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="saltspring_files/figure-html/unnamed-chunk-5-1.png" width="432" style="display: block; margin: auto;"></p>
</div>
<div id="formulating-the-problem" class="section level2">
<h2 class="hasAnchor">
<a href="#formulating-the-problem" class="anchor"></a>Formulating the Problem</h2>
<p>In this tutorial, we will only cover a few of the different ways that conservation planning problems can be formulated. The examples used here are provided to highlight how different parameters can substantially—or only slightly—alter solutions. Here, we use the minimum set objective to fulfill all targets and constraints for the smallest cost. This objective is similar to that used in the <em>Marxan</em> decision support tool. To keep this simple, we will set biodiversity targets at 17 % to reflect the <a href="https://www.cbd.int/sp/targets/">Aichi Biodiversity Target 11</a>. Because properties on Salt Spring Island can either be acquired in their entirety or not at all, we leave the decision framework as the default; binary decision making. This means that planning units are either selected in the solution or not selected in the solution—planning units cannot be partially acquired.</p>
<p>Now we will formulate the conservation planning problem.</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># create problem</span>
<span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/problem.html">problem</a></span><span class="op">(</span><span class="va">salt_pu</span>, <span class="va">salt_features</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu"><a href="../reference/add_min_set_objective.html">add_min_set_objective</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu"><a href="../reference/add_relative_targets.html">add_relative_targets</a></span><span class="op">(</span><span class="fl">0.17</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu"><a href="../reference/add_binary_decisions.html">add_binary_decisions</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu"><a href="../reference/add_default_solver.html">add_default_solver</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># print problem</span>
<span class="fu"><a href="../reference/print.html">print</a></span><span class="op">(</span><span class="va">p1</span><span class="op">)</span></code></pre></div>
<pre><code>## Conservation Problem
##   planning units: RasterLayer (19794 units)
##   cost:           min: 0.02552, max: 10000
##   features:       salt_features.1, salt_features.2, salt_features.3, ... (5 features)
##   objective:      Minimum set objective 
##   targets:        Relative targets [targets (min: 0.17, max: 0.17)]
##   decisions:      Binary decision 
##   constraints:    &lt;none&gt;
##   penalties:      &lt;none&gt;
##   portfolio:      default
##   solver:         Gurobi [first_feasible (0), gap (0.1), node_file_start (-1), numeric_focus (0), presolve (2), threads (1), time_limit (2147483647), verbose (1)]</code></pre>
<p>Note that the <code><a href="../reference/%&gt;%.html">%&gt;%</a></code> notation is used to attach the objectives, targets, and decisions to the problem. Since binary-type decisions are the default decision-type, we don’t have to explicitly specify the decision-type, but we specify it here for clarity.</p>
</div>
<div id="solving-the-problem" class="section level2">
<h2 class="hasAnchor">
<a href="#solving-the-problem" class="anchor"></a>Solving the problem</h2>
<p>The <em>prioritizr R</em> package supports three different integer linear programming solvers: <em>gurobi</em> (via the <em>gurobi</em> package), <em>IBM CPLEX</em> (via the <em>cplexAPI</em> package), <em>SYMPHONY</em> (via the <em>Rsymphony</em> and <em>lpsymphony</em> packages) and <em>CBC</em> (via the <em>rcbc</em> package). There are costs and benefits associated with each of these solvers, but the solver itself should have little impact on the actual solution returned (though certain solvers may take longer to return solutions than others).</p>
<p>First, remember that the solvers must be installed. You can check if these packages are installed by running the code below. Some of these solvers are a bit complicated to install. For instance, the <em>gurobi</em> package is distributed with the <a href="https://www.gurobi.com/"><em>Gurobi</em> commercial software suite</a> and is not available on the Comprehensive R Archive Network (CRAN). For more information on installing the <em>gurobi</em> package, please refer to the <a href="gurobi_installation.html"><em>Gurobi Installation Guide</em></a> for more information on installing the <em>gurobi R</em> package. Additionally, the <em>rcbc</em> package is not available on CRAN, and must be installed from GitHub (<a href="https://dirkschumacher.github.io/rcbc/">please refer to its documentation for installation instructions</a>. Furthermore, although the <em>Rcplex</em> package is available on CRAN, it cannot be successfully installed unless the <a href="https://www.ibm.com/analytics/cplex-optimizer">IBM CPLEX software</a> has <a href="https://CRAN.R-project.org/package=cplexAPI/INSTALL">already installed on your system</a>.</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/print.html">print</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="https://www.gurobi.com">gurobi</a></span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="../reference/print.html">print</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va">cplexAPI</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="../reference/print.html">print</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="http://R-Forge.R-project.org/projects/rsymphony">Rsymphony</a></span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="../reference/print.html">print</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="http://R-Forge.R-project.org/projects/rsymphony">lpsymphony</a></span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="../reference/print.html">print</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="https://dirkschumacher.github.io/rcbc">rcbc</a></span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Now we will try solving the problem using the different solvers (see <a href="https://prioritizr.net/reference/solve.html"><code>?solve</code></a> for more information). We will also experiment with limiting the maximum amount of time that can be spent looking for each solution when solving the problem (using the <code>time_limit</code> parameter), and see how this alters the solutions.</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">titles</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># create vector to store plot titles</span>
<span class="va">s1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/stack.html">stack</a></span><span class="op">(</span><span class="op">)</span>  <span class="co"># create empty stack to store solutions</span>

<span class="co"># create new problem object with added solver</span>
<span class="kw">if</span> <span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="st"><a href="http://R-Forge.R-project.org/projects/rsymphony">"Rsymphony"</a></span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">titles</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">titles</span>, <span class="st">"Rsymphony (5s)"</span><span class="op">)</span>
  <span class="va">p2</span> <span class="op">&lt;-</span> <span class="va">p1</span> <span class="op">%&gt;%</span> <span class="fu"><a href="../reference/add_rsymphony_solver.html">add_rsymphony_solver</a></span><span class="op">(</span>time_limit <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>
  <span class="va">s1</span> <span class="op">&lt;-</span> <span class="fu">addLayer</span><span class="op">(</span><span class="va">s1</span>, <span class="fu"><a href="../reference/solve.html">solve</a></span><span class="op">(</span><span class="va">p2</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<pre><code>## Warning in res(x, ...): overwriting previously defined solver</code></pre>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span> <span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="st"><a href="http://R-Forge.R-project.org/projects/rsymphony">"Rsymphony"</a></span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">titles</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">titles</span>, <span class="st">"Rsymphony (10s)"</span><span class="op">)</span>
  <span class="va">p3</span> <span class="op">&lt;-</span> <span class="va">p1</span> <span class="op">%&gt;%</span> <span class="fu"><a href="../reference/add_rsymphony_solver.html">add_rsymphony_solver</a></span><span class="op">(</span>time_limit <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>
  <span class="va">s1</span> <span class="op">&lt;-</span> <span class="fu">addLayer</span><span class="op">(</span><span class="va">s1</span>, <span class="fu"><a href="../reference/solve.html">solve</a></span><span class="op">(</span><span class="va">p3</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<pre><code>## Warning in res(x, ...): overwriting previously defined solver</code></pre>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span> <span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="st"><a href="https://www.gurobi.com">"gurobi"</a></span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">titles</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">titles</span>, <span class="st">"Gurobi (5s)"</span><span class="op">)</span>
  <span class="va">p4</span> <span class="op">&lt;-</span> <span class="va">p1</span> <span class="op">%&gt;%</span> <span class="fu"><a href="../reference/add_gurobi_solver.html">add_gurobi_solver</a></span><span class="op">(</span>time_limit <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>
  <span class="va">s1</span> <span class="op">&lt;-</span> <span class="fu">addLayer</span><span class="op">(</span><span class="va">s1</span>, <span class="fu"><a href="../reference/solve.html">solve</a></span><span class="op">(</span><span class="va">p4</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<pre><code>## Warning in res(x, ...): overwriting previously defined solver</code></pre>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span> <span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="st">"cplexAPI"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">titles</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">titles</span>, <span class="st">"IBM CPLEX (5s)"</span><span class="op">)</span>
  <span class="va">p5</span> <span class="op">&lt;-</span> <span class="va">p1</span> <span class="op">%&gt;%</span> <span class="fu"><a href="../reference/add_cplex_solver.html">add_cplex_solver</a></span><span class="op">(</span>time_limit <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>
  <span class="va">s1</span> <span class="op">&lt;-</span> <span class="fu">addLayer</span><span class="op">(</span><span class="va">s1</span>, <span class="fu"><a href="../reference/solve.html">solve</a></span><span class="op">(</span><span class="va">p5</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<pre><code>## Warning in res(x, ...): overwriting previously defined solver</code></pre>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span> <span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="st"><a href="http://R-Forge.R-project.org/projects/rsymphony">"lpsymphony"</a></span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">titles</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">titles</span>, <span class="st">"lpsymphony (10s)"</span><span class="op">)</span>
  <span class="va">p6</span> <span class="op">&lt;-</span> <span class="va">p1</span> <span class="op">%&gt;%</span> <span class="fu"><a href="../reference/add_lsymphony_solver.html">add_lpsymphony_solver</a></span><span class="op">(</span>time_limit <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>
  <span class="va">s1</span> <span class="op">&lt;-</span> <span class="fu">addLayer</span><span class="op">(</span><span class="va">s1</span>, <span class="fu"><a href="../reference/solve.html">solve</a></span><span class="op">(</span><span class="va">p6</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<pre><code>## Warning in res(x, ...): overwriting previously defined solver</code></pre>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span> <span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="st"><a href="https://dirkschumacher.github.io/rcbc">"rcbc"</a></span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">titles</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">titles</span>, <span class="st">"CBC (10s)"</span><span class="op">)</span>
  <span class="va">p7</span> <span class="op">&lt;-</span> <span class="va">p1</span> <span class="op">%&gt;%</span> <span class="fu"><a href="../reference/add_cbc_solver.html">add_cbc_solver</a></span><span class="op">(</span>time_limit <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>
  <span class="va">s1</span> <span class="op">&lt;-</span> <span class="fu">addLayer</span><span class="op">(</span><span class="va">s1</span>, <span class="fu"><a href="../reference/solve.html">solve</a></span><span class="op">(</span><span class="va">p7</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<pre><code>## Warning in res(x, ...): overwriting previously defined solver</code></pre>
<p>Now let’s visualize the solutions.</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">s1</span>, main <span class="op">=</span> <span class="va">titles</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span>, <span class="fl">1</span><span class="op">)</span>,  col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"grey70"</span>, <span class="st">"darkgreen"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="saltspring_files/figure-html/unnamed-chunk-9-1.png" width="480" style="display: block; margin: auto;"></p>
<p>We can see that all of the solutions are very similar. Therefore it would appear that for this particular problem, the solution is not highly sensitive to solver choice. For larger and more complex problems, however, we would expect the solution from <em>Gurobi</em> to be far superior when setting time limits. At a glance, it also appears that the time limit settings did not largely impact the solutions (5 seconds vs. 10 seconds), but a more rigorous analysis is needed to investigate this.</p>
</div>
<div id="adding-connectivity" class="section level2">
<h2 class="hasAnchor">
<a href="#adding-connectivity" class="anchor"></a>Adding connectivity</h2>
<p>Isolated and fragmented populations are often more vulnerable to extinction. As a consequence, landscape connectivity is a key focus of many conservation planning exercises. There are a number of methods that can be used to increase connectivity in prioritizations. These methods typically involve adding constraints to a problem to ensure that solutions exhibit a specific property (e.g. selected planning units that form a contiguous reserve), or adding penalties to a problem to penalize solutions that exhibit specific properties (e.g. high levels of fragmentation). Here we will explore a couple different strategies for increasing connectivity in solutions. For brevity, we will use default solver which is automatically added to a problem if a solver is not manually specified.</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># basic problem formulation</span>
<span class="va">p6</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/problem.html">problem</a></span><span class="op">(</span><span class="va">salt_pu</span>, <span class="va">salt_features</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu"><a href="../reference/add_min_set_objective.html">add_min_set_objective</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu"><a href="../reference/add_relative_targets.html">add_relative_targets</a></span><span class="op">(</span><span class="fl">0.17</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu"><a href="../reference/add_binary_decisions.html">add_binary_decisions</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu"><a href="../reference/add_default_solver.html">add_default_solver</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># print problem</span>
<span class="fu"><a href="../reference/print.html">print</a></span><span class="op">(</span><span class="va">p6</span><span class="op">)</span></code></pre></div>
<pre><code>## Conservation Problem
##   planning units: RasterLayer (19794 units)
##   cost:           min: 0.02552, max: 10000
##   features:       salt_features.1, salt_features.2, salt_features.3, ... (5 features)
##   objective:      Minimum set objective 
##   targets:        Relative targets [targets (min: 0.17, max: 0.17)]
##   decisions:      Binary decision 
##   constraints:    &lt;none&gt;
##   penalties:      &lt;none&gt;
##   portfolio:      default
##   solver:         Gurobi [first_feasible (0), gap (0.1), node_file_start (-1), numeric_focus (0), presolve (2), threads (1), time_limit (2147483647), verbose (1)]</code></pre>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">titles2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># create vector to store plot titles</span>
<span class="va">s2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/stack.html">stack</a></span><span class="op">(</span><span class="op">)</span>  <span class="co"># create empty stack to store solutions</span>

<span class="co"># no connectivity requirement</span>
<span class="va">titles2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">titles2</span>, <span class="st">"No connectivity"</span><span class="op">)</span>
<span class="va">s2</span> <span class="op">&lt;-</span> <span class="fu">addLayer</span><span class="op">(</span><span class="va">s2</span>, <span class="fu"><a href="../reference/solve.html">solve</a></span><span class="op">(</span><span class="va">p6</span><span class="op">)</span><span class="op">)</span>

<span class="co"># require at least two for each selected planning unit</span>
<span class="va">titles2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">titles2</span>, <span class="st">"Neighbor constraints (two)"</span><span class="op">)</span>
<span class="va">p7</span> <span class="op">&lt;-</span> <span class="va">p6</span> <span class="op">%&gt;%</span> <span class="fu"><a href="../reference/add_neighbor_constraints.html">add_neighbor_constraints</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span>
<span class="va">s2</span> <span class="op">&lt;-</span> <span class="fu">addLayer</span><span class="op">(</span><span class="va">s2</span>, <span class="fu"><a href="../reference/solve.html">solve</a></span><span class="op">(</span><span class="va">p7</span><span class="op">)</span><span class="op">)</span>

<span class="co"># impose small penalty for fragmented solutions</span>
<span class="va">titles2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">titles2</span>, <span class="st">"Boundary penalty (low)"</span><span class="op">)</span>
<span class="va">p8</span> <span class="op">&lt;-</span> <span class="va">p6</span> <span class="op">%&gt;%</span> <span class="fu"><a href="../reference/add_boundary_penalties.html">add_boundary_penalties</a></span><span class="op">(</span><span class="fl">0.0005</span>, <span class="fl">0.5</span><span class="op">)</span>
<span class="va">s2</span> <span class="op">&lt;-</span> <span class="fu">addLayer</span><span class="op">(</span><span class="va">s2</span>, <span class="fu"><a href="../reference/solve.html">solve</a></span><span class="op">(</span><span class="va">p8</span><span class="op">)</span><span class="op">)</span>

<span class="co"># impose high penalty for fragmented solutions</span>
<span class="va">titles2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">titles2</span>, <span class="st">"Boundary penalty (high)"</span><span class="op">)</span>
<span class="va">p9</span> <span class="op">&lt;-</span> <span class="va">p6</span> <span class="op">%&gt;%</span> <span class="fu"><a href="../reference/add_boundary_penalties.html">add_boundary_penalties</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.5</span><span class="op">)</span>
<span class="va">s2</span> <span class="op">&lt;-</span> <span class="fu">addLayer</span><span class="op">(</span><span class="va">s2</span>, <span class="fu"><a href="../reference/solve.html">solve</a></span><span class="op">(</span><span class="va">p9</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># plot solutions</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">s2</span>, main <span class="op">=</span> <span class="va">titles2</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span>, <span class="fl">1</span><span class="op">)</span>,  col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"grey70"</span>, <span class="st">"darkgreen"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="saltspring_files/figure-html/unnamed-chunk-12-1.png" width="480" style="display: block; margin: auto;"></p>
<p>Here we can see that adding the constraints and penalties to the problem has a small, but noticeable effect on the solutions. We would expect to see larger difference between the solutions for problems that contain more than five conservation features. You may also wish to explore the <code>add_connectivity_penalties</code> and <code>add_feature_contiguity_constraints</code> functions. These functions use additional data on landscape resistance to provide a more accurate parametrization of connectivity and, in turn, deliver more effective solutions.</p>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<div id="refs" class="references">
<div id="ref-r28">
<p>BC Assessment. (2015). <em>Property Information Services</em>. URL <a href="https://info.bcassessment.ca/" class="uri">https://info.bcassessment.ca/</a> [accessed 13 June 2016].</p>
</div>
<div id="ref-r29">
<p>Morrell, N., Schuster, R., Crombie, M. &amp; Arcese, P. (2017). <em>A Prioritization Tool for the Conservation of Coastal Douglas-fir Forest and Savannah Habitats of the Georgia Basin</em>. The Nature Trust of British Colombia, Coastal Douglas Fir Conservation Partnership, and the Department of Forest and Conservation Sciences, University of British Colombia, URL <a href="http://peter-arcese-lab.sites.olt.ubc.ca/files/2016/09/CDFCP_tutorial_2017_05.pdf" class="uri">http://peter-arcese-lab.sites.olt.ubc.ca/files/2016/09/CDFCP_tutorial_2017_05.pdf</a> [accessed 9 October 2017].</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://jeffrey-hanson.com">Jeffrey O Hanson</a>, <a href="http://www.richard-schuster.com">Richard Schuster</a>, Nina Morrell, <a href="http://strimas.com">Matthew Strimas-Mackey</a>, Matthew E Watts, <a href="https://arcese.forestry.ubc.ca">Peter Arcese</a>, <a href="https://josephrbennett.wordpress.com">Joseph Bennett</a>, <a href="http://www.possinghamlab.org">Hugh P Possingham</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '486efa122ea6783724263412c5f28ab3',
    indexName: 'prioritizr',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
