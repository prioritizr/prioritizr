<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Calibrating trade-offs tutorial • prioritizr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Calibrating trade-offs tutorial">
<meta property="og:description" content="prioritizr">
<meta property="og:image" content="https://prioritizr.net/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-70466840-4"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-70466840-4');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">prioritizr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">8.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/prioritizr.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/package_overview.html">Package overview</a>
    </li>
    <li>
      <a href="../articles/gurobi_installation_guide.html">Gurobi installation guide</a>
    </li>
    <li>
      <a href="../articles/solver_benchmarks.html">Solver benchmarks</a>
    </li>
    <li>
      <a href="../articles/publication_record.html">Publication record</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/connectivity_tutorial.html">Connectivity</a>
    </li>
    <li>
      <a href="../articles/calibrating_trade-offs_tutorial.html">Calibrating trade-offs</a>
    </li>
    <li>
      <a href="../articles/management_zones_tutorial.html">Management zones</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/prioritizr/prioritizr/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Calibrating trade-offs tutorial</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/prioritizr/prioritizr/blob/HEAD/vignettes/calibrating_trade-offs_tutorial.Rmd" class="external-link"><code>vignettes/calibrating_trade-offs_tutorial.Rmd</code></a></small>
      <div class="hidden name"><code>calibrating_trade-offs_tutorial.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Systematic conservation planning requires making trade-offs <span class="citation">(Margules &amp; Pressey 2000; Vane-Wright <em>et al.</em> 1991)</span>. Since different criteria may conflict with one another – or not align perfectly – prioritizations need to make trade-offs between different criteria <span class="citation">(Klein <em>et al.</em> 2013)</span>. Although some criteria can easily be accounted for by using locked constraints or representation targets <span class="citation">(e.g., Dorji <em>et al.</em> 2020; Hermoso <em>et al.</em> 2018)</span>, this is not always the case <span class="citation">(e.g., Beger <em>et al.</em> 2010)</span>. For example, prioritizations often need to balance overall cost with the overall level spatial fragmentation among reserves <span class="citation">(Hermoso <em>et al.</em> 2011; Stewart &amp; Possingham 2005)</span>. Additionally, prioritizations often need to balance the overall level of connectivity among reserves against other criteria <span class="citation">(Hermoso <em>et al.</em> 2012)</span>. Since the best trade-off depends on a range of factors – such as available budgets, species’ connectivity requirements, and management capacity – finding the best balance can be challenging.</p>
<p>The <em>prioritizr R</em> package provides multi-objective optimization methods to help identify the best trade-offs between different criteria. To achieve this, a conservation planning problem can be formulated with a primary objective (e.g., <code><a href="../reference/add_min_set_objective.html">add_min_set_objective()</a></code>) and penalties (e.g., <code><a href="../reference/add_boundary_penalties.html">add_boundary_penalties()</a></code>) that relate to such criteria. When building the problem, the nature of the trade-offs can be specified using certain parameters (e.g., the <code>penalty</code> parameter of the <code><a href="../reference/add_boundary_penalties.html">add_boundary_penalties()</a></code> function). To identify a prioritization that finds the best balance between different criteria, the trade-off parameters can be tuned using a calibration analysis. These analyses – in the context of systematic conservation planning – typically involve generating a set of candidate prioritizations based on different parameters, measuring their performance according to each of the criteria, and then selecting a prioritization (or set of prioritizations) based on how well they achieve the criteria <span class="citation">(Hermoso <em>et al.</em> 2011; Stewart &amp; Possingham 2005; Hermoso <em>et al.</em> 2012)</span>. For example, the <em>Marxan</em> decision support tool has a range of parameters (e.g., species penalty factors, boundary length modifier) that are calibrated to balance cost, species’ representation, and spatial fragmentation <span class="citation">(Ardron <em>et al.</em> 2010)</span>.</p>
<p>The aim of this tutorial is to provide guidance on calibrating trade-offs when using the <em>prioritizr R</em> package. Here we will explore a couple of different approaches for generating candidate prioritizations, and methods for finding the best balance between different criteria. Specifically, we will try to generate prioritizations that strike the best balance between total cost and spatial fragmentation (measured as total boundary length). As such, the code used in this vignette will be directly applicable when performing a boundary length calibration analysis.</p>
</div>
<div class="section level2">
<h2 id="data">Data<a class="anchor" aria-label="anchor" href="#data"></a>
</h2>
<p>Let’s load the packages and dataset used in this tutorial. Since this tutorial uses the <em>prioritizrdata R</em> package along with several other <em>R</em> packages (see below), please ensure that they are all installed. This particular dataset comprises two objects: <code>tas_pu</code> and <code>tas_features</code>. Although we will briefly describe this dataset below, please refer <code><a href="http://prioritizr.github.io/prioritizrdata/reference/tas_data.html" class="external-link">?prioritizrdata::tas_data</a></code> for further details.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://prioritizr.github.io/prioritizrdata/" class="external-link">prioritizrdata</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://prioritizr.net">prioritizr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/terra/" class="external-link">terra</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/" class="external-link">tibble</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://scales.r-lib.org" class="external-link">scales</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">topsis</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://withr.r-lib.org" class="external-link">withr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># load planning unit data</span></span>
<span><span class="va">tas_pu</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://prioritizr.github.io/prioritizrdata/reference/tas_data.html" class="external-link">get_tas_pu</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">tas_pu</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Simple feature collection with 1130 features and 4 fields</span></span>
<span><span class="co">## Geometry type: MULTIPOLYGON</span></span>
<span><span class="co">## Dimension:     XY</span></span>
<span><span class="co">## Bounding box:  xmin: 298809.6 ymin: 5167775 xmax: 613818.8 ymax: 5502544</span></span>
<span><span class="co">## Projected CRS: WGS 84 / UTM zone 55S</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 1,130 × 5</span></span></span>
<span><span class="co">##       id  cost locked_in locked_out                                         geom</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>                                <span style="color: #949494; font-style: italic;">&lt;MULTIPOLYGON [m]&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span>     1 60.2  FALSE     TRUE       (((328497 5497704, 326783.8 5500050, 326775…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span>     2 19.9  FALSE     FALSE      (((307121.6 5490487, 305344.4 5492917, 3053…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span>     3 59.7  FALSE     TRUE       (((321726.1 5492382, 320111 5494593, 320127…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span>     4 32.4  FALSE     FALSE      (((304314.5 5494324, 304342.2 5494287, 3043…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span>     5 26.2  FALSE     FALSE      (((314958.5 5487057, 312336 5490646, 312339…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span>     6 51.3  FALSE     FALSE      (((327904.3 5491218, 326594.6 5493012, 3284…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span>     7 32.3  FALSE     FALSE      (((308194.1 5481729, 306601.2 5483908, 3066…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span>     8 38.4  FALSE     FALSE      (((322792.7 5483624, 319965.3 5487497, 3199…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span>     9  3.55 FALSE     FALSE      (((334896.6 5490731, 335610.4 5492490, 3357…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span>    10  1.83 FALSE     FALSE      (((356377.1 5487952, 353903.1 5487635, 3538…</span></span>
<span><span class="co">## <span style="color: #949494;"># … with 1,120 more rows</span></span></span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load feature data</span></span>
<span><span class="va">tas_features</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://prioritizr.github.io/prioritizrdata/reference/tas_data.html" class="external-link">get_tas_features</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">tas_features</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## class       : SpatRaster </span></span>
<span><span class="co">## dimensions  : 398, 359, 33  (nrow, ncol, nlyr)</span></span>
<span><span class="co">## resolution  : 1000, 1000  (x, y)</span></span>
<span><span class="co">## extent      : 288801.7, 647801.7, 5142976, 5540976  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">## coord. ref. : WGS 84 / UTM zone 55S (EPSG:32755) </span></span>
<span><span class="co">## source      : tas_features.tif </span></span>
<span><span class="co">## names       : Banks~lands, Bould~marks, Calli~lands, Cool ~orest, Eucal~hyll), Eucal~torey, ... </span></span>
<span><span class="co">## min values  :           0,           0,           0,           0,           0,           0, ... </span></span>
<span><span class="co">## max values  :           1,           1,           1,           1,           1,           1, ...</span></span></code></pre>
<p>The <code>tas_pu</code> object contains planning units represented as spatial polygons (i.e., converted to a <code><a href="https://r-spatial.github.io/sf/reference/sf.html" class="external-link">sf::st_sf()</a></code> object). This object has three columns that denote the following information for each planning unit: a unique identifier (<code>id</code>), unimproved land value (<code>cost</code>), and current conservation status (<code>locked_in</code>). Specifically, the conservation status column indicates if at least half the area planning unit is covered by existing protected areas (denoted by a value of 1) or not (denoted by a value of zero).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot map of planning unit costs</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">tas_pu</span><span class="op">[</span>, <span class="st">"cost"</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="calibrating_trade-offs_tutorial_files/figure-html/unnamed-chunk-5-1.png" width="336" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot map of planning unit statuses</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">tas_pu</span><span class="op">[</span>, <span class="st">"locked_in"</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="calibrating_trade-offs_tutorial_files/figure-html/unnamed-chunk-5-2.png" width="336" style="display: block; margin: auto;"></p>
<p>The <code>tas_features</code> object describes the spatial distribution of different vegetation communities (using presence/absence data). We will use the vegetation communities as the biodiversity features for the prioritization.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot map of the first four vegetation classes</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">tas_features</span><span class="op">[[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="calibrating_trade-offs_tutorial_files/figure-html/unnamed-chunk-6-1.png" width="432" style="display: block; margin: auto;"></p>
<p>We can use this dataset to generate a prioritization. Specifically, we will use the minimum set objective so that the optimization process minimizes total cost. We will add representation targets to ensure that prioritizations cover 17% of each vegetation community. Additionally, we will add constraints to ensure that planning units covered by existing protected areas are selected (i.e., locked in). Finally, we will specify that the conservation planning exercise involves binary decisions (i.e., selecting or not selecting planning units for protected area establishment).</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># define a problem</span></span>
<span><span class="va">p0</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/problem.html">problem</a></span><span class="op">(</span><span class="va">tas_pu</span>, <span class="va">tas_features</span>, cost_column <span class="op">=</span> <span class="st">"cost"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_min_set_objective.html">add_min_set_objective</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_relative_targets.html">add_relative_targets</a></span><span class="op">(</span><span class="fl">0.17</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_locked_in_constraints.html">add_locked_in_constraints</a></span><span class="op">(</span><span class="st">"locked_in"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_binary_decisions.html">add_binary_decisions</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print problem</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">p0</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## A conservation problem (<span style="color: #0000BB;">&lt;ConservationProblem&gt;</span>)</span></span>
<span><span class="co">## <span style="color: #00BBBB;">├•data</span></span></span>
<span><span class="co">## <span style="color: #00BBBB;">│├•</span>features:    <span style="color: #0000BB;">"Banksia woodlands"</span> , … (33 total)</span></span>
<span><span class="co">## <span style="color: #00BBBB;">│└•</span>planning units:</span></span>
<span><span class="co">## <span style="color: #00BBBB;">│</span> <span style="color: #00BBBB;">├•</span>data:       <span style="color: #0000BB;">&lt;sftbl_dftbldata.frame&gt;</span> (1130 total)</span></span>
<span><span class="co">## <span style="color: #00BBBB;">│</span> <span style="color: #00BBBB;">├•</span>costs:      continuous values (between <span style="color: #0000BB;">0.1925</span> and <span style="color: #0000BB;">61.9273</span>)</span></span>
<span><span class="co">## <span style="color: #00BBBB;">│</span> <span style="color: #00BBBB;">├•</span>extent:     <span style="color: #0000BB;">298809.5764</span>, <span style="color: #0000BB;">5167774.5993</span>, <span style="color: #0000BB;">613818.7743</span>, <span style="color: #0000BB;">5502543.7119</span> (xmin, ymin, xmax, ymax)</span></span>
<span><span class="co">## <span style="color: #00BBBB;">│</span> <span style="color: #00BBBB;">└•</span>CRS:        WGS 84 / UTM zone 55S</span></span>
<span><span class="co">## <span style="color: #00BBBB;">├•formulation</span></span></span>
<span><span class="co">## <span style="color: #00BBBB;">│├•</span>objective:   minimum set objective</span></span>
<span><span class="co">## <span style="color: #00BBBB;">│├•</span>penalties:   <span style="color: #B2B2B2;">none specified</span></span></span>
<span><span class="co">## <span style="color: #00BBBB;">│├•</span>targets:     relative targets (between <span style="color: #0000BB;">0.17</span> and <span style="color: #0000BB;">0.17</span>)</span></span>
<span><span class="co">## <span style="color: #00BBBB;">│├•</span>constraints:</span></span>
<span><span class="co">## <span style="color: #00BBBB;">││└•</span>1:          locked in constraints (257 planning units)</span></span>
<span><span class="co">## <span style="color: #00BBBB;">│└•</span>decisions:   binary decision</span></span>
<span><span class="co">## <span style="color: #00BBBB;">└•optimization</span></span></span>
<span><span class="co">##  <span style="color: #00BBBB;">├•</span>portfolio:   shuffle portfolio (`number_solutions` = <span style="color: #0000BB;">1</span>, …)</span></span>
<span><span class="co">##  <span style="color: #00BBBB;">└•</span>solver:      gurobi solver (`gap` = <span style="color: #0000BB;">0.1</span>, `time_limit` = <span style="color: #0000BB;">2147483647</span>, `first_feasible` = <span style="color: #0000BB;">FALSE</span>, …)</span></span>
<span><span class="co">## <span style="color: #555555;"># ℹ Use `summary(...)` to see complete formulation.</span></span></span></code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># solve problem</span></span>
<span><span class="va">s0</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/solve.html">solve</a></span><span class="op">(</span><span class="va">p0</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Gurobi Optimizer version 10.0.0 build v10.0.0rc2 (linux64)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## CPU model: 11th Gen Intel(R) Core(TM) i7-1185G7 @ 3.00GHz, instruction set [SSE2|AVX|AVX2|AVX512]</span></span>
<span><span class="co">## Thread count: 4 physical cores, 8 logical processors, using up to 1 threads</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Optimize a model with 33 rows, 1130 columns and 8157 nonzeros</span></span>
<span><span class="co">## Model fingerprint: 0xd205b612</span></span>
<span><span class="co">## Variable types: 0 continuous, 1130 integer (1130 binary)</span></span>
<span><span class="co">## Coefficient statistics:</span></span>
<span><span class="co">##   Matrix range     [2e-06, 6e+01]</span></span>
<span><span class="co">##   Objective range  [2e-01, 6e+01]</span></span>
<span><span class="co">##   Bounds range     [1e+00, 1e+00]</span></span>
<span><span class="co">##   RHS range        [2e-01, 2e+03]</span></span>
<span><span class="co">## Found heuristic solution: objective 10337.581214</span></span>
<span><span class="co">## Presolve removed 19 rows and 354 columns</span></span>
<span><span class="co">## Presolve time: 0.00s</span></span>
<span><span class="co">## Presolved: 14 rows, 776 columns, 2296 nonzeros</span></span>
<span><span class="co">## Variable types: 0 continuous, 776 integer (776 binary)</span></span>
<span><span class="co">## Found heuristic solution: objective 9018.7830067</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Explored 0 nodes (0 simplex iterations) in 0.01 seconds (0.01 work units)</span></span>
<span><span class="co">## Thread count was 1 (of 8 available processors)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Solution count 2: 9018.78 10337.6 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Optimal solution found (tolerance 1.00e-01)</span></span>
<span><span class="co">## Best objective 9.018783006750e+03, best bound 8.496084047117e+03, gap 5.7957%</span></span></code></pre>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># print result</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">s0</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Simple feature collection with 1130 features and 5 fields</span></span>
<span><span class="co">## Geometry type: MULTIPOLYGON</span></span>
<span><span class="co">## Dimension:     XY</span></span>
<span><span class="co">## Bounding box:  xmin: 298809.6 ymin: 5167775 xmax: 613818.8 ymax: 5502544</span></span>
<span><span class="co">## Projected CRS: WGS 84 / UTM zone 55S</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 1,130 × 6</span></span></span>
<span><span class="co">##       id  cost locked_in locked_out solution_1                              geom</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;MULTIPOLYGON [m]&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span>     1 60.2  FALSE     TRUE                0 (((328497 5497704, 326783.8 5500…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span>     2 19.9  FALSE     FALSE               0 (((307121.6 5490487, 305344.4 54…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span>     3 59.7  FALSE     TRUE                0 (((321726.1 5492382, 320111 5494…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span>     4 32.4  FALSE     FALSE               0 (((304314.5 5494324, 304342.2 54…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span>     5 26.2  FALSE     FALSE               0 (((314958.5 5487057, 312336 5490…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span>     6 51.3  FALSE     FALSE               0 (((327904.3 5491218, 326594.6 54…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span>     7 32.3  FALSE     FALSE               0 (((308194.1 5481729, 306601.2 54…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span>     8 38.4  FALSE     FALSE               0 (((322792.7 5483624, 319965.3 54…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span>     9  3.55 FALSE     FALSE               0 (((334896.6 5490731, 335610.4 54…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span>    10  1.83 FALSE     FALSE               0 (((356377.1 5487952, 353903.1 54…</span></span>
<span><span class="co">## <span style="color: #949494;"># … with 1,120 more rows</span></span></span></code></pre>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create column for making a map of the prioritization</span></span>
<span><span class="va">s0</span><span class="op">$</span><span class="va">map_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>  <span class="va">s0</span><span class="op">$</span><span class="va">locked_in</span> <span class="op">&gt;</span> <span class="fl">0.5</span> <span class="op">~</span> <span class="st">"locked in"</span>,</span>
<span>  <span class="va">s0</span><span class="op">$</span><span class="va">solution_1</span> <span class="op">&gt;</span> <span class="fl">0.5</span> <span class="op">~</span> <span class="st">"priority"</span>,</span>
<span>  <span class="cn">TRUE</span> <span class="op">~</span> <span class="st">"other"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot map of prioritization</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  <span class="va">s0</span><span class="op">[</span>, <span class="st">"map_1"</span><span class="op">]</span>, pal <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"purple"</span>, <span class="st">"grey90"</span>, <span class="st">"darkgreen"</span><span class="op">)</span>,</span>
<span>  main <span class="op">=</span> <span class="cn">NULL</span>, key.pos <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="calibrating_trade-offs_tutorial_files/figure-html/unnamed-chunk-8-1.png" width="336" style="display: block; margin: auto;"></p>
<p>We can see that the priority areas identified by the prioritization are scattered across the study area (shown in green). Indeed, none of the priority areas are connected to existing protected areas (shown in purple), and very of them are connected with other priority areas. As such, the prioritization has a high level of spatial fragmentation. If it is important to avoid such levels of spatial fragmentation, then we will need to explicitly account for spatial fragmentation in the optimization process.</p>
</div>
<div class="section level2">
<h2 id="preliminary-processing">Preliminary processing<a class="anchor" aria-label="anchor" href="#preliminary-processing"></a>
</h2>
<p>We need to conduct some preliminary processing procedures to prepare the data for subsequent analysis. This is important to help make it easier to find suitable trade-off parameters, and avoid numerical scaling issues that can result in overly long run times (see <code><a href="../reference/presolve_check.html">presolve_check()</a></code> for further information). These processing steps are akin to data scaling (or normalization) procedures that are applied in statistical analysis to improve model convergence.</p>
<p>The first processing procedure involves setting the cost values for all locked in planning units to zero. This is so that the total cost estimates of the prioritization reflects the total cost of establishing new protected areas – not just total land value. In other words, we want the total cost estimate for a prioritization to reflect the cost of implementing conservation actions. <strong>This procedure is especially important when using the hierarchical approach described below, so that cost thresholds are based on percentage increases in the cost of establishing new protected areas.</strong></p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set costs for planning units covered by existing protected areas to zero</span></span>
<span><span class="va">tas_pu</span><span class="op">$</span><span class="va">cost</span><span class="op">[</span><span class="va">tas_pu</span><span class="op">$</span><span class="va">locked_in</span> <span class="op">&gt;</span> <span class="fl">0.5</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span></span>
<span><span class="co"># plot map of planning unit costs</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">tas_pu</span><span class="op">[</span>, <span class="st">"cost"</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="calibrating_trade-offs_tutorial_files/figure-html/unnamed-chunk-9-1.png" width="336" style="display: block; margin: auto;"></p>
<p>The second procedure involves pre-computing the boundary length data and manually re-scaling the boundary length values. This procedure is important because boundary length values are often very high, which can cause numerical issues that result in excessive run times (see <code><a href="../reference/presolve_check.html">presolve_check()</a></code> for further details).</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># generate boundary length data for the planning units</span></span>
<span><span class="va">tas_bd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/boundary_matrix.html">boundary_matrix</a></span><span class="op">(</span><span class="va">tas_pu</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># manually re-scale the boundary length values</span></span>
<span><span class="va">tas_bd</span><span class="op">@</span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/rescale.html" class="external-link">rescale</a></span><span class="op">(</span><span class="va">tas_bd</span><span class="op">@</span><span class="va">x</span>, to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.01</span>, <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>After applying these procedures, our data is ready for subsequent analysis.</p>
</div>
<div class="section level2">
<h2 id="generating-candidate-prioritizations">Generating candidate prioritizations<a class="anchor" aria-label="anchor" href="#generating-candidate-prioritizations"></a>
</h2>
<p>Here we will start the calibration analysis by generating a set of candidate prioritizations. Specifically, these prioritizations will be generated using different parameters to specify different trade-offs between the different criteria. Since this tutorial involves navigating trade-offs between the overall cost of a prioritization and the level of spatial fragmentation associated with a prioritization (as measured by total boundary length), we will generate prioritizations using different parameters related to these criteria. We will examine two approaches for generating candidate prioritizations based on multi-objective optimization procedures. <strong>Although we’ll be examining both approaches in this tutorial, you would normally only use one of these approaches when conducting your own analysis</strong></p>
<div class="section level3">
<h3 id="blended-approach">Blended approach<a class="anchor" aria-label="anchor" href="#blended-approach"></a>
</h3>
<p>The blended approach for multi-objective optimization involves combining separate criteria (e.g., total cost and total boundary length) into a single joint criterion. To achieve this, a trade-off (or scaling) parameter is used to specify the relative importance of each criterion. This approach is the default approach provided by the <em>prioritizr R</em> package. Specifically, each of the functions for adding a penalty to a problem formulation (e.g., <code><a href="../reference/add_boundary_penalties.html">add_boundary_penalties()</a></code>) contains a parameter to control the relative importance of the penalties (i.e., the <code>penalty</code> parameter). For example, when using the <code><a href="../reference/add_boundary_penalties.html">add_boundary_penalties()</a></code> function, setting a high <code>penalty</code> value will indicate that it is important to reduce the overall exposed boundary (perimeter) of the prioritization.</p>
<p>The main challenge with the blended approach is identifying a range of suitable <code>penalty</code> values to generate candidate prioritizations. If we set a <code>penalty</code> value that is too low, then the penalties will have no effect (e.g., boundary length penalties would have no effect on the prioritization). If we set a <code>penalty</code> value too high, then the prioritization will effectively ignore the primary objective. In such cases, the prioritization will be overly spatially clustered – because the planning unit cost values have no effect — and contain a single reserve. Thus we need to find a suitable range of <code>penalty</code> values before we can generate a set of candidate prioritizations.</p>
<p>We can find a suitable range of <code>penalty</code> values by generating a set of preliminary prioritizations. These preliminary prioritizations will be based on different <code>penalty</code> values – similar to the process for generating the candidate prioritizations – but solved using customized settings that sacrifice optimality for fast run times (see below for details). This is especially important because specifying a <code>penalty</code> value that is too high will cause the optimization process to take a very long time to generate a solutions (due to the numerical scaling issues mentioned previously). To find a suitable range of <code>penalty</code> values, we need to identify an upper limit for the <code>penalty</code> value (i.e., the highest <code>penalty</code> value that result in a prioritization containing a single reserve). Let’s create some preliminary <code>penalty</code> to identify this upper limit. <strong>Please note that you might need to adjust the <code>prelim_upper</code> value to find the upper limit when analyzing different datasets.</strong></p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># define a range of different penalty values</span></span>
<span><span class="co">## note that we use a power scale to avoid focusing on very high penalty values</span></span>
<span><span class="va">prelim_lower</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">5</span>   <span class="co"># change this for your own data</span></span>
<span><span class="va">prelim_upper</span> <span class="op">&lt;-</span> <span class="fl">2.8</span>  <span class="co"># change this for your own data</span></span>
<span><span class="va">prelim_penalty</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">10</span><span class="op">^</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="va">prelim_lower</span>, <span class="va">prelim_upper</span>, length.out <span class="op">=</span> <span class="fl">9</span><span class="op">)</span>, <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print penalty values</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">prelim_penalty</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1]   0.00001   0.00009   0.00089   0.00841   0.07943   0.74989   7.07946</span></span>
<span><span class="co">## [8]  66.83439 630.95734</span></span></code></pre>
<p>Next, let’s use the preliminary <code>penalty</code> values to generate preliminary prioritizations. As mentioned earlier, we will generate these preliminary prioritizations using customized settings to reduce runtime. Specifically, we will set a time limit of 10 minutes per run, and relax the optimality gap to 20%. Although we would not normally use such settings – because the resulting prioritizations are not guaranteed to be near-optimal (the default gap is 10%) – this is fine because our goal here is to tune the preliminary <code>penalty</code> values. Indeed, none of these preliminary prioritizations will be considered as candidate prioritizations. <strong>Please note that you might need to set a higher time limit, or relax the optimality gap even further (e.g., 40%) when analyzing larger datasets.</strong></p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># define a problem without boundary penalties</span></span>
<span><span class="va">p0</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/problem.html">problem</a></span><span class="op">(</span><span class="va">tas_pu</span>, <span class="va">tas_features</span>, cost_column <span class="op">=</span> <span class="st">"cost"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_min_set_objective.html">add_min_set_objective</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_relative_targets.html">add_relative_targets</a></span><span class="op">(</span><span class="fl">0.17</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_locked_in_constraints.html">add_locked_in_constraints</a></span><span class="op">(</span><span class="st">"locked_in"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_binary_decisions.html">add_binary_decisions</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># generate preliminary prioritizations based on each penalty</span></span>
<span><span class="co">## note that we specify a relaxed gap and time limit for the solver</span></span>
<span><span class="va">prelim_blended_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">prelim_penalty</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">s</span> <span class="op">&lt;-</span></span>
<span>    <span class="va">p0</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_boundary_penalties.html">add_boundary_penalties</a></span><span class="op">(</span>penalty <span class="op">=</span> <span class="va">x</span>, data <span class="op">=</span> <span class="va">tas_bd</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_default_solver.html">add_default_solver</a></span><span class="op">(</span>gap <span class="op">=</span> <span class="fl">0.2</span>, time_limit <span class="op">=</span> <span class="fl">10</span> <span class="op">*</span> <span class="fl">60</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/solve.html">solve</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>s <span class="op">=</span> <span class="va">s</span><span class="op">$</span><span class="va">solution_1</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">s</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://withr.r-lib.org/reference/with_options.html" class="external-link">with_options</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>scipen <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"penalty_"</span>, <span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">s</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># format results as a single spatial object</span></span>
<span><span class="va">prelim_blended_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span></span>
<span>  <span class="va">tas_pu</span>, <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">bind_cols</span>, <span class="va">prelim_blended_results</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># preview results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">prelim_blended_results</span><span class="op">)</span></span></code></pre></div>
<p>After generating the preliminary prioritizations, let’s create some maps to visualize them. In particular, we want to understand how different penalty values influence the spatial fragmentation of the prioritizations.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot maps of prioritizations</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span></span>
<span>    <span class="va">prelim_blended_results</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"penalty_"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html" class="external-link">mutate_if</a></span><span class="op">(</span><span class="va">is.numeric</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>        <span class="va">prelim_blended_results</span><span class="op">$</span><span class="va">locked_in</span> <span class="op">&gt;</span> <span class="fl">0.5</span> <span class="op">~</span> <span class="st">"locked in"</span>,</span>
<span>        <span class="va">x</span> <span class="op">&gt;</span> <span class="fl">0.5</span> <span class="op">~</span> <span class="st">"priority"</span>,</span>
<span>        <span class="cn">TRUE</span> <span class="op">~</span> <span class="st">"other"</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span>,</span>
<span>  pal <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"purple"</span>, <span class="st">"grey90"</span>, <span class="st">"darkgreen"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="calibrating_trade-offs_tutorial_files/figure-html/unnamed-chunk-13-1.png" width="672" style="display: block; margin: auto;"></p>
<p>We can see that as the <code>penalty</code> value used to generate the prioritizations increases, the spatial fragmentation of the prioritizations decreases. In particular, we can see that a <code>penalty</code> value of 66.83439 results in a single reserve – meaning this is our best guess of the upper limit. Using this <code>penalty</code> value as an upper limit, we will now generate a second series of prioritizations that will be the candidate prioritizations. Critically, these candidate prioritizations will not be generated using with time limit and be generated using a more suitable gap (i.e., default gap of 10%).</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># define a new set of penalty values</span></span>
<span><span class="co">## note that we use a linear scale to explore both low and high penalty values</span></span>
<span><span class="va">penalty</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1e-5</span>, <span class="va">prelim_penalty</span><span class="op">[</span><span class="fl">8</span><span class="op">]</span>, length.out <span class="op">=</span> <span class="fl">9</span><span class="op">)</span>, <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># generate prioritizations based on each penalty</span></span>
<span><span class="va">blended_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">penalty</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co">## generate solution</span></span>
<span>  <span class="va">s</span> <span class="op">&lt;-</span></span>
<span>    <span class="va">p0</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_boundary_penalties.html">add_boundary_penalties</a></span><span class="op">(</span>penalty <span class="op">=</span> <span class="va">x</span>, data <span class="op">=</span> <span class="va">tas_bd</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/solve.html">solve</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="co">## return data frame with solution</span></span>
<span>  <span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>s <span class="op">=</span> <span class="va">s</span><span class="op">$</span><span class="va">solution_1</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">s</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://withr.r-lib.org/reference/with_options.html" class="external-link">with_options</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>scipen <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"penalty_"</span>, <span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">s</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># format results as a single spatial object</span></span>
<span><span class="va">blended_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">tas_pu</span>, <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">bind_cols</span>, <span class="va">blended_results</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot maps of prioritizations</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span></span>
<span>    <span class="va">blended_results</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"penalty_"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html" class="external-link">mutate_if</a></span><span class="op">(</span><span class="va">is.numeric</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>        <span class="va">blended_results</span><span class="op">$</span><span class="va">locked_in</span> <span class="op">&gt;</span> <span class="fl">0.5</span> <span class="op">~</span> <span class="st">"locked in"</span>,</span>
<span>        <span class="va">x</span> <span class="op">&gt;</span> <span class="fl">0.5</span> <span class="op">~</span> <span class="st">"priority"</span>,</span>
<span>        <span class="cn">TRUE</span> <span class="op">~</span> <span class="st">"other"</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span>,</span>
<span>  pal <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"purple"</span>, <span class="st">"grey90"</span>, <span class="st">"darkgreen"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="calibrating_trade-offs_tutorial_files/figure-html/unnamed-chunk-14-1.png" width="672" style="display: block; margin: auto;"></p>
<p>We now have a set of candidate prioritizations generated using the blended approach. The main advantages of this approach is that it is similar calibration analyses used by other decision support tools for conservation (i.e., <em>Marxan</em>) and it is relatively straightforward to implement. However, this approach also has a key disadvantage. Because the <code>penalty</code> parameter is a unitless trade-off parameter – meaning that we can’t leverage existing knowledge to specify a suitable range of <code>penalty</code> values – we first have to conduct a preliminary analysis to identify an upper limit. Although finding an upper limit was fairly simple for the example dataset, it can be difficult to find for more realistic data. In the next section, we will show how to generate a set of candidate prioritizations using the hierarchical approach – which does not have this disadvantage.</p>
</div>
<div class="section level3">
<h3 id="hierarchical-approach">Hierarchical approach<a class="anchor" aria-label="anchor" href="#hierarchical-approach"></a>
</h3>
<p>The hierarchical approach for multi-objective optimization involves generating a series of incremental prioritizations – using a different objective at each increment to refine the previous solution – until the final solution achieves all of the objectives. The advantage with this approach is that we can specify trade-off parameters for each objective based on a percentage from optimality. This means that we can leverage our own knowledge – or that of decision maker – to generate a range of suitable trade-off parameters. As such, this approach does not require us to generate a series of preliminary prioritizations.</p>
<p>This approach is slightly more complicated to implement within the <em>prioritizr R</em> package then the blended approach. To start off, we generate an initial prioritization based on a problem formulation that does not consider any penalties. Critically, we will generate this prioritization by solving the problem to optimality (using the <code>gap</code> parameter of the <code><a href="../reference/add_default_solver.html">add_default_solver()</a></code> function).</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># define a problem without boundary penalties</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/problem.html">problem</a></span><span class="op">(</span><span class="va">tas_pu</span>, <span class="va">tas_features</span>, cost_column <span class="op">=</span> <span class="st">"cost"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_min_set_objective.html">add_min_set_objective</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_relative_targets.html">add_relative_targets</a></span><span class="op">(</span><span class="fl">0.17</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_locked_in_constraints.html">add_locked_in_constraints</a></span><span class="op">(</span><span class="st">"locked_in"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_binary_decisions.html">add_binary_decisions</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_default_solver.html">add_default_solver</a></span><span class="op">(</span>gap <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># solve problem</span></span>
<span><span class="va">s1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/solve.html">solve</a></span><span class="op">(</span><span class="va">p1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># add column for making a map of the prioritization</span></span>
<span><span class="va">s1</span><span class="op">$</span><span class="va">map_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>  <span class="va">s1</span><span class="op">$</span><span class="va">locked_in</span> <span class="op">&gt;</span> <span class="fl">0.5</span> <span class="op">~</span> <span class="st">"locked in"</span>,</span>
<span>  <span class="va">s1</span><span class="op">$</span><span class="va">solution_1</span> <span class="op">&gt;</span> <span class="fl">0.5</span> <span class="op">~</span> <span class="st">"priority"</span>,</span>
<span>  <span class="cn">TRUE</span> <span class="op">~</span> <span class="st">"other"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot map of prioritization</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  <span class="va">s1</span><span class="op">[</span>, <span class="st">"map_1"</span><span class="op">]</span>, pal <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"purple"</span>, <span class="st">"grey90"</span>, <span class="st">"darkgreen"</span><span class="op">)</span>,</span>
<span>  main <span class="op">=</span> <span class="cn">NULL</span>, key.pos <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="calibrating_trade-offs_tutorial_files/figure-html/unnamed-chunk-15-1.png" width="336" style="display: block; margin: auto;"></p>
<p>Next, we will calculate the total cost of the initial prioritization.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># calculate cost</span></span>
<span><span class="va">s1_cost</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/eval_cost_summary.html">eval_cost_summary</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">s1</span><span class="op">[</span>, <span class="st">"solution_1"</span><span class="op">]</span><span class="op">)</span><span class="op">$</span><span class="va">cost</span></span>
<span></span>
<span><span class="co"># print cost</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">s1_cost</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 354.3258</span></span></code></pre>
<p>Now we will calculate a series of cost thresholds. These cost thresholds will be calculated by inflating the cost of the initial prioritization by a range of percentage values. Since these values are percentages – and not unitless values unlike those used in the blended approach – we can use domain knowledge to specify a suitable range of cost thresholds. For this tutorial, let’s assume that it would be impractical – per our domain knowledge – to expend more than four times the total cost of the initial prioritization to reduce spatial fragmentation.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># calculate cost threshold values</span></span>
<span><span class="va">threshold</span> <span class="op">&lt;-</span> <span class="va">s1_cost</span> <span class="op">+</span> <span class="op">(</span><span class="va">s1_cost</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1e-5</span>, <span class="fl">4</span>, length.out <span class="op">=</span> <span class="fl">9</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">threshold</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="va">threshold</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print cost thresholds</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">threshold</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1]  355  532  709  886 1063 1241 1418 1595 1772</span></span></code></pre>
<p>After generating the cost thresholds, we can use them to generate prioritizations. Specifically, we will generate prioritizations that aim to minimize total boundary length as much as possible – ignoring the total cost of the prioritizations – whilst ensuring that the total cost of the prioritization does not exceed a given cost threshold and the other considerations (e.g., locked in constraints). To achieve this, we create a new column in the <code>tas_pu</code> object that contains only zero values (called <code>zeros</code>) and use this new column to specify the cost data for the prioritizations. <strong>Although we normally recommend against cost data that contain zero values – because planning units with zero costs are often selected in prioritizations even if they are not needed – here we use zero cost values so that the prioritization will focus exclusively on spatial fragmentation.</strong> Additionally, when it comes to generating the prioritization, we will add linear constraints to ensure that the total cost of the prioritization does not exceed a given cost threshold (using the <code><a href="../reference/add_linear_constraints.html">add_linear_constraints()</a></code> function).</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># add a column with zeros</span></span>
<span><span class="va">tas_pu</span><span class="op">$</span><span class="va">zeros</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span></span>
<span><span class="co"># define a problem with zero cost values and boundary penalties</span></span>
<span><span class="co">## note that because all the costs are all zero, it doesn't actually</span></span>
<span><span class="co">## matter what penalty value is used (as long as the value is &gt; 0)</span></span>
<span><span class="co">## and so we just use a value of 1</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/problem.html">problem</a></span><span class="op">(</span><span class="va">tas_pu</span>, <span class="va">tas_features</span>, cost_column <span class="op">=</span> <span class="st">"zeros"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_min_set_objective.html">add_min_set_objective</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_boundary_penalties.html">add_boundary_penalties</a></span><span class="op">(</span>penalty <span class="op">=</span> <span class="fl">1</span>, data <span class="op">=</span> <span class="va">tas_bd</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_relative_targets.html">add_relative_targets</a></span><span class="op">(</span><span class="fl">0.17</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_locked_in_constraints.html">add_locked_in_constraints</a></span><span class="op">(</span><span class="st">"locked_in"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_binary_decisions.html">add_binary_decisions</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: `x[, cost_column]` has only zero values.</span></span></code></pre>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># generate prioritizations based on each cost threshold</span></span>
<span><span class="co">## note that the prioritizations are solved to within 10% of optimality</span></span>
<span><span class="co">## (the default gap) because the gap is not specified</span></span>
<span><span class="va">hierarchical_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">threshold</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co">## generate solution by adding a constraint based on the threshold and</span></span>
<span>  <span class="co">## using the "real" cost values (i.e., not zeros)</span></span>
<span>  <span class="va">s</span> <span class="op">&lt;-</span></span>
<span>    <span class="va">p2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_linear_constraints.html">add_linear_constraints</a></span><span class="op">(</span>threshold <span class="op">=</span> <span class="va">x</span>, sense <span class="op">=</span> <span class="st">"&lt;="</span>, data <span class="op">=</span> <span class="st">"cost"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/solve.html">solve</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="co">## return data frame with solution</span></span>
<span>  <span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>s <span class="op">=</span> <span class="va">s</span><span class="op">$</span><span class="va">solution_1</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">s</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"threshold_"</span>, <span class="va">x</span><span class="op">)</span></span>
<span>  <span class="va">s</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># format results as a single spatial object</span></span>
<span><span class="va">hierarchical_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">tas_pu</span>, <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">bind_cols</span>, <span class="va">hierarchical_results</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot maps of prioritizations</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span></span>
<span>    <span class="va">hierarchical_results</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"threshold_"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html" class="external-link">mutate_if</a></span><span class="op">(</span><span class="va">is.numeric</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>        <span class="va">hierarchical_results</span><span class="op">$</span><span class="va">locked_in</span> <span class="op">&gt;</span> <span class="fl">0.5</span> <span class="op">~</span> <span class="st">"locked in"</span>,</span>
<span>        <span class="va">x</span> <span class="op">&gt;</span> <span class="fl">0.5</span> <span class="op">~</span> <span class="st">"priority"</span>,</span>
<span>        <span class="cn">TRUE</span> <span class="op">~</span> <span class="st">"other"</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span>,</span>
<span>  pal <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"purple"</span>, <span class="st">"grey90"</span>, <span class="st">"darkgreen"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="calibrating_trade-offs_tutorial_files/figure-html/unnamed-chunk-18-1.png" width="672" style="display: block; margin: auto;"></p>
<p>We now have a set of candidate prioritizations generated using the hierarchical approach. This approach can be much faster than the blended approach because it does not require generating a set of prioritizations to identify an upper limit for the <code>penalty</code> trade-off parameter. After generating a set of candidate prioritizations, we can then calculate performance metrics to compare the prioritizations.</p>
</div>
</div>
<div class="section level2">
<h2 id="calculating-performance-metrics">Calculating performance metrics<a class="anchor" aria-label="anchor" href="#calculating-performance-metrics"></a>
</h2>
<p>Here we will calculate performance metrics to compare the prioritizations. Since we aim to navigate trade-offs between the total cost of a prioritization and the overall level of spatial fragmentation associated with a prioritization (as measured by total boundary length), we will calculate metrics to assess these criteria. Although we generated two sets of candidate prioritizations in the previous section; for brevity, here we will consider the candidate prioritizations generated using the hierarchical approach. <strong>Please note that you could also apply the following procedures to candidate prioritizations generated using the blended approach.</strong></p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># calculate metrics for prioritizations</span></span>
<span><span class="co">## note that we use p0 and not p1 so that cost calculations are based</span></span>
<span><span class="co">## on the cost values and not zeros</span></span>
<span><span class="va">hierarchical_metrics</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"threshold_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">hierarchical_results</span><span class="op">)</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">hierarchical_results</span><span class="op">[</span>, <span class="va">x</span><span class="op">]</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>      total_cost <span class="op">=</span> <span class="fu"><a href="../reference/eval_cost_summary.html">eval_cost_summary</a></span><span class="op">(</span><span class="va">p0</span>, <span class="va">x</span><span class="op">)</span><span class="op">$</span><span class="va">cost</span>,</span>
<span>      total_boundary_length <span class="op">=</span> <span class="fu"><a href="../reference/eval_boundary_summary.html">eval_boundary_summary</a></span><span class="op">(</span><span class="va">p0</span>, <span class="va">x</span><span class="op">)</span><span class="op">$</span><span class="va">boundary</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span>
<span><span class="va">hierarchical_metrics</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">bind_rows</span>, <span class="va">hierarchical_metrics</span><span class="op">)</span></span>
<span><span class="va">hierarchical_metrics</span><span class="op">$</span><span class="va">threshold</span> <span class="op">&lt;-</span> <span class="va">threshold</span></span>
<span><span class="va">hierarchical_metrics</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">hierarchical_metrics</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># preview metrics</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">hierarchical_metrics</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 9 × 3</span></span></span>
<span><span class="co">##   total_cost total_boundary_length threshold</span></span>
<span><span class="co">##        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>       355.              2<span style="text-decoration: underline;">889</span>449.       355</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>       521.              2<span style="text-decoration: underline;">290</span>218.       532</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>       701.              2<span style="text-decoration: underline;">128</span>840.       709</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span>       880.              2<span style="text-decoration: underline;">048</span>851.       886</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span>      <span style="text-decoration: underline;">1</span>060.              1<span style="text-decoration: underline;">980</span>147.      <span style="text-decoration: underline;">1</span>063</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span>      <span style="text-decoration: underline;">1</span>237.              1<span style="text-decoration: underline;">893</span>784.      <span style="text-decoration: underline;">1</span>241</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">7</span>      <span style="text-decoration: underline;">1</span>416.              1<span style="text-decoration: underline;">834</span>661.      <span style="text-decoration: underline;">1</span>418</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">8</span>      <span style="text-decoration: underline;">1</span>590.              1<span style="text-decoration: underline;">776</span>538.      <span style="text-decoration: underline;">1</span>595</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">9</span>      <span style="text-decoration: underline;">1</span>771.              1<span style="text-decoration: underline;">656</span>359.      <span style="text-decoration: underline;">1</span>772</span></span></code></pre>
<p>After calculating the metrics, let’s we can use them to help select a prioritization.</p>
</div>
<div class="section level2">
<h2 id="selecting-a-prioritization">Selecting a prioritization<a class="anchor" aria-label="anchor" href="#selecting-a-prioritization"></a>
</h2>
<p>Now we need to decide on which candidate prioritization achieves the best trade-off. There are a range of qualitative and quantitative methods that are available to select a candidate prioritization <span class="citation">(Ardron <em>et al.</em> 2010)</span>. Here we will consider three different methods. Since some of these methods use a set of candidate prioritizations, we will use the candidate prioritizations using the hierarchical approach for these methods. To keep track of the prioritizations selected by different methods, let’s create a <code>results_data</code> table.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create data for plotting</span></span>
<span><span class="va">result_data</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">hierarchical_metrics</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co">## rename threshold column to value column</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>value <span class="op">=</span> <span class="st">"threshold"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co">## add column with column names that contain candidate prioritizations</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span></span>
<span>    <span class="st">"threshold_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">hierarchical_results</span><span class="op">)</span>, value <span class="op">=</span> <span class="cn">TRUE</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co">## add column with labels for plotting</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Threshold ="</span>, <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co">## add column to keep track prioritizations selected by different methods</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print table</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">result_data</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 9 × 6</span></span></span>
<span><span class="co">##   total_cost total_boundary_length value name           label            method</span></span>
<span><span class="co">##        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>       355.              2<span style="text-decoration: underline;">889</span>449.   355 threshold_355  Threshold = 355  none  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>       521.              2<span style="text-decoration: underline;">290</span>218.   532 threshold_532  Threshold = 532  none  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>       701.              2<span style="text-decoration: underline;">128</span>840.   709 threshold_709  Threshold = 709  none  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span>       880.              2<span style="text-decoration: underline;">048</span>851.   886 threshold_886  Threshold = 886  none  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span>      <span style="text-decoration: underline;">1</span>060.              1<span style="text-decoration: underline;">980</span>147.  <span style="text-decoration: underline;">1</span>063 threshold_1063 Threshold = 1063 none  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span>      <span style="text-decoration: underline;">1</span>237.              1<span style="text-decoration: underline;">893</span>784.  <span style="text-decoration: underline;">1</span>241 threshold_1241 Threshold = 1241 none  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">7</span>      <span style="text-decoration: underline;">1</span>416.              1<span style="text-decoration: underline;">834</span>661.  <span style="text-decoration: underline;">1</span>418 threshold_1418 Threshold = 1418 none  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">8</span>      <span style="text-decoration: underline;">1</span>590.              1<span style="text-decoration: underline;">776</span>538.  <span style="text-decoration: underline;">1</span>595 threshold_1595 Threshold = 1595 none  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">9</span>      <span style="text-decoration: underline;">1</span>771.              1<span style="text-decoration: underline;">656</span>359.  <span style="text-decoration: underline;">1</span>772 threshold_1772 Threshold = 1772 none</span></span></code></pre>
<p>Next, let’s examine some different methods for selecting prioritizations.</p>
<div class="section level3">
<h3 id="visual-method">Visual method<a class="anchor" aria-label="anchor" href="#visual-method"></a>
</h3>
<p>One qualitative method involves plotting the relationship between the different criteria, and using the plot to visually select a candidate prioritization. This visual method is often used to help calibrate trade-offs among prioritizations generated using the <em>Marxan</em> decision support tool <span class="citation">(e.g., Hermoso <em>et al.</em> 2011; Stewart &amp; Possingham 2005)</span>. So, let’s create a plot to select a prioritization.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create plot to visualize trade-offs and show selected candidate prioritization</span></span>
<span><span class="va">result_plot</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">result_data</span>,</span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">total_boundary_length</span>, y <span class="op">=</span> <span class="va">total_cost</span>, label <span class="op">=</span> <span class="va">label</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="op">-</span><span class="fl">0.15</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span></span>
<span>    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"visual"</span> <span class="op">=</span> <span class="st">"blue"</span>, <span class="st">"not selected"</span> <span class="op">=</span><span class="st">"black"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Total boundary length of prioritization"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Total cost of prioritization"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expansion.html" class="external-link">expansion</a></span><span class="op">(</span>mult <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># render plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">result_plot</span><span class="op">)</span></span></code></pre></div>
<p><img src="calibrating_trade-offs_tutorial_files/figure-html/unnamed-chunk-21-1.png" width="672" style="display: block; margin: auto;"></p>
<p>We can see that there is a clear relationship between total cost and total boundary length. It would seem that in order to achieve a lower total boundary length – and thus lower spatial fragmentation – the prioritization must have a greater cost. Although we might expect the results to show a smoother curve – in other words, only Pareto dominant solutions – this result is expected because we generated candidate prioritizations using the default optimality gap of 10%. Typically, the visual method involves selecting a prioritization near the elbow of the plot. So, let’s select the prioritization generated using a <code>threshold</code> value of 709. To keep track of the prioritizations selected based on different methods, let’s create a <code>method</code> column in the <code>result_data</code> table.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># specify prioritization selected by visual method</span></span>
<span><span class="va">result_data</span><span class="op">$</span><span class="va">method</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"visual"</span></span></code></pre></div>
<p>Next, let’s consider a quantitative approach.</p>
</div>
<div class="section level3">
<h3 id="topsis-method">TOPSIS method<a class="anchor" aria-label="anchor" href="#topsis-method"></a>
</h3>
<p>Multiple-criteria decision analysis is a discipline that uses analytical methods to evaluate trade-offs between multiple criteria <span class="citation">(MCDA; reviewed in Greene <em>et al.</em> 2011)</span>. Although this discipline contains many different methods, here we will use the the Technique for Order of Preference by Similarity to Ideal Solution (TOPSIS) method <span class="citation">(Hwang &amp; Yoon 1981)</span>. This method requires (i) data describing the performance of each prioritization according to the different criteria, (ii) weights to encode the relative importance of each criteria, and (iii) details on whether each criteria should ideally be minimized or maximized. Let’s run the analysis, assuming that we want equal weighting for total cost and total boundary length.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># calculate TOPSIS scores</span></span>
<span><span class="va">topsis_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/topsis/man/topsis.html" class="external-link">topsis</a></span><span class="op">(</span></span>
<span>  decision <span class="op">=</span></span>
<span>    <span class="va">hierarchical_metrics</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">total_cost</span>, <span class="va">total_boundary_length</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/terra/man/coerce.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  impacts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"-"</span>, <span class="st">"-"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">topsis_results</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   alt.row     score rank</span></span>
<span><span class="co">## 1       1 0.6747678    3</span></span>
<span><span class="co">## 2       2 0.7690763    1</span></span>
<span><span class="co">## 3       3 0.7261837    2</span></span>
<span><span class="co">## 4       4 0.6390543    4</span></span>
<span><span class="co">## 5       5 0.5450384    5</span></span>
<span><span class="co">## 6       6 0.4623809    6</span></span>
<span><span class="co">## 7       7 0.3906564    7</span></span>
<span><span class="co">## 8       8 0.3417825    8</span></span>
<span><span class="co">## 9       9 0.3252322    9</span></span></code></pre>
<p>The candidate prioritization with the greatest TOPSIS score is considered to represent the best trade-off between total cost and total boundary length. So, based on this method, we would select the prioritization generated using a <code>threshold</code> value of 532. Let’s update the <code>result_data</code> with this information.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># add column indicating prioritization selected by TOPSIS method</span></span>
<span><span class="va">result_data</span><span class="op">$</span><span class="va">method</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/summarize-generics.html" class="external-link">which.max</a></span><span class="op">(</span><span class="va">topsis_results</span><span class="op">$</span><span class="va">score</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"TOPSIS"</span></span></code></pre></div>
<p>Next, let’s consider another quantitative method.</p>
</div>
<div class="section level3">
<h3 id="cohon-et-al--1979-method">Cohon <em>et al.</em> (1979) method<a class="anchor" aria-label="anchor" href="#cohon-et-al--1979-method"></a>
</h3>
<p>This method is based on an algorithm that was originally developed by Cohon <em>et al.</em> <span class="citation">(Cohon <em>et al.</em> 1979)</span>, and was later adapted for use in systematic conservation planning <span class="citation">(Fischer &amp; Church 2005)</span>. Specifically, it involves generating two ideal prioritizations – with each prioritization representing the ideal prioritization for each criteria – and then using the performance metrics calculated for these prioritizations to automatically derive a trade-off <code>penalty</code> value <span class="citation">(Ardron <em>et al.</em> 2010; Cohon <em>et al.</em> 1979)</span>. Thus, unlike the two other methods, this method does not require a set of candidate prioritizations. <strong>As such, this method can be used to find a prioritization that meets multiple criteria in a much shorter period of time than the other methods.</strong> To implement this method, we first need to generate the ideal prioritizations (note that we specify an gap of 0% to ensure optimality).</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># generate ideal prioritization based on cost criteria</span></span>
<span><span class="co">## note that this is simply the same as the s1 prioritization we generated</span></span>
<span><span class="co">## for the hierarchical approach</span></span>
<span><span class="va">p3</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/problem.html">problem</a></span><span class="op">(</span><span class="va">tas_pu</span>, <span class="va">tas_features</span>, cost_column <span class="op">=</span> <span class="st">"cost"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_min_set_objective.html">add_min_set_objective</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_relative_targets.html">add_relative_targets</a></span><span class="op">(</span><span class="fl">0.17</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_locked_in_constraints.html">add_locked_in_constraints</a></span><span class="op">(</span><span class="st">"locked_in"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_binary_decisions.html">add_binary_decisions</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_default_solver.html">add_default_solver</a></span><span class="op">(</span>gap <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># solve problem</span></span>
<span><span class="va">s3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/solve.html">solve</a></span><span class="op">(</span><span class="va">p3</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># generate ideal prioritization based on spatial fragmentation criteria</span></span>
<span><span class="co">## note that any non-zero penalty value would here,</span></span>
<span><span class="co">## so we just use a penalty  of 1</span></span>
<span><span class="va">p4</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/problem.html">problem</a></span><span class="op">(</span><span class="va">tas_pu</span>, <span class="va">tas_features</span>, cost_column <span class="op">=</span> <span class="st">"zeros"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_min_set_objective.html">add_min_set_objective</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_boundary_penalties.html">add_boundary_penalties</a></span><span class="op">(</span>penalty <span class="op">=</span> <span class="fl">1</span>, data <span class="op">=</span> <span class="va">tas_bd</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_relative_targets.html">add_relative_targets</a></span><span class="op">(</span><span class="fl">0.17</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_locked_in_constraints.html">add_locked_in_constraints</a></span><span class="op">(</span><span class="st">"locked_in"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_binary_decisions.html">add_binary_decisions</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_default_solver.html">add_default_solver</a></span><span class="op">(</span>gap <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: `x[, cost_column]` has only zero values.</span></span></code></pre>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># solve problem</span></span>
<span><span class="va">s4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/solve.html">solve</a></span><span class="op">(</span><span class="va">p4</span><span class="op">)</span></span></code></pre></div>
<p>Next, let’s calculate the performance metrics for these prioritizations.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># generate problem formulation with costs and boundary penalties for</span></span>
<span><span class="co"># calculating performance metrics</span></span>
<span><span class="va">p5</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/problem.html">problem</a></span><span class="op">(</span><span class="va">tas_pu</span>, <span class="va">tas_features</span>, cost_column <span class="op">=</span> <span class="st">"cost"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_min_set_objective.html">add_min_set_objective</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_boundary_penalties.html">add_boundary_penalties</a></span><span class="op">(</span>penalty <span class="op">=</span> <span class="fl">1</span>, data <span class="op">=</span> <span class="va">tas_bd</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_relative_targets.html">add_relative_targets</a></span><span class="op">(</span><span class="fl">0.17</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_locked_in_constraints.html">add_locked_in_constraints</a></span><span class="op">(</span><span class="st">"locked_in"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_binary_decisions.html">add_binary_decisions</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># calculate performance metrics for ideal cost prioritization</span></span>
<span><span class="va">s3_metrics</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  total_cost <span class="op">=</span> <span class="fu"><a href="../reference/eval_cost_summary.html">eval_cost_summary</a></span><span class="op">(</span><span class="va">p5</span>, <span class="va">s3</span><span class="op">[</span>, <span class="st">"solution_1"</span><span class="op">]</span><span class="op">)</span><span class="op">$</span><span class="va">cost</span>,</span>
<span>  total_boundary_length <span class="op">=</span></span>
<span>    <span class="fu"><a href="../reference/eval_boundary_summary.html">eval_boundary_summary</a></span><span class="op">(</span><span class="va">p5</span>, <span class="va">s3</span><span class="op">[</span>, <span class="st">"solution_1"</span><span class="op">]</span><span class="op">)</span><span class="op">$</span><span class="va">boundary</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># calculate performance metrics for ideal boundary length prioritization</span></span>
<span><span class="va">s4_metrics</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  total_cost <span class="op">=</span> <span class="fu"><a href="../reference/eval_cost_summary.html">eval_cost_summary</a></span><span class="op">(</span><span class="va">p5</span>, <span class="va">s4</span><span class="op">[</span>, <span class="st">"solution_1"</span><span class="op">]</span><span class="op">)</span><span class="op">$</span><span class="va">cost</span>,</span>
<span>  total_boundary_length <span class="op">=</span></span>
<span>    <span class="fu"><a href="../reference/eval_boundary_summary.html">eval_boundary_summary</a></span><span class="op">(</span><span class="va">p5</span>, <span class="va">s4</span><span class="op">[</span>, <span class="st">"solution_1"</span><span class="op">]</span><span class="op">)</span><span class="op">$</span><span class="va">boundary</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>After calculating these performance metrics, we can use them to automatically calculate a <code>penalty</code> value.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># calculate penalty value based on Cohon et al. 1979</span></span>
<span><span class="va">cohon_penalty</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span></span>
<span>  <span class="op">(</span><span class="va">s3_metrics</span><span class="op">$</span><span class="va">total_cost</span> <span class="op">-</span> <span class="va">s4_metrics</span><span class="op">$</span><span class="va">total_cost</span><span class="op">)</span> <span class="op">/</span></span>
<span>  <span class="op">(</span><span class="va">s3_metrics</span><span class="op">$</span><span class="va">total_boundary_length</span> <span class="op">-</span> <span class="va">s4_metrics</span><span class="op">$</span><span class="va">total_boundary_length</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># round to 5 decimal places to avoid numerical issues during optimization</span></span>
<span><span class="va">cohon_penalty</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">cohon_penalty</span>, <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print penalty value</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">cohon_penalty</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.00894</span></span></code></pre>
<p>Now that we have calculated a <code>penalty</code> value using this method, we can use it to generate a prioritization.</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># generate prioritization using penalty value calculated using Cohon et al. 1979</span></span>
<span><span class="va">p6</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/problem.html">problem</a></span><span class="op">(</span><span class="va">tas_pu</span>, <span class="va">tas_features</span>, cost_column <span class="op">=</span> <span class="st">"cost"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_min_set_objective.html">add_min_set_objective</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_boundary_penalties.html">add_boundary_penalties</a></span><span class="op">(</span>penalty <span class="op">=</span> <span class="va">cohon_penalty</span>, data <span class="op">=</span> <span class="va">tas_bd</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_relative_targets.html">add_relative_targets</a></span><span class="op">(</span><span class="fl">0.17</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_locked_in_constraints.html">add_locked_in_constraints</a></span><span class="op">(</span><span class="st">"locked_in"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_binary_decisions.html">add_binary_decisions</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># solve problem</span></span>
<span><span class="va">s6</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/solve.html">solve</a></span><span class="op">(</span><span class="va">p6</span><span class="op">)</span></span></code></pre></div>
<p>Let’s update the <code>results_data</code> table with results about the prioritization.</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># add new row with data for prioritization generated following Cohon et al. 1979</span></span>
<span><span class="va">result_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>  <span class="va">result_data</span>,</span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>    total_cost <span class="op">=</span> <span class="fu"><a href="../reference/eval_cost_summary.html">eval_cost_summary</a></span><span class="op">(</span><span class="va">p6</span>, <span class="va">s6</span><span class="op">[</span>, <span class="st">"solution_1"</span><span class="op">]</span><span class="op">)</span><span class="op">$</span><span class="va">cost</span>,</span>
<span>    total_boundary_length <span class="op">=</span></span>
<span>      <span class="fu"><a href="../reference/eval_boundary_summary.html">eval_boundary_summary</a></span><span class="op">(</span><span class="va">p6</span>, <span class="va">s6</span><span class="op">[</span>, <span class="st">"solution_1"</span><span class="op">]</span><span class="op">)</span><span class="op">$</span><span class="va">boundary</span>,</span>
<span>    value <span class="op">=</span> <span class="va">cohon_penalty</span>,</span>
<span>    name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"penalty_"</span>, <span class="va">cohon_penalty</span><span class="op">)</span>,</span>
<span>    label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Penalty = "</span>,  <span class="va">cohon_penalty</span><span class="op">)</span>,</span>
<span>    method <span class="op">=</span> <span class="st">"Cohon"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Next, let’s compare the prioritizations selected by different methods.</p>
</div>
<div class="section level3">
<h3 id="method-comparison">Method comparison<a class="anchor" aria-label="anchor" href="#method-comparison"></a>
</h3>
<p>Let’s create a plot to visualize the results from the different methods.</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create plot to visualize trade-offs and show selected candidate prioritization</span></span>
<span><span class="va">result_plot</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span></span>
<span>      <span class="va">result_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>vjust <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">method</span> <span class="op">==</span> <span class="st">"Cohon"</span>, <span class="op">-</span><span class="fl">1</span>, <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">total_boundary_length</span>, y <span class="op">=</span> <span class="va">total_cost</span>, label <span class="op">=</span> <span class="va">label</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">method</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>vjust <span class="op">=</span> <span class="va">vjust</span>, color <span class="op">=</span> <span class="va">method</span><span class="op">)</span>, hjust <span class="op">=</span> <span class="op">-</span><span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"Method"</span>,</span>
<span>    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"visual"</span> <span class="op">=</span> <span class="st">"#984ea3"</span>,</span>
<span>      <span class="st">"none"</span> <span class="op">=</span> <span class="st">"#000000"</span>,</span>
<span>      <span class="st">"TOPSIS"</span> <span class="op">=</span> <span class="st">"#e41a1c"</span>,</span>
<span>      <span class="st">"Cohon"</span> <span class="op">=</span> <span class="st">"#377eb8"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Total boundary length of prioritization"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Total cost of prioritization"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expansion.html" class="external-link">expansion</a></span><span class="op">(</span>mult <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># render plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">result_plot</span><span class="op">)</span></span></code></pre></div>
<p><img src="calibrating_trade-offs_tutorial_files/figure-html/unnamed-chunk-30-1.png" width="672" style="display: block; margin: auto;"></p>
<p>We can see that the different method selected different prioritizations. To further compare the results from the different methods, let’s create some maps showing the selected prioritizations.</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># extract column names for creating the prioritizations</span></span>
<span><span class="va">visual_name</span> <span class="op">&lt;-</span> <span class="va">result_data</span><span class="op">$</span><span class="va">name</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">result_data</span><span class="op">$</span><span class="va">method</span> <span class="op">==</span> <span class="st">"visual"</span><span class="op">)</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">topsis_name</span> <span class="op">&lt;-</span> <span class="va">result_data</span><span class="op">$</span><span class="va">name</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">result_data</span><span class="op">$</span><span class="va">method</span> <span class="op">==</span> <span class="st">"TOPSIS"</span><span class="op">)</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># create object with selected prioritizations</span></span>
<span><span class="va">solutions</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html" class="external-link">bind_cols</a></span><span class="op">(</span></span>
<span>  <span class="va">tas_pu</span>,</span>
<span>  <span class="va">hierarchical_results</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">all_of</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">visual_name</span>, <span class="va">topsis_name</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Visual"</span>, <span class="st">"TOPSIS"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="va">s6</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">solution_1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>Cohon <span class="op">=</span> <span class="st">"solution_1"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot maps of selected prioritizations</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span></span>
<span>    <span class="va">solutions</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">Visual</span>, <span class="va">TOPSIS</span>, <span class="va">Cohon</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html" class="external-link">mutate_if</a></span><span class="op">(</span><span class="va">is.numeric</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>        <span class="va">hierarchical_results</span><span class="op">$</span><span class="va">locked_in</span> <span class="op">&gt;</span> <span class="fl">0.5</span> <span class="op">~</span> <span class="st">"locked in"</span>,</span>
<span>        <span class="va">x</span> <span class="op">&gt;</span> <span class="fl">0.5</span> <span class="op">~</span> <span class="st">"priority"</span>,</span>
<span>        <span class="cn">TRUE</span> <span class="op">~</span> <span class="st">"other"</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span>,</span>
<span>  pal <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"purple"</span>, <span class="st">"grey90"</span>, <span class="st">"darkgreen"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="calibrating_trade-offs_tutorial_files/figure-html/unnamed-chunk-31-1.png" width="672" style="display: block; margin: auto;"></p>
<p>How do we determine which one is best? This is difficult to say. Ideally, additional information could be used to help select a prioritization, such as knowledge on available resources, species’ connectivity requirements, and impacts of neighboring land use. However, from a practical perspective, prioritizations generated for academic contexts might find the quantitative approaches more useful because they have greater transparency and reproducibility. Ultimately, all of these methods are designed to support decision making. This means that they are intended to assist the decision making process, not serve as a replacement.</p>
</div>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>Hopefully, this vignette has provided a useful introduction for resolving trade-offs in prioritizations. Although we only explored trade-offs between total cost and spatial fragmentation in this tutorial, this analysis could be adapted to explore trade-offs between a wide range of different criteria. For instance, instead of considering total cost as the primary objective, future analyses could explore trade-offs with feature representation (using the <code><a href="../reference/add_min_shortfall_objective.html">add_min_shortfall_objective()</a></code> function). Additionally, instead of spatial fragmentation, future analyses could explore trade-offs that directly relate to connectivity (using the <code><a href="../reference/add_connectivity_penalties.html">add_connectivity_penalties()</a></code> function) or specific variables of interest – such as ecosystem intactness or inverse human footprint index <span class="citation">(Williams <em>et al.</em> 2020; Beyer <em>et al.</em> 2019)</span> – to inform decision making (using the <code><a href="../reference/add_linear_penalties.html">add_linear_penalties()</a></code> function). Furthermore, after identifying the best <code>penalty</code> or <code>threshold</code> values to strike a balance between multiple criteria, you could generate a portfolio of prioritizations (e.g., using the <code>add_gap_portfolio_function()</code>) to find multiple options for achieving a similar balance. This might be helpful when you need to generate a set of prioritizations that have comparable performance – in terms of how well they achieve different criteria – but select different planning units.</p>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-r45" class="csl-entry">
Ardron, J.A., Possingham, H.P. &amp; Klein, C.J. (2010). <em><span>Marxan Good Practices Handbook</span></em>. Pacific Marine Analysis; Research Association, Vancouver, Victoria, BC.
</div>
<div id="ref-r38" class="csl-entry">
Beger, M., Linke, S., Watts, M., Game, E., Treml, E., Ball, I. &amp; Possingham, H.P. (2010). Incorporating asymmetric connectivity into spatial decision making for conservation. <em>Conservation Letters</em>, <em>3</em>, 359–368.
</div>
<div id="ref-r48" class="csl-entry">
Beyer, H.L., Venter, O., Grantham, H.S. &amp; Watson, J.E.M. (2019). Substantial losses in ecoregion intactness highlight urgency of globally coordinated action. <em>Conservation Letters</em>, <em>13</em>.
</div>
<div id="ref-r49" class="csl-entry">
Cohon, J.L., Church, R.L. &amp; Sheer, D.P. (1979). Generating multiobjective trade-offs: An algorithm for bicriterion problems. <em>Water Resources Research</em>, <em>15</em>, 1001–1010.
</div>
<div id="ref-r40" class="csl-entry">
Dorji, T., Linke, S. &amp; Sheldon, F. (2020). Freshwater conservation planning in the context of nature needs half and protected area dynamism in bhutan. <em>Biological Conservation</em>, <em>251</em>, 108785.
</div>
<div id="ref-r50" class="csl-entry">
Fischer, D.T. &amp; Church, R.L. (2005). The <span>SITES</span> reserve selection system: A critical review. <em>Environmental Modeling and Assessment</em>, <em>10</em>, 215–228.
</div>
<div id="ref-r44" class="csl-entry">
Greene, R., Devillers, R., Luther, J.E. &amp; Eddy, B.G. (2011). <span>GIS</span>-based multiple-criteria decision analysis. <em>Geography Compass</em>, <em>5</em>, 412–432.
</div>
<div id="ref-r39" class="csl-entry">
Hermoso, V., Cattarino, L., Linke, S. &amp; Kennard, M.J. (2018). Catchment zoning to enhance co-benefits and minimize trade-offs between ecosystem services and freshwater biodiversity conservation. <em>Aquatic Conservation: Marine and Freshwater Ecosystems</em>, <em>28</em>, 1004–1014.
</div>
<div id="ref-r43" class="csl-entry">
Hermoso, V., Kennard, M.J. &amp; Linke, S. (2012). Integrating multidirectional connectivity requirements in systematic conservation planning for freshwater systems. <em>Diversity and Distributions</em>, <em>18</em>, 448–458.
</div>
<div id="ref-r41" class="csl-entry">
Hermoso, V., Linke, S., Prenda, J. &amp; Possingham, H.P. (2011). Addressing longitudinal connectivity in the systematic conservation planning of fresh waters. <em>Freshwater Biology</em>, <em>56</em>, 57–70.
</div>
<div id="ref-r46" class="csl-entry">
Hwang, C.L. &amp; Yoon, K.G. (1981). <em><span class="nocase">Multiple Attribute Decision Making: Methods and Applications</span></em>. Springer-Verlag, New York, NY.
</div>
<div id="ref-r37" class="csl-entry">
Klein, C.J., Tulloch, V.J., Halpern, B.S., Selkoe, K.A., Watts, M.E., Steinback, C., Scholz, A. &amp; Possingham, H.P. (2013). Tradeoffs in marine reserve design: Habitat condition, representation, and socioeconomic costs. <em>Conservation Letters</em>, 324–332.
</div>
<div id="ref-r4" class="csl-entry">
Margules, C.R. &amp; Pressey, R.L. (2000). Systematic conservation planning. <em>Nature</em>, <em>405</em>, 243–253.
</div>
<div id="ref-r42" class="csl-entry">
Stewart, R.R. &amp; Possingham, H.P. (2005). Efficiency, costs and trade-offs in marine reserve system design. <em>Environmental Modeling and Assessment</em>, <em>10</em>, 203–213.
</div>
<div id="ref-r36" class="csl-entry">
Vane-Wright, R.I., Humphries, C.J. &amp; Williams, P.H. (1991). What to protect? — <span>Systematics</span> and the agony of choice. <em>Biological Conservation</em>, <em>55</em>, 235–254.
</div>
<div id="ref-r47" class="csl-entry">
Williams, B.A., Venter, O., Allan, J.R., Atkinson, S.C., Rehbein, J.A., Ward, M., Marco, M.D., Grantham, H.S., Ervin, J., Goetz, S.J., Hansen, A.J., Jantz, P., Pillay, R., Rodrı́guez-Buriticá, S., Supples, C., Virnig, A.L.S. &amp; Watson, J.E.M. (2020). Change in terrestrial human footprint drives continued loss of intact ecosystems. <em>One Earth</em>, <em>3</em>, 371–382.
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="https://jeffrey-hanson.com" class="external-link">Jeffrey O Hanson</a>, <a href="http://www.richard-schuster.com" class="external-link">Richard Schuster</a>, Nina Morrell, <a href="http://strimas.com" class="external-link">Matthew Strimas-Mackey</a>, Brandon P M Edwards, Matthew E Watts, <a href="https://arcese.forestry.ubc.ca" class="external-link">Peter Arcese</a>, <a href="https://josephrbennett.wordpress.com" class="external-link">Joseph Bennett</a>, <a href="http://www.possinghamlab.org" class="external-link">Hugh P Possingham</a>.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '486efa122ea6783724263412c5f28ab3',
    indexName: 'prioritizr',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
